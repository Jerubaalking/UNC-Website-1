var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};if(typeof console==="undefined"){window.console={};console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}}window.performance=function(){if(window.performance&&window.performance.now)return window.performance;else return Date}();Date.now=Date.now||function(){return+new Date};if(!window.requestAnimationFrame){window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){var start=Date.now();return function(callback){window.setTimeout(function(){return callback(Date.now()-start)},1e3/60)}}()}()}window.defer=window.requestAnimationFrame;window.clearTimeout=function(){var _clearTimeout=clearTimeout;return function(ref){if(window.Timer)return Timer.__clearTimeout(ref)||_clearTimeout(ref);return _clearTimeout(ref)}}();window.requestIdleCallback=function(){var _requestIdleCallback=window.requestIdleCallback;return function(callback,max){if(_requestIdleCallback){return _requestIdleCallback(callback,max?{timeout:max}:null)}return defer(function(){callback({didTimeout:false})},0)}}();window.onIdle=window.requestIdleCallback;if(typeof Float32Array=="undefined")Float32Array=Array;Math.sign=function(x){x=+x;if(x===0||isNaN(x))return Number(x);return x>0?1:-1};Math._random=Math.random;Math.rand=Math.random=function(min,max){var precision=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(typeof min==="undefined")return Math._random();min=min||0;max=max||1;var p=Math.pow(10,precision);return Math.round((min+Math._random()*(max-min))*p)/p};Math.degrees=function(radians){return radians*(180/Math.PI)};Math.radians=function(degrees){return degrees*(Math.PI/180)};Math.clamp=function(value){var min=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))};Math.map=Math.range=function(value){var oldMin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var oldMax=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var newMin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var newMax=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var isClamp=arguments[5];var newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;if(isClamp)return Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax));return newValue};Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha};Math.step=function(edge,value){return value<edge?0:1};Math.smoothStep=function(min,max,value){var x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)};Math.fract=function(value){return value-Math.floor(value)};Math.mod=function(value,n){return(value%n+n)%n};Array.prototype.shuffle=function(){var i=this.length-1;var temp=void 0,r=void 0;while(i!==0){r=Math.random(0,i,0);i-=1;temp=this[i];this[i]=this[r];this[r]=temp}return this};Array.storeRandom=function(arr){arr.randomStore=[]};Array.prototype.random=function(range){var value=Math.random(0,this.length-1,0);if(arguments.length&&!this.randomStore)Array.storeRandom(this);if(!this.randomStore)return this[value];if(range>this.length-1)range=this.length;if(range>1){while(!!~this.randomStore.indexOf(value)){if((value+=1)>this.length-1)value=0}this.randomStore.push(value);if(this.randomStore.length>=range)this.randomStore.shift()}return this[value]};Array.prototype.remove=function(element){if(!this.indexOf)return;var index=this.indexOf(element);if(!!~index)return this.splice(index,1)};Array.prototype.last=function(){return this[this.length-1]};window.Promise=window.Promise||{};Promise.create=function(){var _this2=this;var promise=new Promise(function(resolve,reject){_this2.temp_resolve=resolve;_this2.temp_reject=reject});promise.resolve=this.temp_resolve;promise.reject=this.temp_reject;delete this.temp_resolve;delete this.temp_reject;return promise};String.prototype.includes=function(str){if(!Array.isArray(str))return!!~this.indexOf(str);for(var i=str.length-1;i>=0;i--){if(!!~this.indexOf(str[i]))return true}return false};String.prototype.strpos=function(str){console.warn("strpos deprecated: use .includes()");return this.includes(str)};String.prototype.clip=function(num,end){return this.length>num?this.slice(0,num)+end:this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};if(!window.fetch)window.fetch=function(url,options){options=options||{};var promise=Promise.create();var request=new XMLHttpRequest;request.open(options.method||"get",url);for(var i in options.headers){request.setRequestHeader(i,options.headers[i])}request.onload=function(){promise.resolve(response())};request.onerror=promise.reject;request.send(options.body);function response(){var _keys=[],all=[],headers={},header=void 0;request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,function(m,key,value){_keys.push(key=key.toLowerCase());all.push([key,value]);header=headers[key];headers[key]=header?header+","+value:value});return{ok:(request.status/200|0)==1,status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:function text(){return Promise.resolve(request.responseText)},json:function json(){return Promise.resolve(request.responseText).then(JSON.parse)},xml:function xml(){return Promise.resolve(request.responseXML)},blob:function blob(){return Promise.resolve(new Blob([request.response]))},headers:{keys:function keys(){return _keys},entries:function entries(){return all},get:function get(n){return headers[n.toLowerCase()]},has:function has(n){return n.toLowerCase()in headers}}}}return promise};window.get=function(url){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var promise=Promise.create();options.method="GET";fetch(url,options).then(handleResponse).catch(promise.reject);function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(function(text){if(text.charAt(0).includes(["[","{"])){try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}}else{promise.resolve(text)}})}return promise};window.post=function(url,body){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var promise=Promise.create();options.method="POST";options.body=JSON.stringify(body);fetch(url,options).then(handleResponse).catch(promise.reject);function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then(function(text){if(text.charAt(0).includes(["[","{"])){try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}}else{promise.resolve(text)}})}return promise};window.Class=function(_class,_type,_static){var _this=this||window;var _name=_class.name||_class.toString().match(/function ([^\(]+)/)[1];if(typeof _type==="function"){_static=_type;_type=null}_type=(_type||"").toLowerCase();if(!_type){_this[_name]=_class;_static&&_static()}else{if(_type=="static"){_this[_name]=new _class}else if(_type=="singleton"){_this[_name]=_class;(function(){var _instance=void 0;_this[_name].instance=function(a,b,c){if(!_instance)_instance=new _class(a,b,c);return _instance}}());_static&&_static()}}if(this!==window)this[_name]._namespace=this.__namespace};window.Inherit=function(child,parent,params){parent.apply(child,[params]);var save={};for(var method in child){save[method]=child[method]}defer(function(){for(var _method in child){if(save[_method]&&child[_method]!==save[_method]){if(child["_"+_method])throw"Attempt to overwrite "+_method+" method twice in "+child.constructor.name;child["_"+_method]=save[_method]}}})};window.Namespace=function(obj){if(typeof obj==="string"){window[obj]={Class:Class,__namespace:obj}}else{obj.Class=Class;obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]}};window.Global={};window.THREAD=false;Class(function Hydra(){var _readyPromise=Promise.create();this.HASH=window.location.hash.slice(1);this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||location.hostname.split(".")[0]=="10"||location.hostname.split(".")[0]=="192");(function(){initLoad()}());function initLoad(){if(!document||!window)return setTimeout(initLoad,1);if(window._NODE_||window._GLES_)return setTimeout(loaded,1);window.addEventListener("load",loaded,false)}function loaded(){window.removeEventListener("load",loaded,false);_readyPromise.resolve();if(window.Main){_readyPromise.then(function(){return Hydra.Main=new window.Main})}}this.__triggerReady=function(){loaded()};this.ready=function(callback){if(!callback)return _readyPromise;_readyPromise.then(callback)}},"Static");Class(function Utils(){this.query=function(key){var str=decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURI(key).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"));if(!str.length||str=="0"||str=="false")return false;return str};this.getConstructorName=function(obj){if(!obj)return obj;return obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]};this.nullObject=function(object){if(object.destroy||object.div){for(var key in object){if(typeof object[key]!=="undefined")object[key]=null}}return null};this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))};this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0};this.mergeObject=function(){var obj={};for(var i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o){obj[key]=o[key]}}return obj};this.timestamp=function(){var num=Date.now()+Math.random(0,99999,0);return num.toString()};this.randomColor=function(){var color="#"+Math.floor(Math.random()*16777215).toString(16);if(color.length<7)color=this.randomColor();return color};this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")};this.padInt=function(num,digits,isLimit){if(isLimit)num=Math.min(num,Math.pow(10,digits)-1);var str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str}},"Static");Class(function Render(){var _this=this;var _render=[];var _last=performance.now();var _skipLimit=200;(function(){if(THREAD)return;requestAnimationFrame(render)}());function render(tsl){var delta=tsl-_last;delta=Math.min(_skipLimit,delta);_last=tsl;_this.TIME=tsl;_this.DELTA=delta;for(var i=_render.length-1;i>=0;i--){var callback=_render[i];if(!callback){_render.remove(callback);continue}if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame);callback.last=tsl;continue}callback(tsl,delta)}if(!THREAD&&!_this.isPaused)requestAnimationFrame(render)}this.start=function(callback,fps){if(fps){callback.fps=fps;callback.last=-Infinity;callback.frame=-1}if(!~_render.indexOf(callback))_render.unshift(callback)};this.stop=function(callback){_render.remove(callback)};this.tick=function(){if(!THREAD)return;this.TIME=performance.now();render(this.TIME)};this.Worker=function(_callback){var _budget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:4;var _elapsed=0;_this.start(loop);function loop(){while(_elapsed<_budget){var start=performance.now();_callback();_elapsed+=performance.now()-start}_elapsed=0}this.stop=this.destroy=function(){_this.stop(loop);return _callback=null}};this.pause=function(){_this.isPaused=true};this.resume=function(){if(!_this.isPaused)return;_this.isPaused=false;requestAnimationFrame(render)}},"Static");Class(function Timer(){var _this=this;var _callbacks=[];var _discard=[];(function(){Render.start(loop)}());function loop(t,delta){for(var i=_discard.length-1;i>=0;i--){var obj=_discard[i];obj.callback=null;_callbacks.remove(obj)}if(_discard.length)_discard.length=0;for(var _i=_callbacks.length-1;_i>=0;_i--){var _obj2=_callbacks[_i];if(!_obj2){_callbacks.remove(_obj2);continue}if((_obj2.current+=delta)>=_obj2.time){_obj2.callback&&_obj2.callback.apply(this,_obj2.args);_discard.push(_obj2)}}}function find(ref){for(var i=_callbacks.length-1;i>-1;i--){if(_callbacks[i].ref==ref)return _callbacks[i]}}this.__clearTimeout=function(ref){var obj=find(ref);if(!obj)return false;obj.callback=null;_callbacks.remove(obj);return true};this.create=function(callback,time){if(window._NODE_)return setTimeout(callback,time);var obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,args:[].slice.call(arguments,2)};_callbacks.unshift(obj);return obj.ref};window.defer=this.defer=function(callback){_this.create(callback,1)}},"static");Class(function Events(){this.events={};var _e={};var _linked=[];var _emitter=void 0;this.events.sub=function(obj,evt,callback){if((typeof obj==="undefined"?"undefined":_typeof(obj))!=="object"){callback=evt;evt=obj;obj=null}if(!obj){Events.emitter._addEvent(evt,!!callback.resolve?callback.resolve:callback,this);return callback}var emitter=obj.events.emitter();emitter._addEvent(evt,!!callback.resolve?callback.resolve:callback,this);emitter._saveLink(this);_linked.push(emitter);return callback};this.events.unsub=function(obj,evt,callback){if((typeof obj==="undefined"?"undefined":_typeof(obj))!=="object"){callback=evt;evt=obj;obj=null}if(!obj)return Events.emitter._removeEvent(evt,!!callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,!!callback.resolve?callback.resolve:callback)};this.events.fire=function(evt,obj,isLocalOnly){obj=obj||_e;Events.emitter._check(evt);if(_emitter&&_emitter._fireEvent(evt,obj))return;if(isLocalOnly)return;Events.emitter._fireEvent(evt,obj)};this.events.bubble=function(obj,evt){var _this=this;_this.sub(obj,evt,function(e){return _this.fire(evt,e)})};this.events.destroy=function(){var _this3=this;Events.emitter._destroyEvents(this);if(_linked)_linked.forEach(function(emitter){return emitter._destroyEvents(_this3)});if(_emitter&&_emitter.links)_emitter.links.forEach(function(obj){return obj.events&&obj.events._unlink(_emitter)});return null};this.events.emitter=function(){if(!_emitter)_emitter=Events.emitter.createLocalEmitter();return _emitter};this.events._unlink=function(emitter){_linked.remove(emitter)}},function(){Events.emitter=new Emitter;Events.VISIBILITY="hydra_visibility";Events.HASH_UPDATE="hydra_hash_update";Events.COMPLETE="hydra_complete";Events.PROGRESS="hydra_progress";Events.UPDATE="hydra_update";Events.LOADED="hydra_loaded";Events.END="hydra_end";Events.FAIL="hydra_fail";Events.SELECT="hydra_select";Events.ERROR="hydra_error";Events.READY="hydra_ready";Events.RESIZE="hydra_resize";Events.CLICK="hydra_click";Events.HOVER="hydra_hover";Events.MESSAGE="hydra_message";Events.ORIENTATION="orientation";Events.BACKGROUND="background";Events.BACK="hydra_back";Events.PREVIOUS="hydra_previous";Events.NEXT="hydra_next";Events.RELOAD="hydra_reload";Events.FULLSCREEN="hydra_fullscreen";var _e={};function Emitter(){var prototype=Emitter.prototype;this.events=[];if(typeof prototype._check!=="undefined")return;prototype._check=function(evt){if(typeof evt=="undefined")throw"Undefined event"};prototype._addEvent=function(evt,callback,object){this._check(evt);this.events.push({evt:evt,object:object,callback:callback})};prototype._removeEvent=function(eventString,callback){var _this4=this;this._check(eventString);var _this=this;var _loop2=function _loop2(i){if(_this4.events[i].evt==eventString&&_this4.events[i].callback==callback){_this4.events[i].markedForDeletion=true;defer(function(){return _this.events.splice(i,1)[0]=null})}};for(var i=this.events.length-1;i>=0;i--){_loop2(i)}};prototype._fireEvent=function(eventString,obj){if(this._check)this._check(eventString);obj=obj||_e;var called=false;for(var i=0;i<this.events.length;i++){var evt=this.events[i];if(evt.evt==eventString&&!evt.markedForDeletion){evt.callback(obj);called=true}}return called};prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--){if(this.events[i].object==object)this.events.splice(i,1)[0]=null}};prototype._saveLink=function(obj){if(!this.links)this.links=[];if(!~this.links.indexOf(obj))this.links.push(obj)};prototype.createLocalEmitter=function(){return new Emitter}}Hydra.ready(function(){(function(){var _lastTime=performance.now();var _last=void 0;Timer.create(addVisibilityHandler,250);function addVisibilityHandler(){var hidden=void 0,eventName=void 0;[["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach(function(d){if(typeof document[d[0]]!=="undefined"){hidden=d[0];eventName=d[1]}});if(!eventName){var root=Device.system.browser==='ie'?document:window;root.onfocus=onfocus;root.onblur=onblur;return}document.addEventListener(eventName,function(){var time=performance.now();if(time-_lastTime>10){if(document[hidden]===false)onfocus();else onblur()}_lastTime=time})}function onfocus(){if(_last!="focus")Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"});_last="focus"}function onblur(){if(_last!="blur")Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"});_last="blur"}}());window.Stage=window.Stage||{};updateStage();window.onresize=function(){updateStage();Events.emitter._fireEvent(Events.RESIZE)};window.onorientationchange=window.onresize;defer(window.onresize);function updateStage(){Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight}})});Class(function Dispatch(){var _instances={};this.registerInstance=function(object){var ref=Utils.getConstructorName(object);_instances[ref]=object;object.removeDispatch=function(){delete _instances[ref]}};this.lookup=function(_class){var name=_class.toString().match(/function ([^\(]+)/)[1];return _instances[name]||console.error("No instance "+name+" found")}},"static");Class(function Device(){var _this=this;this.agent=navigator.userAgent.toLowerCase();this.detect=function(match){return this.agent.includes(match)};this.touchCapable=!!("ontouchstart"in window);this.pixelRatio=window.devicePixelRatio;this.system={};this.system.retina=window.devicePixelRatio>1;this.system.webworker=typeof window.Worker!=="undefined";this.system.offline=typeof window.applicationCache!=="undefined";if(!window._NODE_)this.system.geolocation=typeof navigator.geolocation!=="undefined";if(!window._NODE_)this.system.pushstate=typeof window.history.pushState!=="undefined";this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia);this.system.language=window.navigator.userLanguage||window.navigator.language;this.system.webaudio=typeof window.AudioContext!=="undefined";this.system.vr=function(){if(!navigator.getVRDisplays)return false;navigator.getVRDisplays().then(function(displays){_this.system.vr=displays.length>0})}();try{this.system.localStorage=typeof window.localStorage!=="undefined"}catch(e){this.system.localStorage=false}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled;this.system.os=function(){if(_this.detect(["ipad","iphone"]))return"ios";if(_this.detect(["android","kindle"]))return"android";if(_this.detect(["blackberry"]))return"blackberry";if(_this.detect(["mac os"]))return"mac";if(_this.detect(["windows","iemobile"]))return"windows";if(_this.detect(["linux"]))return"linux";return"unknown"}();this.system.version=function(){try{if(_this.system.os=="ios"){var num=_this.agent.split("os ")[1].split("_");var main=num[0];var sub=num[1].split(" ")[0];return Number(main+"."+sub)}if(_this.system.os=="android"){var version=_this.agent.split("android ")[1].split(";")[0];if(version.length>3)version=version.slice(0,-2);if(version.charAt(version.length-1)==".")version=version.slice(0,-1);return Number(version)}if(_this.system.os=="blackberry"){if(_this.agent.includes("rv:11"))return 11;return Number(_this.agent.split("windows phone ")[1].split(";")[0])}}catch(e){}return-1}();this.system.browser=function(){if(_this.system.os=="ios"){if(_this.detect(["twitter","fbios"]))return"social";if(_this.detect(["crios"]))return"chrome";if(_this.detect(["safari"]))return"safari";return"unknown"}if(_this.system.os=="android"){if(_this.detect(["twitter","fb","facebook"]))return"social";if(_this.detect(["chrome"]))return"chrome";if(_this.detect(["firefox"]))return"firefox";return"browser"}if(_this.detect(["msie"]))return"ie";if(_this.detect(["trident"])&&_this.detect(["rv:"]))return"ie";if(_this.detect(["windows"])&&_this.detect(["edge"]))return"ie";if(_this.detect(["chrome"]))return"chrome";if(_this.detect(["safari"]))return"safari";if(_this.detect(["firefox"]))return"firefox";return"unknown"}();this.system.browserVersion=function(){try{if(_this.system.browser=="chrome")return Number(_this.agent.split("chrome/")[1].split(".")[0]);if(_this.system.browser=="firefox")return Number(_this.agent.split("firefox/")[1].split(".")[0]);if(_this.system.browser=="safari")return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if(_this.system.browser=="ie"){if(_this.detect(["msie"]))return Number(_this.agent.split("msie ")[1].split(".")[0]);if(_this.detect(["rv:"]))return Number(_this.agent.split("rv:")[1].split(".")[0]);return Number(_this.agent.split("edge/")[1].split(".")[0])}}catch(e){return-1}}();this.mobile=!window._NODE_&&!!("ontouchstart"in window||"onpointerdown"in window)&&this.detect(["ios","iphone","ipad","windows phone","android","blackberry"])?{}:false;if(this.mobile&&this.detect(["windows"])&&!this.detect(["touch"]))this.mobile=false;if(this.mobile){this.mobile.tablet=Math.max(screen.width,screen.height)>800;this.mobile.phone=!this.mobile.tablet;this.mobile.pwa=function(){if(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)return true;if(window.navigator.standalone)return true;return false}();Hydra.ready(function(){_this.mobile.native=function(){return!!(Mobile.NativeCore&&Mobile.NativeCore.active)}()})}this.media={};this.media.audio=function(){if(!!document.createElement("audio").canPlayType){return _this.detect(["firefox","opera"])?"ogg":"mp3"}else{return false}}();this.media.video=function(){var vid=document.createElement("video");if(!!vid.canPlayType){if(Device.mobile)return"mp4";if(_this.system.browser=="chrome")return"webm";if(_this.system.browser=="firefox"||_this.system.browser=="opera"){if(vid.canPlayType('video/webm; codecs="vorbis,vp8"'))return"webm";return"ogv"}return"mp4"}else{return false}}();this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection);this.graphics={};this.graphics.webgl=function(){Object.defineProperty(_this.graphics,"webgl",{get:function get(){if(_this.graphics._webglContext)return _this.graphics._webglContext;try{var names=["webgl","experimental-webgl","webkit-3d","moz-webgl"];var canvas=document.createElement("canvas");var gl=void 0;for(var i=0;i<names.length;i++){gl=canvas.getContext(names[i]);if(gl)break}var info=gl.getExtension("WEBGL_debug_renderer_info");var output={};if(info){var gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}output.renderer=gl.getParameter(gl.RENDERER).toLowerCase();output.version=gl.getParameter(gl.VERSION).toLowerCase();output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase();output.extensions=gl.getSupportedExtensions();output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return true;if(output.version&&output.version.toLowerCase().includes(matches))return true;for(var _i2=0;_i2<output.extensions.length;_i2++){if(output.extensions[_i2].toLowerCase().includes(matches))return true}return false};_this.graphics._webglContext=output;return gl}catch(e){return false}}})}();this.graphics.canvas=function(){var canvas=document.createElement("canvas");return canvas.getContext?true:false}();var checkForStyle=function(){var _tagDiv=void 0;return function(prop){_tagDiv=_tagDiv||document.createElement("div");var vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in _tagDiv.style)return true;prop=prop.replace(/^[a-z]/,function(val){return val.toUpperCase()});for(var i=vendors.length-1;i>=0;i--){if(vendors[i]+prop in _tagDiv.style)return true}return false}}();this.styles={};this.styles.filter=checkForStyle("filter");this.styles.blendMode=checkForStyle("mix-blend-mode");this.tween={};this.tween.transition=checkForStyle("transition");this.tween.css2d=checkForStyle("transform");this.tween.css3d=checkForStyle("perspective")},"Static");Class(function Component(){Inherit(this,Events);var _this=this;var _setters={};var _active={};var _timers=[];var _loops=[];this.classes={};function defineSetter(_this,prop){_setters[prop]={};Object.defineProperty(_this,prop,{set:function set(v){if(_setters[prop]&&_setters[prop].s)_setters[prop].s.call(_this,v);v=null},get:function get(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.set=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].s=callback};this.get=function(prop,callback){if(!_setters[prop])defineSetter(this,prop);_setters[prop].g=callback};this.initClass=function(clss){if(!clss)throw"unable to locate class";var args=[].slice.call(arguments,1);var child=Object.create(clss.prototype);child.parent=this;clss.apply(child,args);if(child.destroy){var id=Utils.timestamp();this.classes[id]=child;this.classes[id].__id=id}if(child.element){var last=arguments[arguments.length-1];if(Array.isArray(last)&&last.length==1&&last[0]instanceof HydraObject)last[0].add(child.element);else if(this.element&&last!==null)this.element.add(child.element)}if(child.group){var _last2=arguments[arguments.length-1];if(this.group&&_last2!==null)this.group.add(child.group)}return child};this.delayedCall=function(callback,time){var _this5=this;var args=[].slice.call(arguments,2);var timer=Timer.create(function(){if(!_this||!_this.destroy)return;callback&&callback.apply(_this5,args)},time);_timers.push(timer);if(_timers.length>50)_timers.shift();return timer};this.clearTimers=function(){for(var i=_timers.length-1;i>=0;i--){clearTimeout(_timers[i])}_timers.length=0};this.startRender=function(callback,fps){_loops.push(callback);Render.start(callback,fps)};this.stopRender=function(callback){_loops.remove(callback);Render.stop(callback)};this.clearRenders=function(){for(var i=_loops.length-1;i>=0;i--){_this.stopRender(_loops[i])}};this.wait=function(object,key,callback){if(typeof object=="function"&&typeof callback!=="function"){var _object=object;object=key;key=callback;callback=_object}var promise=Promise.create();callback=callback||promise.resolve;_this.startRender(test);function test(){if(!!object[key]){callback();_this.stopRender(test)}}return promise};this.flag=function(name,value,time){if(typeof value!=="undefined"){_active[name]=value;if(time){this.delayedCall(function(){_active[name]=!_active[name]},time)}}else{return _active[name]}};this.destroy=function(){if(this.removeDispatch)this.removeDispatch();if(this.onDestroy)this.onDestroy();for(var id in this.classes){var clss=this.classes[id];if(clss&&clss.destroy)clss.destroy()}this.classes=null;this.clearRenders&&this.clearRenders();this.clearTimers&&this.clearTimers();if(this.events)this.events=this.events.destroy();if(this.parent&&this.parent.__destroyChild)this.parent.__destroyChild(this.__id);return Utils.nullObject(this)};this.__destroyChild=function(name){delete this.classes[name]}});Class(function Model(){Inherit(this,Component);Namespace(this);var _this=this;var _storage={};var _data=0;var _triggered=0;this.push=function(name,val){_storage[name]=val};this.pull=function(name){return _storage[name]};this.waitForData=this.promiseData=function(){var num=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;_data+=num};this.fulfillData=this.resolveData=function(){_triggered++;if(_triggered==_data){_this.dataReady=true}};this.ready=function(callback){var promise=Promise.create();if(callback)promise.then(callback);_this.wait(_this,"dataReady").then(promise.resolve);return promise};this.initWithData=function(data){_this.STATIC_DATA=data;for(var key in _this){var model=_this[key];var init=false;for(var i in data){if(i.toLowerCase().replace(/-/g,"")==key.toLowerCase()){init=true;if(model.init)model.init(data[i])}}if(!init&&model.init)model.init()}_this.init&&_this.init(data)};this.loadData=function(url,callback){var promise=Promise.create();if(!callback)callback=promise.resolve;var _this=this;get(url+"?"+Utils.timestamp()).then(function(d){defer(function(){_this.initWithData(d);callback(d)})});return promise}});Class(function Modules(){var _modules={};(function(){defer(exec)}());function exec(){for(var m in _modules){for(var key in _modules[m]){var module=_modules[m][key];if(module._ready)continue;module._ready=true;if(module.exec)module.exec()}}}function requireModule(root,path){var module=_modules[root];if(!module)throw"Module "+root+" not found";module=module[path];if(!module._ready){module._ready=true;if(module.exec)module.exec()}return module}this.Module=function(module){var m=new module;var name=module.toString().slice(0,100).match(/function ([^\(]+)/);if(name){m._ready=true;name=name[1];_modules[name]={index:m}}else{if(!_modules[m.module])_modules[m.module]={};_modules[m.module][m.path]=m}};this.require=function(path){var root=void 0;if(!path.includes("/")){root=path;path="index"}else{root=path.split("/")[0];path=path.replace(root+"/","")}return requireModule(root,path).exports};window.Module=this.Module;if(!window._NODE_||window.EJECTA){window.requireNative=window.require;window.require=this.require}},"Static");Class(function LinkedList(){var prototype=LinkedList.prototype;this.length=0;this.first=null;this.last=null;this.current=null;this.prev=null;if(typeof prototype.push!=="undefined")return;prototype.push=function(obj){if(!this.first){this.first=obj;this.last=obj;obj.__prev=obj;obj.__next=obj}else{obj.__next=this.first;obj.__prev=this.last;this.last.__next=obj;this.last=obj}this.length++};prototype.remove=function(obj){if(!obj||!obj.__next)return;if(this.length<=1){this.empty()}else{if(obj==this.first){this.first=obj.__next;this.last.__next=this.first;this.first.__prev=this.last}else if(obj==this.last){this.last=obj.__prev;this.last.__next=this.first;this.first.__prev=this.last}else{obj.__prev.__next=obj.__next;obj.__next.__prev=obj.__prev}this.length--}obj.__prev=null;obj.__next=null};prototype.empty=function(){this.first=null;this.last=null;this.current=null;this.prev=null;this.length=0};prototype.start=function(){this.current=this.first;this.prev=this.current;return this.current};prototype.next=function(){if(!this.current)return;this.current=this.current.__next;if(this.length==1||this.prev.__next==this.first)return;this.prev=this.current;return this.current};prototype.destroy=function(){Utils.nullObject(this);return null}});Class(function ObjectPool(_type){var _number=arguments.length>1&&arguments[1]!==undefined?arguments[1]:10;var _pool=[];this.array=_pool;(function(){if(_type)for(var i=0;i<_number;i++){_pool.push(new _type)}}());this.get=function(){return _pool.shift()||(_type?new _type:null)};this.empty=function(){_pool.length=0};this.put=function(obj){if(obj)_pool.push(obj)};this.insert=function(array){if(typeof array.push==="undefined")array=[array];for(var i=0;i<array.length;i++){_pool.push(array[i])}};this.length=function(){return _pool.length};this.destroy=function(){for(var i=_pool.length-1;i>=0;i--){if(_pool[i].destroy)_pool[i].destroy()}return _pool=null}});Hydra.ready(function(){window.__window=$(window);window.__document=$(document);window.__body=$(document.getElementsByTagName("body")[0]);window.Stage=!!window.Stage.style?$(window.Stage):__body.create("#Stage");Stage.size("100%");Stage.__useFragment=true;Stage.width=document.body.clientWidth||document.documentElement.offsetWidth||window.innerWidth;Stage.height=document.body.clientHeight||document.documentElement.offsetHeight||window.innerHeight});Class(function CSS(){var _this=this;var _obj,_style,_needsUpdate;Hydra.ready(function(){_style="";_obj=document.createElement("style");_obj.type="text/css";document.getElementsByTagName("head")[0].appendChild(_obj)});function objToCSS(key){var match=key.match(/[A-Z]/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex);key=start+"-"+end.toLowerCase()}return key}function cssToObj(key){var match=key.match(/\-/);var camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex);var end=key.slice(camelIndex).slice(1);var letter=end.charAt(0);end=end.slice(1);end=letter.toUpperCase()+end;key=start+end}return key}function setHTML(){_obj.innerHTML=_style;_needsUpdate=false}this._read=function(){return _style};this._write=function(css){_style=css;if(!_needsUpdate){_needsUpdate=true;defer(setHTML)}};this.style=function(selector,obj){var s=selector+" {";for(var key in obj){var prop=objToCSS(key);var val=obj[key];if(typeof val!=="string"&&key!="opacity")val+="px";s+=prop+":"+val+"!important;"}s+="}";_this._write(_style+s)};this.get=function(selector,prop){var values=new Object;var string=_obj.innerHTML.split(selector+" {");for(var i=0;i<string.length;i++){var str=string[i];if(!str.length)continue;var split=str.split("!important;");for(var j in split){if(split[j].includes(":")){var fsplit=split[j].split(":");if(fsplit[1].slice(-2)=="px"){fsplit[1]=Number(fsplit[1].slice(0,-2))}values[cssToObj(fsplit[0])]=fsplit[1]}}}if(!prop)return values;else return values[prop]};this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""});__body.addChild($clone);var width=$clone.div.offsetWidth;var height=$clone.div.offsetHeight;$clone.remove();return{width:width,height:height}};this.prefix=function(style){return _this.styles.vendor==""?style.charAt(0).toLowerCase()+style.slice(1):_this.styles.vendor+style};this._toCSS=objToCSS},"Static");Class(function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList;this.__useFragment=_useFragment;this._initSelector(_selector,_type,_exists)},function(){var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&typeof _selector!=="string"){this.div=_selector}else{var first=_selector?_selector.charAt(0):null;var name=_selector?_selector.slice(1):null;if(first!="."&&first!="#"){name=_selector;first="."}if(!_exists){this._type=_type||"div";if(this._type=="svg"){this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type);this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")}else{this.div=document.createElement(this._type);if(first){if(first=="#")this.div.id=name;else this.div.className=name}}}else{if(first!="#")throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}}this.div.hydraObject=this};prototype.add=function(child){var div=this.div;var createFrag=function createFrag(){if(this.__useFragment){if(!this._fragment){this._fragment=document.createDocumentFragment();var _this=this;defer(function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment);_this._fragment=null})}div=this._fragment}};if(child.element&&child.element instanceof HydraObject){createFrag();div.appendChild(child.element.div);this._children.push(child.element);child.element._parent=this;child.element.div.parentNode=this.div}else if(child.div){createFrag();div.appendChild(child.div);this._children.push(child);child._parent=this;child.div.parentNode=this.div}else if(child.nodeName){createFrag();div.appendChild(child);child.parentNode=this.div}return this};prototype.clone=function(){return $(this.div.cloneNode(true))};prototype.create=function(name,type){var $obj=$(name,type);this.add($obj);return $obj};prototype.empty=function(){var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this.div.innerHTML="";return this};prototype.parent=function(){return this._parent};prototype.children=function(){return this.div.children?this.div.children:this.div.childNodes};prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){};if(!keep)this._children.remove(object)};prototype.remove=prototype.destroy=function(){this.removed=true;var parent=this._parent;if(!!(parent&&!parent.removed&&parent.removeChild))parent.removeChild(this,true);var child=this._children.start();while(child){if(child&&child.remove)child.remove();child=this._children.next()}this._children.destroy();this.div.hydraObject=null;Utils.nullObject(this)};window.$=function(selector,type,exists){return new HydraObject(selector,type,exists)};$.fn=HydraObject.prototype});(function(){$.fn.text=function(text){if(typeof text!=="undefined"){if(this.__cacheText!=text)this.div.textContent=text;this.__cacheText=text;return this}else{return this.div.textContent}};$.fn.html=function(text,force){if(text&&!text.includes("<")&&!force)return this.text(text);if(typeof text!=="undefined"){this.div.innerHTML=text;return this}else{return this.div.innerHTML}};$.fn.hide=function(){this.div.style.display="none";return this};$.fn.show=function(){this.div.style.display="";return this};$.fn.visible=function(){this.div.style.visibility="visible";return this};$.fn.invisible=function(){this.div.style.visibility="hidden";return this};$.fn.setZ=function(z){this.div.style.zIndex=z;return this};$.fn.clearAlpha=function(){this.div.style.opacity="";return this};$.fn.size=function(w,h,noScale){if(typeof w==="string"){if(typeof h==="undefined")h="100%";else if(typeof h!=="string")h=h+"px";this.div.style.width=w;this.div.style.height=h}else{this.div.style.width=w+"px";this.div.style.height=h+"px";if(!noScale)this.div.style.backgroundSize=w+"px "+h+"px"}this.width=w;this.height=h;return this};$.fn.mouseEnabled=function(bool){this.div.style.pointerEvents=bool?"auto":"none";return this};$.fn.fontStyle=function(family,size,color,style){var font={};if(family)font.fontFamily=family;if(size)font.fontSize=size;if(color)font.color=color;if(style)font.fontStyle=style;this.css(font);return this};$.fn.bg=function(src,x,y,repeat){if(!src)return this;if(src.includes("."))src=Assets.getPath(src);if(!src.includes("."))this.div.style.backgroundColor=src;else this.div.style.backgroundImage="url("+src+")";if(typeof x!=="undefined"){x=typeof x=="number"?x+"px":x;y=typeof y=="number"?y+"px":y;this.div.style.backgroundPosition=x+" "+y}if(repeat){this.div.style.backgroundSize="";this.div.style.backgroundRepeat=repeat}if(x=="cover"||x=="contain"){this.div.style.backgroundSize=x;this.div.style.backgroundPosition=typeof y!="undefined"?y+" "+repeat:"center"}return this};$.fn.center=function(x,y,noPos){var css={};if(typeof x==="undefined"){css.left="50%";css.top="50%";css.marginLeft=-this.width/2;css.marginTop=-this.height/2}else{if(x){css.left="50%";css.marginLeft=-this.width/2}if(y){css.top="50%";css.marginTop=-this.height/2}}if(noPos){delete css.left;delete css.top}this.css(css);return this};$.fn.mask=function(arg){this.div.style[CSS.prefix("Mask")]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat";this.div.style[CSS.prefix("MaskSize")]="contain";return this};$.fn.blendMode=function(mode,bg){if(bg){this.div.style["background-blend-mode"]=mode}else{this.div.style["mix-blend-mode"]=mode}return this};$.fn.css=function(obj,value){if(typeof value=="boolean"){value=null}if((typeof obj==="undefined"?"undefined":_typeof(obj))!=="object"){if(!value){var style=this.div.style[obj];if(typeof style!=="number"){if(style.includes("px"))style=Number(style.slice(0,-2));if(obj=="opacity")style=!isNaN(Number(this.div.style.opacity))?Number(this.div.style.opacity):1}if(!style)style=0;return style}else{this.div.style[obj]=value;return this}}TweenManager._clearCSSTween(this);for(var type in obj){var val=obj[type];if(!(typeof val==="string"||typeof val==="number"))continue;if(typeof val!=="string"&&type!="opacity"&&type!="zIndex")val+="px";this.div.style[type]=val}return this};$.fn.transform=function(props){if(this.multiTween&&this.cssTweens&&this._cssTweens.length>1&&this.__transformTime&&Render.TIME-this.__transformTime<15)return;this.__transformTime=Render.TIME;TweenManager._clearCSSTween(this);if(Device.tween.css2d){if(!props){props=this}else{for(var key in props){if(typeof props[key]==="number")this[key]=props[key]}}var transformString=TweenManager._parseTransform(props);if(this.__transformCache!=transformString){this.div.style[CSS.styles.vendorTransform]=transformString;this.__transformCache=transformString}}return this};$.fn.willChange=function(props){if(typeof props==="boolean"){if(props===true)this._willChangeLock=true;else this._willChangeLock=false}else{if(this._willChangeLock)return}var string=typeof props==="string";if((!this._willChange||string)&&typeof props!=="null"){this._willChange=true;this.div.style["will-change"]=string?props:CSS.transformProperty+", opacity"}else{this._willChange=false;this.div.style["will-change"]=""}};$.fn.backfaceVisibility=function(visible){if(visible)this.div.style[CSS.prefix("BackfaceVisibility")]="visible";else this.div.style[CSS.prefix("BackfaceVisibility")]="hidden"};$.fn.enable3D=function(perspective,x,y){if(!Device.tween.css3d)return this;this.div.style[CSS.prefix("TransformStyle")]="preserve-3d";if(perspective)this.div.style[CSS.prefix("Perspective")]=perspective+"px";if(typeof x!=="undefined"){x=typeof x==="number"?x+"px":x;y=typeof y==="number"?y+"px":y;this.div.style[CSS.prefix("PerspectiveOrigin")]=x+" "+y}return this};$.fn.disable3D=function(){this.div.style[CSS.prefix("TransformStyle")]="";this.div.style[CSS.prefix("Perspective")]="";return this};$.fn.transformPoint=function(x,y,z){var origin="";if(typeof x!=="undefined")origin+=typeof x==="number"?x+"px ":x+" ";if(typeof y!=="undefined")origin+=typeof y==="number"?y+"px ":y+" ";if(typeof z!=="undefined")origin+=typeof z==="number"?z+"px":z;this.div.style[CSS.prefix("TransformOrigin")]=origin;return this};$.fn.tween=function(props,time,ease,delay,callback,manual){if(typeof delay==="boolean"){manual=delay;delay=0;callback=null}else if(typeof delay==="function"){callback=delay;delay=0}if(typeof callback==="boolean"){manual=callback;callback=null}if(!delay)delay=0;var usePromise=null;if(callback&&callback instanceof Promise){usePromise=callback;callback=callback.resolve}var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween};$.fn.clearTransform=function(){if(typeof this.x==="number")this.x=0;if(typeof this.y==="number")this.y=0;if(typeof this.z==="number")this.z=0;if(typeof this.scale==="number")this.scale=1;if(typeof this.scaleX==="number")this.scaleX=1;if(typeof this.scaleY==="number")this.scaleY=1;if(typeof this.rotation==="number")this.rotation=0;if(typeof this.rotationX==="number")this.rotationX=0;if(typeof this.rotationY==="number")this.rotationY=0;if(typeof this.rotationZ==="number")this.rotationZ=0;if(typeof this.skewX==="number")this.skewX=0;if(typeof this.skewY==="number")this.skewY=0;this.div.style[CSS.styles.vendorTransform]="";return this};$.fn.clearTween=function(){if(this._cssTween)this._cssTween.stop();if(this._mathTween)this._mathTween.stop();return this};$.fn.stopTween=function(){console.warn(".stopTween deprecated. use .clearTween instead");return this.clearTween()};$.fn.keypress=function(callback){this.div.onkeypress=function(e){e=e||window.event;e.code=e.keyCode?e.keyCode:e.charCode;if(callback)callback(e)}};$.fn.keydown=function(callback){this.div.onkeydown=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.keyup=function(callback){this.div.onkeyup=function(e){e=e||window.event;e.code=e.keyCode;if(callback)callback(e)}};$.fn.attr=function(attr,value){if(attr&&value){if(value=="")this.div.removeAttribute(attr);else this.div.setAttribute(attr,value)}else if(attr){return this.div.getAttribute(attr)}return this};$.fn.val=function(value){if(typeof value==="undefined"){return this.div.value}else{this.div.value=value}return this};$.fn.change=function(callback){var _this=this;if(this._type=="select"){this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})}}};$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id);var svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'">'+'<use xlink:href="#'+config.id+'" x="0" y="0" />'+"</svg>";this.html(svgHTML,true)};$.fn.overflowScroll=function(dir){if(!Device.mobile)return;var x=!!dir.x;var y=!!dir.y;var overflow={"-webkit-overflow-scrolling":"touch"};if(!x&&!y||x&&y)overflow.overflow="scroll";if(!x&&y){overflow.overflowY="scroll";overflow.overflowX="hidden"}if(x&&!y){overflow.overflowX="scroll";overflow.overflowY="hidden"}this.css(overflow);Mobile._addOverflowScroll(this)};$.fn.removeOverflowScroll=function(){if(!Device.mobile)return;this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""});Mobile._removeOverflowScroll(this)}}());(function(){var windowsPointer=!!window.MSGesture;var translateEvent=function translateEvent(evt){if(windowsPointer){switch(evt){case"touchstart":return"pointerdown";break;case"touchmove":return"MSGestureChange";break;case"touchend":return"pointerup";break}}return evt};var convertTouchEvent=function convertTouchEvent(e){var touchEvent={};touchEvent.x=0;touchEvent.y=0;if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches){if(e.touches.length){touchEvent.x=e.touches[0].pageX;touchEvent.y=e.touches[0].pageY}else{touchEvent.x=e.changedTouches[0].pageX;touchEvent.y=e.changedTouches[0].pageY}}else{touchEvent.x=e.pageX;touchEvent.y=e.pageY}if(Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(window.orientation==90||window.orientation===0){var x=touchEvent.y;touchEvent.y=touchEvent.x;touchEvent.x=Stage.width-x}if(window.orientation==-90||window.orientation===180){var y=touchEvent.x;touchEvent.x=touchEvent.y;touchEvent.y=Stage.height-y}}return touchEvent};$.fn.click=function(callback){var _this=this;function click(e){if(!_this.div)return false;if(Mouse._preventClicks)return false;e.object=_this.div.className=="hit"?_this.parent():_this;e.action="click";if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}this.div.addEventListener(translateEvent("click"),click,true);this.div.style.cursor="pointer";return this};$.fn.hover=function(callback){var _this=this;var _over=false;var _time;function hover(e){if(!_this.div)return false;var time=performance.now();var original=e.toElement||e.relatedTarget;if(_time&&time-_time<5){_time=time;return false}_time=time;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mouseout":e.action="out";break;case"mouseleave":e.action="out";break;default:e.action="over";break}if(_over){if(Mouse._preventClicks)return false;if(e.action=="over")return false;if(e.action=="out"){if(isAChild(_this.div,original))return false}_over=false}else{if(e.action=="out")return false;_over=true}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}function isAChild(div,object){var len=div.children.length-1;for(var i=len;i>-1;i--){if(object==div.children[i])return true}for(i=len;i>-1;i--){if(isAChild(div.children[i],object))return true}}this.div.addEventListener(translateEvent("mouseover"),hover,true);this.div.addEventListener(translateEvent("mouseout"),hover,true);return this};$.fn.press=function(callback){var _this=this;function press(e){if(!_this.div)return false;e.object=_this.div.className=="hit"?_this.parent():_this;switch(e.type){case"mousedown":e.action="down";break;default:e.action="up";break}if(!e.pageX){e.pageX=e.clientX;e.pageY=e.clientY}if(callback)callback(e)}this.div.addEventListener(translateEvent("mousedown"),press,true);this.div.addEventListener(translateEvent("mouseup"),press,true);return this};$.fn.bind=function(evt,callback){this._events=this._events||{};if(windowsPointer&&this==__window){return Stage.bind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.bind("mousemove",callback);else evt="mousemove"}if(windowsPointer&&!this.div.msGesture){this.div.msGesture=new MSGesture;this.div.msGesture.target=this.div}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.bind("mouseup",callback);else evt="mouseup"}}this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt];var e={};var target=this.div;e.callback=callback;e.target=this.div;_events.push(e);function touchEvent(e){if(windowsPointer&&target.msGesture&&evt=="touchstart"){target.msGesture.addPointer(e.pointerId)}var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;e={};e.x=Number(windowsEvt.pageX||windowsEvt.clientX);e.y=Number(windowsEvt.pageY||windowsEvt.clientY);e.target=windowsEvt.target;e.currentTarget=windowsEvt.currentTarget;e.path=[];var node=e.target;while(node){e.path.push(node);node=node.parentElement||null}e.windowsPointer=true}else{e.x=touch.x;e.y=touch.y}for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.target==e.currentTarget){ev.callback(e)}}}if(!this._events["fn_"+evt]){this._events["fn_"+evt]=touchEvent;this.div.addEventListener(translateEvent(evt),touchEvent,true)}return this};$.fn.unbind=function(evt,callback){this._events=this._events||{};if(windowsPointer&&this==__window){return Stage.unbind(evt,callback)}if(evt=="touchstart"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousedown",callback);else evt="mousedown"}}else if(evt=="touchmove"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mousemove",callback);else evt="mousemove"}}else if(evt=="touchend"){if(!Device.mobile){if(Device.touchCapable)this.unbind("mouseup",callback);else evt="mouseup"}}var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++){var ev=_events[i];if(ev.callback==callback)_events.splice(i,1)}if(this._events["fn_"+evt]&&!_events.length){this.div[Hydra.removeEvent](translateEvent(evt),this._events["fn_"+evt],Device.mobile?{passive:true}:true);this._events["fn_"+evt]=null}return this};$.fn.interact=function(overCallback,clickCallback){if(!this.hit){this.hit=$(".hit");this.hit.css({width:"100%",height:"100%",zIndex:99999,top:0,left:0,position:"absolute"});this.add(this.hit)}if(!Device.mobile)this.hit.hover(overCallback).click(clickCallback);else this.hit.touchClick(overCallback,clickCallback)};$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _this=this;var _distance=distance||75;var _startX,_startY;var _moving=false;var _move={};if(Device.mobile){this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true});this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:true})}function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return false;if(e.touches.length==1){_startX=touch.x;_startY=touch.y;_moving=true;_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true})}}function touchMove(e){if(!_this.div)return false;if(_moving){var touch=convertTouchEvent(e);var dx=_startX-touch.x;var dy=_startY-touch.y;_move.direction=null;_move.moving=null;_move.x=null;_move.y=null;_move.evt=e;if(Math.abs(dx)>=_distance){touchEnd();if(dx>0){_move.direction="left"}else{_move.direction="right"}}else if(Math.abs(dy)>=_distance){touchEnd();if(dy>0){_move.direction="up"}else{_move.direction="down"}}else{_move.moving=true;_move.x=dx;_move.y=dy}if(callback)callback(_move,e)}}function touchEnd(e){if(!_this.div)return false;_startX=_startY=_moving=false;_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}return this};$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _this=this;var _time,_move;var _start={};var _touch={};if(Device.mobile){this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:true});this.div.addEventListener(translateEvent("touchstart"),touchStart,{passive:true});this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:true})}function findDistance(p1,p2){var dx=p2.x-p1.x;var dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}function touchMove(e){if(!_this.div)return false;_touch=convertTouchEvent(e);if(findDistance(_start,_touch)>5){_move=true}else{_move=false}}function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x;e.touchY=touch.y;_start.x=e.touchX;_start.y=e.touchY}function touchStart(e){if(!_this.div)return false;_time=performance.now();e.action="over";e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(hover&&!_move)hover(e)}function touchEnd(e){if(!_this.div)return false;var time=performance.now();var clicked=false;e.object=_this.div.className=="hit"?_this.parent():_this;setTouch(e);if(_time&&time-_time<750){if(Mouse._preventClicks)return false;if(click&&!_move){clicked=true;e.action="click";if(click&&!_move)click(e);if(Mouse.autoPreventClicks)Mouse.preventClicks()}}if(hover){e.action="out";if(!Mouse._preventFire)hover(e)}_move=false}return this}}());Class(function Element(){Inherit(this,Component);var name=Utils.getConstructorName(this);this.element=$("."+name);this.element.__useFragment=true;this.destroy=function(){if(this.element&&this.element.remove)this.element=this.element.remove();this._destroy()}});(function(){Hydra.ready(function(){TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"];TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}];TweenManager.useCSSTrans=function(props,ease,object){if(props.math)return false;if(typeof ease==="string"&&ease.includes(["Elastic","Bounce"]))return false;if(object.multiTween||TweenManager._inspectEase(ease).path)return false;if(!Device.tween.transition)return false;return true};TweenManager._detectTween=function(object,props,time,ease,delay,callback){if(!TweenManager.useCSSTrans(props,ease,object)){return new FrameTween(object,props,time,ease,delay,callback)}else{return new CSSTransition(object,props,time,ease,delay,callback)}};TweenManager._parseTransform=function(props){var transforms="";var translate="";if(props.perspective>0)transforms+="perspective("+props.perspective+"px)";if(typeof props.x!=="undefined"||typeof props.y!=="undefined"||typeof props.z!=="undefined"){var x=props.x||0;var y=props.y||0;var z=props.z||0;translate+=x+"px, ";translate+=y+"px";if(Device.tween.css3d){translate+=", "+z+"px";transforms+="translate3d("+translate+")"}else{transforms+="translate("+translate+")"}}if(typeof props.scale!=="undefined"){transforms+="scale("+props.scale+")"}else{if(typeof props.scaleX!=="undefined")transforms+="scaleX("+props.scaleX+")";if(typeof props.scaleY!=="undefined")transforms+="scaleY("+props.scaleY+")"}if(typeof props.rotation!=="undefined")transforms+="rotate("+props.rotation+"deg)";if(typeof props.rotationX!=="undefined")transforms+="rotateX("+props.rotationX+"deg)";if(typeof props.rotationY!=="undefined")transforms+="rotateY("+props.rotationY+"deg)";if(typeof props.rotationZ!=="undefined")transforms+="rotateZ("+props.rotationZ+"deg)";if(typeof props.skewX!=="undefined")transforms+="skewX("+props.skewX+"deg)";if(typeof props.skewY!=="undefined")transforms+="skewY("+props.skewY+"deg)";return transforms};TweenManager._clearCSSTween=function(obj){if(obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween){obj.div.style[CSS.styles.vendorTransition]="";obj.div._transition=false;obj._cssTween=null}};TweenManager._isTransform=function(key){var index=TweenManager.Transforms.indexOf(key);return index>-1};TweenManager._getAllTransforms=function(object){var obj={};for(var i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i];var val=object[tf];if(val!==0&&typeof val==="number"){obj[tf]=val}}return obj};var prefix=function(){var pre="";var dom="";if(window._NODE_||window._GLES_){pre="webkit";dom="WebKit"}else{var styles=window.getComputedStyle(document.documentElement,"");pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||styles.OLink===""&&["","o"])[1];dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1]}return{unprefixed:Device.system.browser=="ie"&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:(Device.system.browser=="ie"?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}();CSS.styles={};CSS.styles.vendor=prefix.unprefixed?"":prefix.js;CSS.styles.vendorTransition=CSS.styles.vendor.length?CSS.styles.vendor+"Transition":"transition";CSS.styles.vendorTransform=CSS.styles.vendor.length?CSS.styles.vendor+"Transform":"transform";CSS.vendor=prefix.css;CSS.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";break;case"webkit":return"-webkit-transform";break;case"o":return"-o-transform";break;case"ms":return"-ms-transform";break;default:return"transform";break}}();CSS.tween={};CSS.tween.complete=function(){if(prefix.unprefixed)return"transitionend";return prefix.lowercase+"TransitionEnd"}()})}());Class(function CSSTransition(_object,_props,_time,_ease,_delay,_callback){var _this=this;var _transformProps=void 0,_transitionProps=void 0;this.playing=true;(function(){if(typeof _time!=="number")throw"CSSTween Requires object, props, time, ease";initProperties();initCSSTween()}());function killed(){return!_this||_this.kill||!_object||!_object.div}function initProperties(){var transform=TweenManager._getAllTransforms(_object);var properties=[];for(var key in _props){if(TweenManager._isTransform(key)){transform.use=true;transform[key]=_props[key];delete _props[key]}else{if(typeof _props[key]==="number"||key.includes("-"))properties.push(key)}}if(transform.use){properties.push(CSS.transformProperty);delete transform.use}_transformProps=transform;_transitionProps=properties}function initCSSTween(values){if(killed())return;if(_object._cssTween)_object._cssTween.kill=true;_object._cssTween=_this;_object.div._transition=true;var strings=buildStrings(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time;var delay=values?values.delay:_delay;var props=values?values.props:_props;var transformProps=values?values.transform:_transformProps;Timer.create(function(){if(killed())return;_object.div.style[CSS.styles.vendorTransition]=strings.transition;_this.playing=true;if(Device.system.browser=="safari"){Timer.create(function(){if(killed())return;_object.css(props);_object.transform(transformProps)},16)}else{_object.css(props);_object.transform(transformProps)}Timer.create(function(){if(killed())return;clearCSSTween();if(_callback)_callback()},time+delay)},50)}function buildStrings(time,ease,delay){var props="";var str="";var len=_transitionProps.length;for(var i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp;str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}function clearCSSTween(){if(killed())return;_this.playing=false;_object._cssTween=null;_object.willChange(null);_object=_props=null;Utils.nullObject(this)}function tweenComplete(){if(!_callback&&_this.playing)clearCSSTween()}this.stop=function(){if(!this.playing)return;this.kill=true;this.playing=false;_object.div.style[CSS.styles.vendorTransition]="";_object.div._transition=false;_object.willChange(null);_object._cssTween=null;Utils.nullObject(this)};this.onComplete=function(callback){_callback=callback;return this}});Class(function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _this=this;var _endValues,_transformEnd,_transformStart,_startValues;var _isTransform,_isCSS,_transformProps;var _cssTween,_transformTween,_update;this.playing=true;(function(){if((typeof _ease==="undefined"?"undefined":_typeof(_ease))==="object")_ease="easeOutCubic";if(_object&&_props){if(typeof _time!=="number")throw"FrameTween Requires object, props, time, ease";initValues();startTween()}}());function killed(){return _this.kill||!_object||!_object.div}function initValues(){if(_props.math)delete _props.math;if(Device.tween.transition&&_object.div._transition){_object.div.style[CSS.styles.vendorTransition]="";_object.div._transition=false}_endValues={};_transformEnd={};_transformStart={};_startValues={};if(!_object.multiTween){if(typeof _props.x==="undefined")_props.x=_object.x;if(typeof _props.y==="undefined")_props.y=_object.y;if(typeof _props.z==="undefined")_props.z=_object.z}for(var key in _props){if(key.includes(["damping","spring"])){_endValues[key]=_props[key];_transformEnd[key]=_props[key];continue}if(TweenManager._isTransform(key)){_isTransform=true;_transformStart[key]=_object[key]||(key=="scale"?1:0);_transformEnd[key]=_props[key]}else{_isCSS=true;var v=_props[key];if(typeof v==="string"){_object.div.style[key]=v}else if(typeof v==="number"){_startValues[key]=Number(_object.css(key));_endValues[key]=v}}}}function startTween(){if(_object._cssTween&&!_manual&&!_object.multiTween)_object._cssTween.kill=true;if(_object.multiTween){if(!_object._cssTweens)_object._cssTweens=[];_object._cssTweens.push(_this)}_object._cssTween=_this;_this.playing=true;_props=copy(_startValues);_transformProps=copy(_transformStart);if(_isCSS)_cssTween=tween(_props,_endValues,_time,_ease,_delay,_manual).onUpdate(update).onComplete(tweenComplete);if(_isTransform)_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,_manual).onComplete(!_isCSS?tweenComplete:null).onUpdate(!_isCSS?update:null)}function copy(obj){var newObj={};for(var key in obj){if(typeof obj[key]==="number")newObj[key]=obj[key]}return newObj}function clear(){if(_object._cssTweens){_object._cssTweens.remove(_this)}_this.playing=false;_object._cssTween=null;_object=_props=null}function update(){if(killed())return;if(_isCSS)_object.css(_props);if(_isTransform){if(_object.multiTween){for(var key in _transformProps){if(typeof _transformProps[key]==="number")_object[key]=_transformProps[key]}_object.transform()}else{_object.transform(_transformProps)}}if(_update)_update()}function tweenComplete(){if(_this.playing){clear();if(_callback)_callback()}}this.stop=function(){if(!this.playing)return;if(_cssTween&&_cssTween.stop)_cssTween.stop();if(_transformTween&&_transformTween.stop)_transformTween.stop();clear()};this.interpolate=function(elapsed){if(_cssTween)_cssTween.interpolate(elapsed);if(_transformTween)_transformTween.interpolate(elapsed);update()};this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}};this.setEase=function(ease){if(_cssTween)_cssTween.setEase(ease);if(_transformTween)_transformTween.setEase(ease)};this.onUpdate=function(){return this};this.onComplete=function(callback){_callback=callback;return this}});Class(function Interaction(_object){Inherit(this,Events);var _this=this;function Vec2(){this.x=0;this.y=0;this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}this.x=0;this.y=0;this.hold=new Vec2;this.last=new Vec2;this.delta=new Vec2;this.move=new Vec2;this.velocity=new Vec2;var _distance=void 0,_timeDown=void 0,_timeMove=void 0;(function(){if(!_object instanceof HydraObject)throw"Interaction.Input requires a HydraObject";addHandlers()}());function addHandlers(){if(_object==Stage||_object==__window)Interaction.bind("touchstart",down);else _object.bind("touchstart",down);Interaction.bind("touchmove",move);Interaction.bind("touchend",up)}function down(e){_this.isTouching=true;_this.x=e.x;_this.y=e.y;_this.hold.x=_this.last.x=e.x;_this.hold.y=_this.last.y=e.y;_this.delta.x=_this.move.x=_this.velocity.x=0;_this.delta.y=_this.move.y=_this.velocity.y=0;_distance=0;_this.events.fire(Interaction.START,e,true);_timeDown=_timeMove=Render.TIME}function move(e){if(_this.isTouching){_this.move.x=e.x-_this.hold.x;_this.move.y=e.y-_this.hold.y}_this.x=e.x;_this.y=e.y;_this.delta.x=e.x-_this.last.x;_this.delta.y=e.y-_this.last.y;_this.last.x=e.x;_this.last.y=e.y;_distance+=_this.delta.length();var delta=Math.max(.001,Render.TIME-(_timeMove||Render.TIME));_timeMove=Render.TIME;_this.velocity.x=Math.abs(_this.delta.x)/delta;_this.velocity.y=Math.abs(_this.delta.y)/delta;_this.events.fire(Interaction.MOVE,e,true);if(_this.isTouching)_this.events.fire(Interaction.DRAG,e,true)}function up(e){_this.isTouching=false;_this.move.x=0;_this.move.y=0;var delta=Math.max(.001,Render.TIME-(_timeMove||Render.TIME));if(delta>100){_this.delta.x=0;_this.delta.y=0}_this.events.fire(Interaction.END,e,true);if(_distance<20&&Render.TIME-_timeDown<2e3){_this.events.fire(Interaction.CLICK,e,true)}}this.destroy=function(){Interaction.unbind("touchstart",down);Interaction.unbind("touchmove",move);Interaction.unbind("touchend",up);_object&&_object.unbind&&_object.unbind("touchstart",down);return this._destroy&&this._destroy()}},function(){Namespace(Interaction);Interaction.CLICK="interaction_click";Interaction.START="interaction_start";Interaction.MOVE="interaction_move";Interaction.DRAG="interaction_drag";Interaction.END="interaction_end";var _events={touchstart:[],touchmove:[],touchend:[]};Hydra.ready(function(){__window.bind("touchstart",touchStart);__window.bind("touchmove",touchMove);__window.bind("touchend",touchEnd);__window.bind("touchcancel",touchEnd);__window.bind("contextmenu",touchEnd)});function touchMove(e){_events.touchmove.forEach(function(c){return c(e)})}function touchStart(e){_events.touchstart.forEach(function(c){return c(e)})}function touchEnd(e){_events.touchend.forEach(function(c){return c(e)})}Interaction.bind=function(evt,callback){_events[evt].push(callback)};Interaction.unbind=function(evt,callback){_events[evt].remove(callback)}});Class(function Mouse(){Inherit(this,Events);var _this=this;this.x=0;this.y=0;this.perc={x:0,y:0};this.tilt={x:0,y:0};this.resetOnRelease=false;(function(){Hydra.ready(init)}());function init(){_this.input=new Interaction(__window);_this.events.sub(_this.input,Interaction.START,update);_this.events.sub(_this.input,Interaction.MOVE,update);_this.events.sub(_this.input,Interaction.END,end);_this.hold=_this.input.hold;_this.last=_this.input.last;_this.delta=_this.input.delta;_this.move=_this.input.move;_this.velocity=_this.input.velocity}function update(e){_this.x=e.x;_this.y=e.y;if(!Stage.width||!Stage.height)return;_this.perc.x=e.x/Stage.width;_this.perc.y=e.y/Stage.height;_this.tilt.x=_this.perc.x*2-1;_this.tilt.y=_this.perc.y*2-1}function end(e){if(Device.mobile&&_this.resetOnRelease)update(_this.resetOnRelease)}},"Static");Class(function Assets(){var _this=this;var _fetchCors={mode:"cors"};this.__loaded=[];this.CDN="";this.CORS=null;this.IMAGES={};this.JSON={push:function push(prop,value){this[prop]=value;Object.defineProperty(this,prop,{get:function get(){return JSON.parse(JSON.stringify(value))}})}};this.SVG={};function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path];var ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/");var file=split[split.length-1];split=file.split(".");return path.replace(file,split[0]+"-"+ratio+"x."+split[1])}function AssetList(arr){arr.__proto__=AssetList.prototype;return arr}AssetList.prototype=new Array;AssetList.prototype.filter=function(items){for(var i=this.length-1;i>=0;i--){if(!this[i].includes(items))this.splice(i,1)}return this};AssetList.prototype.exclude=function(items){for(var i=this.length-1;i>=0;i--){if(this[i].includes(items))this.splice(i,1)}return this};AssetList.prototype.prepend=function(prefix){for(var i=this.length-1;i>=0;i--){this[i]=prefix+this[i]}return this};AssetList.prototype.append=function(suffix){for(var i=this.length-1;i>=0;i--){this[i]=this[i]+suffix}return this};this.list=function(){if(!window.ASSETS)console.warn("ASSETS list not available");return new AssetList(window.ASSETS.slice(0)||[])};this.getPath=function(path){if(!!~path.indexOf("//"))return path;path=parseResolution(path);if(this.CDN&&!~path.indexOf(this.CDN))path=this.CDN+path;return path};this.loadImage=function(path,isStore){var img=new Image;img.crossOrigin=this.CORS;img.src=_this.getPath(path);if(isStore)this.IMAGES[path]=img;return img};this.decodeImage=function(path){var promise=Promise.create();if(!!window.createImageBitmap&&Device.system.browser.includes(["chrome"])){var img=_this.loadImage(path);img.onload=function(){createImageBitmap(img,{imageOrientation:"flipY"}).then(function(imgBmp){promise.resolve(imgBmp)})}}else{var _img=_this.loadImage(path);_img.onload=function(){return promise.resolve(_img)}}return promise}},"static");Class(function AssetLoader(_assets,_callback){Inherit(this,Events);var _this=this;var _total=_assets.length;var _loaded=0;(function(){if(!Array.isArray(_assets))throw"AssetLoader requires array of assets to load";_assets=_assets.slice(0).reverse();init()}());function init(){if(!_assets.length)return complete();for(var i=0;i<AssetLoader.SPLIT;i++){if(_assets.length)loadAsset()}}function loadAsset(path){path=_assets.splice(_assets.length-1,1)[0];var name=path.split("assets/").last().split(".")[0];var ext=path.split(".").last().split("?")[0].toLowerCase();var timeout=Timer.create(timedOut,AssetLoader.TIMEOUT,path);if(!!~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){var image=Assets.loadImage(path);if(image.complete)return loaded();image.onload=loaded;image.onerror=loaded;return}get(Assets.getPath(path),Assets.HEADERS).then(function(data){Assets.__loaded.push(path);if(ext=="json")Assets.JSON.push(name,data);if(ext=="svg")Assets.SVG[name]=data;if(ext=="js")window.eval(data);if(ext.includes(["fs","vs","glsl"])&&window.Shaders)Shaders.parse(data,path);loaded()}).catch(function(e){console.warn(e);loaded()});function loaded(){if(timeout)clearTimeout(timeout);increment();if(_assets.length)loadAsset()}}function increment(){_this.events.fire(Events.PROGRESS,{percent:++_loaded/_total});if(_loaded==_total)defer(complete)}function complete(){_callback&&_callback();_this.events.fire(Events.COMPLETE)}function timedOut(path){console.warn("Asset timed out",path)}this.add=function(num){_total+=num||1};this.trigger=function(num){for(var i=0;i<(num||1);i++){increment()}}},function(){AssetLoader.SPLIT=2;AssetLoader.TIMEOUT=5e3;AssetLoader.loadAllAssets=function(callback){var promise=Promise.create();if(!callback)callback=promise.resolve;promise.loader=new AssetLoader(Assets.list(),function(){if(callback)callback();if(promise.loader&&promise.loader.destroy)promise.loader=promise.loader.destroy()});return promise};AssetLoader.waitForLib=function(name,callback){var promise=Promise.create();if(!callback)callback=promise.resolve;var interval=setInterval(function(){if(window[name]){clearInterval(interval);callback&&callback()}},100);return promise}});Class(function Mobile(){Inherit(this,Component);Namespace(this);var _this=this;Hydra.ready(function(){if(!Device.mobile)return;addHandlers();if(Device.system.browser=="safari"&&!Device.mobile.native)__body.css({height:"101%"}).div.scrollTop=0});function addHandlers(){_this.events.sub(Events.RESIZE,resize);if(!Device.mobile.native)window.addEventListener("touchstart",preventNativeScroll,{passive:false})}function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;var target=e.target;if(target.nodeName=="INPUT"||target.nodeName=="TEXTAREA"||target.nodeName=="SELECT"||target.nodeName=="A"||target.dataset.reactid!==undefined)return;var prevent=true;while(target.parentNode&&prevent){if(target._scrollParent)prevent=false;target=target.parentNode}if(prevent)e.preventDefault()}function resize(){updateOrientation();checkResizeRefresh();if(!_this.isAllowNativeScroll)document.body.scrollTop=0}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait";if(!_this.orientationSet)return;if(!window.Fullscreen.isOpen&&!Device.mobile.pwa)return;if(window.screen&&window.screen.orientation.lock)window.screen.orientation.lock(_this.orientationSet)}var checkResizeRefresh=function(){var _lastWidth=void 0;return function(){if(_this.isPreventResizeReload)return;if(_lastWidth==Stage.width)return;_lastWidth=Stage.width;if(Device.system.os!=="ios"&&!(Device.system.os=="android"&&Device.system.version>=7))return;if(Device.mobile.tablet==Math.max(Stage.width,Stage.height)>800)return;window.location.reload()}}();this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)};this.fullscreen=function(){if(!Device.mobile||Device.mobile.native||Device.mobile.pwa||Dev.emulator)return;if(!window.Fullscreen)throw"Mobile.fullscreen requires Fullscreen module";if(Device.system.os!=="android")return;__window.bind("touchend",function(){Fullscreen.open()});if(_this.ScreenLock&&_this.ScreenLock.isActive)window.onresize()};this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];_this.orientationSet=orientation;updateOrientation();if(!isForce)return;if(!_this.ScreenLock)throw"Mobile.setOrientation isForce argument requires ScreenLock module";if(orientation==="any")_this.ScreenLock.unlock();else _this.ScreenLock.lock()};this.allowNativeScroll=function(){_this.isAllowNativeScroll=true};this.preventResizeReload=function(){_this.isPreventResizeReload=true};this._addOverflowScroll=function($obj){$obj.div._scrollParent=true;if(Device.mobile.native)return;$obj.div._preventEvent=function(e){e.stopPropagation()};$obj.bind("touchmove",$obj.div._preventEvent)};this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)};this.get("phone",function(){throw"Mobile.phone is removed. Use Device.mobile.phone"});this.get("tablet",function(){throw"Mobile.tablet is removed. Use Device.mobile.tablet"});this.get("os",function(){throw"Mobile.os is removed. Use Device.system.os"})},"Static");Class(function Dev(){var _this=this;var _post,_alert,_inter,_timerName;var _id=Utils.timestamp();this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]);function catchErrors(){window.onerror=function(message,file,line){var string=message+" ::: "+file+" : "+line;if(_alert)alert(string);if(_post)post(_post+"/api/data/debug",getDebugInfo(string));if(_this.onError)_this.onError(message,file,line)}}function getDebugInfo(string){var obj={};obj.time=(new Date).toString();obj.deviceId=_id;obj.err=string;obj.ua=Device.agent;obj.width=Stage.width;obj.height=Stage.height;obj.screenWidth=screen.width;obj.screenHeight=screen.height;return obj}this.alertErrors=function(url){_alert=true;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.includes(url[i])||location.hash.includes(url[i]))return catchErrors()}};this.postErrors=function(url,post){_post=post;if(typeof url==="string")url=[url];for(var i=0;i<url.length;i++){if(location.href.includes(url[i]))return catchErrors()}};this.expose=function(name,val,force){if(Hydra.LOCAL||force)window[name]=val};this.logServer=function(msg){if(_post)post(_post+"/api/data/debug",getDebugInfo(msg))};this.unsupported=function(needsAlert){if(needsAlert)alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")};this.checkForLeaks=function(flag,array){var matchArray=function matchArray(prop){if(!array)return false;for(var i=0;i<array.length;i++){if(prop.includes(array[i]))return true}return false};clearInterval(_inter);if(flag){_inter=setInterval(function(){for(var prop in window){if(prop.includes("webkit"))continue;var obj=window[prop];if(typeof obj!=="function"&&prop.length>2){if(prop.includes("_ga")||prop.includes("_typeface_js")||matchArray(prop))continue;var char1=prop.charAt(0);var char2=prop.charAt(1);if(char1=="_"||char1=="$"){if(char2!==char2.toUpperCase()){console.log(window[prop]);throw"Hydra Warning:: "+prop+" leaking into global scope"}}}}},1e3)}};this.startTimer=function(name){_timerName=name||"Timer";if(console.time&&!window._NODE_)console.time(_timerName);else _timer=performance.now()};this.stopTimer=function(){if(console.time&&!window._NODE_)console.timeEnd(_timerName);else console.log("Render "+_timerName+": "+(performance.now()-_timer))};if(Hydra.LOCAL)_this.checkForLeaks(true)},"Static");Class(function Service(){Inherit(this,Component);var _this=this;var _sw;this.active=false;this.ready=false;this.cached=false;this.offline=false;this.disabled=false;(function(){Hydra.ready(function(){if("serviceWorker"in navigator&&(!Hydra.LOCAL||location.port!="")&&!window.process&&!_this.disabled)initWorker()})}());function initWorker(){_this.active=true;navigator.serviceWorker.register("sw.js").then(handleRegistration).then(handleReady).then(handleError)}function checkCache(){var cache=Storage.get("service_cache");if(cache!=window._CACHE_)_this.post("clearCache")}function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;assets.forEach(function(asset,i){if(asset.includes(".js"))asset=assets[i].replace(".js",".js?"+window._CACHE_)});return assets}function handleRegistration(e){}function handleReady(e){_this.ready=true;_this.events.fire(Events.READY,e,true);_sw=navigator.serviceWorker.controller;checkCache()}function handleError(e){if(e){_this.events.fire(Events.ERROR,e,true);_this.active=false}}function handleMessage(e){var data=e.data;if(data.evt)_this.events.fire(data.evt,data)}this.cache=function(){var assets=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];assets=Array.from(assets);var upload=function upload(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline});Storage.set("service_cache",window._CACHE_);_this.cached=true};if(_this.active)_this.wait(_this,"ready",upload)};this.post=function(fn){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!_this.active)return;var send=function send(){var mc=new MessageChannel;mc.port1.onmessage=handleMessage;data.fn=fn;_sw&&_sw.postMessage(data,[mc.port2])};_this.wait(_this,"ready",send)}},"static");Class(function Storage(){var _this=this;var _storage;(function(){testStorage()}());function testStorage(){try{if(window.localStorage){try{window.localStorage["test"]=1;window.localStorage.removeItem("test");_storage=true}catch(e){_storage=false}}else{_storage=false}}catch(e){_storage=false}}function cookie(key,value,expires){var options;if(arguments.length>1&&(value===null||(typeof value==="undefined"?"undefined":_typeof(value))!=="object")){options={};options.path="/";options.expires=expires||1;if(value===null){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return root.document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}options=value||{};var result,decode=options.raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.setCookie=function(key,value,expires){cookie(key,value,expires)};this.getCookie=function(key){return cookie(key)};this.set=function(key,value){if(value!=null&&(typeof value==="undefined"?"undefined":_typeof(value))==="object")value=JSON.stringify(value);if(_storage){if(value===null)window.localStorage.removeItem(key);else window.localStorage[key]=value}else{cookie(key,value,365)}};this.get=function(key){var val;if(_storage)val=window.localStorage[key];else val=cookie(key);if(val){var char0;if(val.charAt)char0=val.charAt(0);if(char0=="{"||char0=="[")val=JSON.parse(val);if(val=="true"||val=="false")val=val=="true"?true:false}return val}},"Static");Class(function Thread(_class){Inherit(this,Component);var _this=this;var _worker,_callbacks,_path,_mvc;var _msg={};(function(){init();importClasses();addListeners()}());function init(){var file=window._ES5_?"assets/js/hydra/hydra-thread-es5.js":"assets/js/hydra/hydra-thread.js";_callbacks={};_worker=new Worker(Thread.PATH+file)}function importClasses(){importClass(Utils);importClass(Component);importClass(Events);importClass(_class,true)}function importClass(_class,scoped){if(!_class)return;var code,namespace;if(!scoped){if(typeof _class!=="function"){code=_class.constructor.toString();if(code.includes("[native"))return;namespace=_class.constructor._namespace?_class.constructor._namespace+".":"";code=namespace+"Class("+code+', "static");'}else{namespace=_class._namespace?_class._namespace+".":"";code=namespace+"Class("+_class.toString()+");"}}else{code=_class.toString().replace("{","!!!");code=code.split("!!!")[1];var splitChar=window._MINIFIED_?"=":" ";while(code.includes("this")){var split=code.slice(code.indexOf("this."));var name=split.split("this.")[1].split(splitChar)[0];code=code.replace("this","self");createMethod(name)}code=code.slice(0,-1)}_worker.postMessage({code:code})}function createMethod(name){_this[name]=function(){var message=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var callback=arguments[1];_this.send(name,message,callback)}}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console){console.log(e.data.message)}else if(e.data.id){var callback=_callbacks[e.data.id];if(callback)callback(e.data.message);delete _callbacks[e.data.id]}else if(e.data.emit){var callback=_callbacks[e.data.evt];if(callback)callback(e.data.msg)}else{var callback=_callbacks["transfer"];if(callback)callback(e.data)}}this.on=function(evt,callback){_callbacks[evt]=callback};this.off=function(evt){delete _callbacks[evt]};this.loadFunction=function(){var load=function load(code){code=code.toString();code=code.replace("(","!!!");var split=code.split("!!!");var name=split[0].split(" ")[1];code="self."+name+" = function("+split[1];_worker.postMessage({code:code});createMethod(name)};for(var i=0;i<arguments.length;i++){load(arguments[i])}};this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:true})};this.importClass=function(){for(var i=0;i<arguments.length;i++){var code=arguments[i];importClass(code)}};this.send=function(name,message,callback){if(typeof name==="string"){var fn=name;message=message||{};message.fn=name}else{callback=message;message=name}var id=Utils.timestamp();if(callback)_callbacks[id]=callback;if(message.transfer){message.msg.id=id;message.msg.fn=message.fn;message.msg.transfer=true;_worker.postMessage(message.msg,message.buffer)}else{_msg.message=message;_msg.id=id;_worker.postMessage(_msg)}};this.destroy=function(){if(_worker.terminate)_worker.terminate();if(this._destroy)return this._destroy()}},function(){Thread.PATH="";Thread.absolutePath=function(path){var pathname=location.pathname;if(pathname.includes("/index.html"))pathname=pathname.replace("/index.html","");var port=Number(location.port)>1e3?":"+location.port:"";return path.includes("http")?path:location.protocol+"//"+(location.hostname+port+pathname+"/"+path).replace("//","/")}});Class(function TweenManager(){Namespace(this);var _this=this;var _tweens=[];this.CubicEases=[];(function(){Render.start(updateTweens)}());function updateTweens(time){for(var i=_tweens.length-1;i>=0;i--){var _tween2=_tweens[i];if(_tween2.update)_tween2.update(time);else _this._removeMathTween(_tween2)}}function stringToValues(str){var values=str.split("(")[1].slice(0,-1).split(",");for(var i=0;i<values.length;i++){values[i]=parseFloat(values[i])}return values}function findEase(name){var eases=_this.CubicEases;for(var i=eases.length-1;i>-1;i--){if(eases[i].name==name){return eases[i]}}return false}this._addMathTween=function(tween){_tweens.push(tween)};this._removeMathTween=function(tween){_tweens.remove(tween)};this._getEase=function(name,values){var ease=findEase(name);if(!ease)return false;if(values){return ease.path?ease.path.solve:ease.values}else{return ease.curve}};this._inspectEase=function(name){return findEase(name)};this.tween=function(object,props,time,ease,delay,complete,update,isManual){if(typeof delay!=="number"){update=complete;complete=delay;delay=0}var tween=new MathTween(object,props,time,ease,delay,update,complete,isManual);var usePromise=null;if(complete&&complete instanceof Promise){usePromise=complete;complete=complete.resolve}return usePromise||tween};this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop)object._mathTween.stop();if(object._mathTweens){var tweens=object._mathTweens;for(var i=0;i<tweens.length;i++){var tw=tweens[i];if(tw&&tw.stop)tw.stop()}object._mathTweens=null}};this.addCustomEase=function(ease){var add=true;if((typeof ease==="undefined"?"undefined":_typeof(ease))!=="object"||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--){if(ease.name==_this.CubicEases[i].name){add=false}}if(add){if(ease.curve.charAt(0).toLowerCase()=="m"){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else{ease.values=stringToValues(ease.curve)}_this.CubicEases.push(ease)}return ease};Math.interpolate=function(start,end,alpha,ease){var fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,typeof fn=="function"?fn(alpha):_this.Interpolation.solve(fn,alpha))};window.tween=this.tween;window.clearTween=this.clearTween},"Static");TweenManager.Class(function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getTForX(aX,mX1,mX2){var aGuessT=aX;for(var i=0;i<4;i++){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope==0)return aGuessT;var currentX=calculateBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope}return aGuessT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;break;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;break;case"easeInQuart":return TweenManager.Interpolation.Quart.In;break;case"easeInQuint":return TweenManager.Interpolation.Quint.In;break;case"easeInSine":return TweenManager.Interpolation.Sine.In;break;case"easeInExpo":return TweenManager.Interpolation.Expo.In;break;case"easeInCirc":return TweenManager.Interpolation.Circ.In;break;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;break;case"easeInBack":return TweenManager.Interpolation.Back.In;break;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;break;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;break;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;break;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;break;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;break;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;break;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;break;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;break;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;break;case"easeOutBack":return TweenManager.Interpolation.Back.Out;break;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;break;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;break;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;break;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;break;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;break;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;break;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;break;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;break;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;break;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;break;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;break;case"linear":return TweenManager.Interpolation.Linear.None;break}}();if(!fn){var curve=TweenManager._getEase(ease,true);if(curve)fn=curve;else fn=TweenManager.Interpolation.Cubic.Out}return fn};this.solve=function(values,elapsed){if(values[0]==values[1]&&values[2]==values[3])return elapsed;return calculateBezier(getTForX(elapsed,values[0],values[2]),values[1],values[3])};this.Linear={None:function None(k){return k}};this.Quad={In:function In(k){return k*k},Out:function Out(k){return k*(2-k)},InOut:function InOut(k){if((k*=2)<1)return.5*k*k;return-.5*(--k*(k-2)-1)}};this.Cubic={In:function In(k){return k*k*k},Out:function Out(k){return--k*k*k+1},InOut:function InOut(k){if((k*=2)<1)return.5*k*k*k;return.5*((k-=2)*k*k+2)}};this.Quart={In:function In(k){return k*k*k*k},Out:function Out(k){return 1- --k*k*k*k},InOut:function InOut(k){if((k*=2)<1)return.5*k*k*k*k;return-.5*((k-=2)*k*k*k-2)}};this.Quint={In:function In(k){return k*k*k*k*k},Out:function Out(k){return--k*k*k*k*k+1},InOut:function InOut(k){if((k*=2)<1)return.5*k*k*k*k*k;return.5*((k-=2)*k*k*k*k+2)}};this.Sine={In:function In(k){return 1-Math.cos(k*Math.PI/2)},Out:function Out(k){return Math.sin(k*Math.PI/2)},InOut:function InOut(k){return.5*(1-Math.cos(Math.PI*k))}};this.Expo={In:function In(k){return k===0?0:Math.pow(1024,k-1)},Out:function Out(k){return k===1?1:1-Math.pow(2,-10*k)},InOut:function InOut(k){if(k===0)return 0;if(k===1)return 1;if((k*=2)<1)return.5*Math.pow(1024,k-1);return.5*(-Math.pow(2,-10*(k-1))+2)}};this.Circ={In:function In(k){return 1-Math.sqrt(1-k*k)},Out:function Out(k){return Math.sqrt(1- --k*k)},InOut:function InOut(k){if((k*=2)<1)return-.5*(Math.sqrt(1-k*k)-1);return.5*(Math.sqrt(1-(k-=2)*k)+1)}};this.Elastic={In:function In(k){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var p=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.4;var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function Out(k){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var p=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.4;var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);return a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1},InOut:function InOut(k){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var p=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.4;var s;if(k===0)return 0;if(k===1)return 1;if(!a||a<1){a=1;s=p/4}else s=p*Math.asin(1/a)/(2*Math.PI);if((k*=2)<1)return-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1}};this.Back={In:function In(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function Out(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function InOut(k){var s=1.70158*1.525;if((k*=2)<1)return.5*(k*k*((s+1)*k-s));return.5*((k-=2)*k*((s+1)*k+s)+2)}};this.Bounce={In:function In(k){return 1-this.Bounce.Out(1-k)},Out:function Out(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function InOut(k){if(k<.5)return this.Bounce.In(k*2)*.5;return this.Bounce.Out(k*2-1)*.5+.5}}},"Static");Class(function MathTween(_object,_props,_time,_ease,_delay,_update,_callback,_manual){var _this=this;var _startTime,_startValues,_endValues;var _easeFunction,_paused,_newEase;var _spring,_damping;var _elapsed=0;(function(){if(_object&&_props){if(typeof _time!=="number")throw"MathTween Requires object, props, time, ease";start()}}());function start(){if(!_object.multiTween&&_object._mathTween&&!_manual)TweenManager.clearTween(_object);if(!_manual)TweenManager._addMathTween(_this);_object._mathTween=_this;if(_object.multiTween){if(!_object._mathTweens)_object._mathTweens=[];_object._mathTweens.push(_this)}if(typeof _ease=="string"){_ease=TweenManager.Interpolation.convertEase(_ease);_easeFunction=typeof _ease==="function"}_startTime=performance.now();_startTime+=_delay;_endValues=_props;_startValues={};if(_props.spring)_spring=_props.spring;if(_props.damping)_damping=_props.damping;_this.startValues=_startValues;for(var prop in _endValues){if(typeof _object[prop]==="number")_startValues[prop]=_object[prop]}}function clear(){if(!_object&&!_props)return false;_object._mathTween=null;TweenManager._removeMathTween(_this);Utils.nullObject(_this);if(_object._mathTweens){_object._mathTweens.remove(_this)}}this.update=function(time){if(_paused||time<_startTime)return;_elapsed=(time-_startTime)/_time;_elapsed=_elapsed>1?1:_elapsed;var delta=this.interpolate(_elapsed);if(_update)_update(delta);if(_elapsed==1){if(_callback)_callback();clear()}};this.pause=function(){_paused=true};this.resume=function(){_paused=false;_startTime=performance.now()-_elapsed*_time};this.stop=function(){_this.stopped=true;clear();return null};this.setEase=function(ease){if(_newEase!=ease){_newEase=ease;_ease=TweenManager.Interpolation.convertEase(ease);_easeFunction=typeof _ease==="function"}};this.getValues=function(){return{start:_startValues,end:_endValues}};this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues){if(typeof _startValues[prop]==="number"&&typeof _endValues[prop]==="number"){var start=_startValues[prop];var end=_endValues[prop];_object[prop]=start+(end-start)*delta}}return delta};this.onUpdate=function(callback){_update=callback;return this};this.onComplete=function(callback){_callback=callback;return this}});Class(function TweenTimeline(){Inherit(this,Component);var _this=this;var _tween=void 0;var _total=0;var _tweens=[];this.elapsed=0;function calculate(){_tweens.sort(function(a,b){var ta=a.time+a.delay;var tb=b.time+b.delay;return tb-ta});var first=_tweens[0];_total=first.time+first.delay}function loop(){var time=_this.elapsed*_total;for(var i=_tweens.length-1;i>-1;i--){var t=_tweens[i];var relativeTime=time-t.delay;var elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(TweenTimeline.UPDATE,_this,true)}this.get("timeRemaining",function(){return _total-_this.elapsed*_total});this.add=function(object,props,time,ease,delay){var tween=void 0;if(object instanceof HydraObject)tween=new FrameTween(object,props,time,ease,delay,null,true);else tween=new MathTween(object,props,time,ease,delay,null,null,true);_tweens.push(tween);tween.time=time;tween.delay=delay||0;calculate();return tween};this.tween=function(to,time,ease,delay,callback){_this.clearTween();_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback)};this.clearTween=function(){if(_tween&&_tween.stop)_tween.stop()};this.startRender=function(){Render.start(loop)};this.stopRender=function(){Render.stop(loop)};this.update=function(){loop()};this.destroy=function(){_this.clearTween();Render.stop(loop);for(var i=0;i<_tweens.length;i++){_tweens[i].stop()}}},function(){TweenTimeline.UPDATE="tweentimeline_update"});window.ASSETS=["assets/geometry/characters/commando-anim.json","assets/geometry/characters/commando-rig.json","assets/geometry/characters/constructor-anim.json","assets/geometry/characters/constructor-rig.json","assets/geometry/characters/ninja-anim.json","assets/geometry/characters/ninja-rig.json","assets/geometry/characters/outlander-anim.json","assets/geometry/characters/outlander-rig.json","assets/geometry/ray/ray-anim-in.json","assets/geometry/ray/ray-anim.json","assets/geometry/ray/ray-rig.json","assets/images/collect/resources/brick.png","assets/images/collect/resources/metal.png","assets/images/collect/resources/nuts.png","assets/images/collect/resources/planks.png","assets/images/collect/suburb-mask.jpg","assets/images/collect/suburb-normals.jpg","assets/images/collect/suburb.jpg","assets/images/common/ui/arrow-down.png","assets/images/common/ui/arrow-left.png","assets/images/common/ui/arrow-right.png","assets/images/common/ui/green-gradient.jpg","assets/images/common/ui/hand-grab.png","assets/images/common/ui/hand.png","assets/images/common/ui/lock.png","assets/images/common/ui/pink-gradient.jpg","assets/images/common/ui/plus.png","assets/images/common/ui/ray.png","assets/images/common/ui/rotate.png","assets/images/common/ui/yellow-gradient.jpg","assets/images/explore/dot.png","assets/images/explore/glitch.jpg","assets/images/explore/main-screen.jpg","assets/images/explore/noise.jpg","assets/images/explore/overlay-mask.jpg","assets/images/explore/overlay.jpg","assets/images/explore/screens.jpg","assets/images/forts/fort0-color.jpg","assets/images/forts/fort0-mask.jpg","assets/images/forts/fort1-color.jpg","assets/images/forts/fort1-mask.jpg","assets/images/forts/fort2-color.jpg","assets/images/forts/fort2-mask.jpg","assets/images/forts/grass-color.jpg","assets/images/forts/grass-mask.jpg","assets/images/forts/mid-color.jpg","assets/images/forts/mid-mask.jpg","assets/images/forts/sky-clouds.jpg","assets/images/forts/sky-color.jpg","assets/images/intro/blur.jpg","assets/images/intro/characters/commando/mask.jpg","assets/images/intro/characters/commando/texture.jpg","assets/images/intro/characters/constructor/mask.jpg","assets/images/intro/characters/constructor/texture.jpg","assets/images/intro/characters/ninja/mask.jpg","assets/images/intro/characters/ninja/texture.jpg","assets/images/intro/characters/outlander/mask.jpg","assets/images/intro/characters/outlander/texture.jpg","assets/images/intro/hands/001.png","assets/images/intro/hands/002.png","assets/images/intro/hands/003.png","assets/images/intro/hands/004.png","assets/images/intro/hands/005.png","assets/images/intro/hands/006.png","assets/images/intro/hands/007.png","assets/images/intro/hands/008.png","assets/images/intro/hands/009.png","assets/images/intro/hands/010.png","assets/images/intro/layers/city-mask.jpg","assets/images/intro/layers/city.jpg","assets/images/intro/layers/fog.jpg","assets/images/intro/layers/sky-mask.jpg","assets/images/intro/layers/sky.jpg","assets/images/intro/layers/wall-mask.jpg","assets/images/intro/layers/wall.jpg","assets/images/ray/mask.jpg","assets/images/ray/room.jpg","assets/images/ray/speech/tail1.png","assets/images/ray/speech/tail2.png","assets/images/ray/speech/tail3.png","assets/images/ray/texture.jpg","assets/images/team/enemies-mask.jpg","assets/images/team/enemies.jpg","assets/images/team/heroes/constructor/glow.jpg","assets/images/team/heroes/constructor/normals.jpg","assets/images/team/heroes/constructor/texture.jpg","assets/images/team/heroes/ninja/glow.jpg","assets/images/team/heroes/ninja/normals.jpg","assets/images/team/heroes/ninja/texture.jpg","assets/images/team/heroes/outlander/glow.jpg","assets/images/team/heroes/outlander/normals.jpg","assets/images/team/heroes/outlander/texture.jpg","assets/images/team/heroes/soldier/glow.jpg","assets/images/team/heroes/soldier/normals.jpg","assets/images/team/heroes/soldier/texture.jpg","assets/images/weapons/grid.png","assets/images/weapons/icons/breacher.png","assets/images/weapons/icons/bullseye.png","assets/images/weapons/icons/crusader.png","assets/images/weapons/icons/spikes.png","assets/images/weapons/icons/sword.png","assets/images/weapons/renders/breacher-normals.jpg","assets/images/weapons/renders/breacher.jpg","assets/images/weapons/renders/bullseye-normals.jpg","assets/images/weapons/renders/bullseye.jpg","assets/images/weapons/renders/crusader-normals.jpg","assets/images/weapons/renders/crusader.jpg","assets/images/weapons/renders/spikes-normals.jpg","assets/images/weapons/renders/spikes.jpg","assets/images/weapons/renders/sword-normals.jpg","assets/images/weapons/renders/sword.jpg","assets/images/weapons/schematics/001.jpg","assets/images/weapons/schematics/002.jpg","assets/images/weapons/schematics/003.jpg","assets/images/weapons/schematics/004.jpg","assets/images/weapons/schematics/005.jpg","assets/js/lib/dat.gui.min.js","assets/js/lib/three.min.js","assets/shaders/compiled.vs"];ASSETS.RES={};ASSETS.SW=["assets/fonts/BurbankBigCondensed-Black.woff","assets/fonts/OpenSans-ExtraBold-webfont.woff","assets/fonts/OpenSans-Semibold-webfont.woff","assets/css/style.css","assets/js/fortnite.js"];Class(function Config(){var _this=this;this.CLASS_NAMES=[];this.PREORDER_CTA=null},"static");Class(function Copy(){this.messages={"epic.common.download":"Download","epic.fortnite.at.explore.home.copy":"Early Access Begins July 25","epic.fortnite.at.explore.home.preOrderCopy":"Pre-Order Now for a <strong>4-day Head Start</strong>","epic.fortnite.at.explore.home.title":"Don’t seek shelter.","epic.fortnite.at.explore.home.sub":"Make It.","epic.fortnite.at.explore.home.cta":"Pre-Order","epic.fortnite.at.explore.home.ctaLink":"https://www.epicgames.com/fortnite/register","epic.fortnite.at.explore.home.gameplay":"Gameplay Trailer","epic.fortnite.at.explore.home.gameplayLink":"https://www.youtube.com/watch?v=2GSfjeYVpkQ","epic.fortnite.at.explore.home.cinematic":"Cinematic Trailer","epic.fortnite.at.explore.home.cinematicLink":"","epic.fortnite.at.explore.video.p1":"The Storm came without warning.","epic.fortnite.at.explore.video.p2":"98% of the world’s population vanished...","epic.fortnite.at.explore.video.p3":"then came the monsters.","epic.fortnite.at.explore.video.p4":"Lead the world's remaining Heroes in the fight to save humanity and take back the world.","epic.fortnite.at.explore.video.skip":"Skip","epic.fortnite.at.explore.explore.title":"Let’s Get Out There!","epic.fortnite.at.explore.explore.rey1":"Oh! So you’re the new Commander?","epic.fortnite.at.explore.explore.rey2":"That’s great!","epic.fortnite.at.explore.explore.rey3":"Looks like those people out there need some help!","epic.fortnite.at.explore.explore.cta1":"Explore Plankerton","epic.fortnite.at.explore.explore.cta2":"Begin Mission","epic.fortnite.at.explore.explore.p1":'It’s time to explore the world, gather some supplies and start that whole "world saving" thing.',"epic.fortnite.at.explore.collect.rey1":"Have a look around, we’re gonna need some materials","epic.fortnite.at.explore.collect.rey2":"Those are wooden planks, they’re needed to create mostly everything.","epic.fortnite.at.explore.collect.rey3":"Bricks are great for making husk-resistant walls.","epic.fortnite.at.explore.collect.rey4":"You found metal! With that you can make some really strong structures.","epic.fortnite.at.explore.collect.rey5":"Oh nice! Nuts & bolts are used to create guns and traps.","epic.fortnite.at.explore.collect.rey6":"Looks like you have everything you need to build your first fort!","epic.fortnite.at.explore.collect.title1":"Wood Planks","epic.fortnite.at.explore.collect.p1":"Wood has all sorts of uses in the world of Fortnite. From building forts to making traps and weapons. It’s almost as good as duct tape. Almost.","epic.fortnite.at.explore.collect.title2":"Brick","epic.fortnite.at.explore.collect.p2":"Stone is a little less plentiful here, but you’ll want to look behind all the houses you can, because it’s real great for husk-resistant walls.","epic.fortnite.at.explore.collect.title3":"Nuts n’ Bolts","epic.fortnite.at.explore.collect.p3":"Nuts & bolts are the key components for most guns and traps in the world of Fortnite. You can find them in old appliances, cars, and just about anything that used to run.","epic.fortnite.at.explore.collect.title4":"Metal","epic.fortnite.at.explore.collect.p4":"Metal is the strongest building material in Fortnite. There are plenty of cars to smash here for the largest and most stout structures. ","epic.fortnite.at.explore.collect.cta":"Collect Materials","epic.fortnite.at.explore.collect.title":"Time To Build!","epic.fortnite.at.explore.collect.cta1":"Build Fort","epic.fortnite.at.explore.build.upgrade":"Upgrade","epic.fortnite.at.explore.build.fortLevel":"Fort Level","epic.fortnite.at.explore.build.fortLevel.small":"Treehouse","epic.fortnite.at.explore.build.fortLevel.medium":"Shack","epic.fortnite.at.explore.build.fortLevel.large":"Fortress","epic.fortnite.at.explore.build.rey1":"That’s a decent first fort.","epic.fortnite.at.explore.build.rey2":"You’ve got a few basic traps and a wood structure.","epic.fortnite.at.explore.build.rey3":"This will stop some small waves of Husks, but not the the big stuff.","epic.fortnite.at.explore.build.rey4":"You’re getting there!","epic.fortnite.at.explore.build.rey5":"I see you have some metal and stone in there now.","epic.fortnite.at.explore.build.rey6":"Those extra traps will be a big help too… but you can do better.","epic.fortnite.at.explore.build.rey7":"Now that’s a fort!","epic.fortnite.at.explore.build.rey8":"You have varied and upgraded building materials as well as a ton of traps and sniper perches. ","epic.fortnite.at.explore.weapons.title":"Defend Your Fort!","epic.fortnite.at.explore.weapons.cta":"Craft A Weapon","epic.fortnite.at.explore.weapons.rey1":"Sturdy walls aren’t enough to keep the monster hordes out.","epic.fortnite.at.explore.weapons.rey2":"You need some serious firepower.","epic.fortnite.at.explore.weapons.rey3":"Now we’re talking!","epic.fortnite.at.explore.weapons.rey4":"You’ll need to craft more things like this to push back the Storm.","epic.fortnite.at.explore.weapons.sub.title":"It’s Go Time!","epic.fortnite.at.explore.weapons.name":"Name of Weapon/Trap","epic.fortnite.at.explore.weapons.description":"Description","epic.fortnite.at.explore.weapons.weapon1.name":"Breacher","epic.fortnite.at.explore.weapons.weapon1.description":"When you’re ready for action, the Breacher is what you need to lay down suppressive fire and keep those waves off your fort or friends.","epic.fortnite.at.explore.weapons.weapon2.name":"Scoped Bullseye","epic.fortnite.at.explore.weapons.weapon2.description":"That sniper tower you built isn’t just for looking pretty. Get out there and pick off those Husks from long range with the Bullseye.","epic.fortnite.at.explore.weapons.weapon3.name":"Crusader","epic.fortnite.at.explore.weapons.weapon3.description":"When a Smasher is closing in, you’ll want the Crusader at your side to make short work of it at close range.","epic.fortnite.at.explore.weapons.weapon4.name":"Ninja Sword","epic.fortnite.at.explore.weapons.weapon4.description":"Sometimes you just need a trusty piece of steel at your side to slice through all the Storm’s most persistent enemies.","epic.fortnite.at.explore.weapons.weapon5.name":"Retractable Floor Spikes","epic.fortnite.at.explore.weapons.weapon5.description":"Floor spikes are great for Husk crowd control at choke points you’ve built throughout your fort.","epic.fortnite.at.explore.team.title":"Team Up","epic.fortnite.at.explore.team.heroes":"Heroes","epic.fortnite.at.explore.team.hero1.name":"Soldier","epic.fortnite.at.explore.team.hero1.description":"The Soldier is your first line of defense. Pass out bullet snacks and send the Husks to nap time.","epic.fortnite.at.explore.team.hero2.name":"Constructor","epic.fortnite.at.explore.team.hero2.description":"The Constructor specializes in building forts that are Husk-resistant and easy on the eye. Constructors can upgrade forts in ways others can’t.","epic.fortnite.at.explore.team.hero3.name":"Outlander","epic.fortnite.at.explore.team.hero3.description":"The Outlander is the best at finding all the ingredients you need to craft your towering forts and things that go boom.","epic.fortnite.at.explore.team.hero4.name":"Ninja","epic.fortnite.at.explore.team.hero4.description":"The Ninja is fleet of foot, slices through any combat situation, and is the only one who played enough video games to master the double jump.","epic.fortnite.at.explore.team.enemies":"Enemies","epic.fortnite.at.explore.team.enemies.description":"The Husk and other monsters that emerged from the Storm are more than mindless zombies. They’ll go over, around, and through the defenses you’ve built. You need to be smart and adaptable to stop them.","epic.fortnite.at.explore.order.title":"Save The World","epic.fortnite.at.explore.order.cta":"Pre-Order","epic.fortnite.at.explore.order.p1":"Pre-Order now to get a four-day headstart starting on July 21 and the Storm Master Weapon Pack as an added bonus."}},"static");Class(function FortniteEvents(){this.SCROLL_INTENT="fortnite_scroll_intent";this.PAUSE_SCROLL="fortnite_pause_scroll";this.RESUME_SCROLL="fortnite_resume_scroll";this.INCREMENT_SCROLL="fortnite_increment_scroll";this.PAGE_CHANGE="page_change";this.TV_HOVER="tv_hover"},"static");Mobile.Class(function Accelerometer(){var _this=this;this.x=0;this.y=0;this.z=0;this.alpha=0;this.beta=0;this.gamma=0;this.heading=0;this.rotationRate={};this.rotationRate.alpha=0;this.rotationRate.beta=0;this.rotationRate.gamma=0;this.toRadians=Device.system.os=="ios"?Math.PI/180:1;function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x;_this.y=e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 180:_this.x=e.accelerationIncludingGravity.x;_this.y=-e.accelerationIncludingGravity.y;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case 90:_this.x=e.accelerationIncludingGravity.y;_this.y=e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break;case-90:_this.x=-e.accelerationIncludingGravity.y;_this.y=-e.accelerationIncludingGravity.x;_this.z=e.accelerationIncludingGravity.z;if(e.rotationRate){_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians;_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians;_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians}break}if(Device.system.os=="android"){_this.x*=-1;_this.y*=-1;_this.z*=-1}}function updateOrientation(e){for(var key in e){if(key.toLowerCase().includes("heading"))_this.heading=e[key]}switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians;_this.beta=-e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians;_this.beta=e.alpha*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians;_this.beta=e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians;_this.beta=-e.beta*_this.toRadians;_this.gamma=e.gamma*_this.toRadians;break}_this.tilt=e.beta*_this.toRadians;_this.yaw=e.alpha*_this.toRadians;_this.roll=-e.gamma*_this.toRadians;if(Device.system.os=="android")_this.heading=compassHeading(e.alpha,e.beta,e.gamma)}function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180;var _x=beta?beta*degtorad:0;var _y=gamma?gamma*degtorad:0;var _z=alpha?alpha*degtorad:0;var cX=Math.cos(_x);var cY=Math.cos(_y);var cZ=Math.cos(_z);var sX=Math.sin(_x);var sY=Math.sin(_y);var sZ=Math.sin(_z);var Vx=-cZ*sY-sZ*sX*cY;var Vy=-sZ*sY+cZ*sX*cY;var compassHeading=Math.atan(Vx/Vy);if(Vy<0){compassHeading+=Math.PI}else if(Vx<0){compassHeading+=2*Math.PI}return compassHeading*(180/Math.PI)}this.capture=function(){if(!this.active){this.active=true;window.ondevicemotion=updateAccel;window.addEventListener("deviceorientation",updateOrientation)}};this.stop=function(){this.active=false;window.ondevicemotion=null;_this.x=_this.y=_this.z=0;window.removeEventListener("deviceorientation",updateOrientation)}},"Static");Class(function CSSAnimation(){Inherit(this,Component);var _this=this;var _name="a"+Utils.timestamp();var _frames,_timer,_started;var _duration=1e3;var _ease="linear";var _delay=0;var _loop=false;var _count=1;var _steps=null;var _applyTo=[];(function(){}());function complete(){_this.playing=false;if(_this.events)_this.events.fire(Events.COMPLETE,null,true)}function updateCSS(){var css=CSS._read();var id="/*"+_name+"*/";var keyframe="@"+CSS.vendor+"keyframes "+_name+" {\n";var string=id+keyframe;if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}var steps=_frames.length-1;var perc=Math.round(100/steps);var total=0;for(var i=0;i<_frames.length;i++){var frame=_frames[i];if(i==_frames.length-1)total=100;string+=(frame.percent||total)+"% {\n";var hasTransform=false;var transforms={};var styles={};for(var key in frame){if(TweenManager._isTransform(key)){transforms[key]=frame[key];hasTransform=true}else{styles[key]=frame[key]}}if(hasTransform){string+=CSS.vendor+"transform: "+TweenManager._parseTransform(transforms)+";"}for(key in styles){var val=styles[key];if(typeof val!=="string"&&key!="opacity"&&key!="zIndex")val+="px";string+=CSS._toCSS(key)+": "+val+";"}string+="\n}\n";total+=perc}string+="}"+id;css+=string;CSS._write(css)}function destroy(){var css=CSS._read();var id="/*"+_name+"*/";if(css.includes(_name)){var split=css.split(id);css=css.replace(id+split[1]+id,"")}CSS._write(css)}function applyTo(callback){for(var i=_applyTo.length-1;i>-1;i--){callback(_applyTo[i])}}this.set("frames",function(frames){_frames=frames;updateCSS()});this.set("steps",function(steps){_steps=steps;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]="steps("+steps+")"})}});this.set("duration",function(duration){_duration=Math.round(duration);if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDuration")]=_this.duration+"ms"})}});this.get("duration",function(){return _duration});this.set("ease",function(ease){_ease=ease;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationTimingFunction")]=TweenManager._getEase(_ease)})}});this.get("ease",function(){return _ease});this.set("loop",function(loop){_loop=loop;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("loop",function(){return _loop});this.set("count",function(count){_count=count;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationIterationCount")]=_loop?"infinite":_count})}});this.get("count",function(){return _count});this.set("delay",function(delay){_delay=delay;if(_this.playing){applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationDelay")]=_delay+"ms"})}});this.get("delay",function(){return _delay});this.play=function(){applyTo(function($obj){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})});_this.playing=true;clearTimeout(_timer);if(!_this.loop){_started=Date.now();_timer=_this.delayedCall(complete,_count*_duration)}};this.pause=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){$obj.div.style[CSS.prefix("AnimationPlayState")]="paused"})};this.stop=function(){_this.playing=false;clearTimeout(_timer);applyTo(function($obj){if($obj&&$obj.div&&$obj.div.style)$obj.div.style[CSS.prefix("AnimationName")]=""})};this.applyTo=function($obj){_applyTo.push($obj);if(_this.playing){defer(function(){$obj.div.style[CSS.prefix("Animation")]=_name+" "+_this.duration+"ms "+(_steps?"steps("+_steps+")":TweenManager._getEase(_ease))+" "+(_loop?"infinite":_count);$obj.div.style[CSS.prefix("AnimationPlayState")]="running"})}};this.remove=function($obj){$obj.div.style[CSS.prefix("AnimationName")]="";var i=_applyTo.indexOf($obj);if(i>-1)_applyTo.splice(i,1)};this.destroy=function(){if(!this._destroy)return;this.stop();_frames=null;destroy();return this._destroy()}});Class(function CSSFilter($object,_vert,_frag){Inherit(this,Component);var _this=this;var _filter="";var _filters=["grayscale","sepia","saturate","hue","invert","opacity","brightness","contrast","blur"];var _killTween,_tween;function checkFilter(key){for(var i=_filters.length-1;i>-1;i--){if(_filters[i]==key)return true}return false}function buildFilters(){var str="";var len=_filters.length-1;for(var key in _this){if(!checkFilter(key))continue;var filter=key;var value=_this[key];if(typeof value==="number"){filter=filter=="hue"?"hue-rotate":filter;value=filter=="hue-rotate"?value+"deg":value;value=filter=="blur"?value+"px":value;str+=filter+"("+value+") "}}_filter=str}function clearTween(){if(_tween||!$object||!$object.div)return false;$object.div.style[CSS.prefix("Transition")]=""}this.apply=function(){buildFilters();$object.div.style[CSS.prefix("Filter")]=_filter};this.tween=function(props,time,ease,delay,callback){if(typeof delay==="function"){callback=delay;delay=0}delay=delay||0;_killTween=false;var filter="-"+CSS.styles.vendor.toLowerCase()+"-filter";$object.willChange(filter);Render.setupTween(function(){if(_killTween)return;$object.div.style[CSS.prefix("Transition")]=filter+" "+time+"ms "+TweenManager.getEase(ease)+" "+delay+"ms";for(var key in props){_this[key]=props[key]}_tween=_this.delayedCall(function(){$object.willChange(null);if(callback)callback()},time+delay);_this.apply()})};this.stopTween=function(){clearTimeout(_tween);_killTween=true;clearTween()};this.clear=function(){for(var key in _this){if(checkFilter(key))delete _this[key]}if(_tween)this.stopTween();this.apply()};this.destroy=function(){this.clear();$object=null;_tween=null;return this._destroy()}});Class(function SplitTextfield(){var _style={padding:0,margin:0,position:"relative",float:"",cssFloat:"",styleFloat:"",display:"inline-block",width:"auto",height:"auto"};function splitLetter($obj){var _array=[];var text=$obj.div.innerHTML;var split=text.split("");$obj.div.innerHTML="";for(var i=0;i<split.length;i++){if(split[i]==" ")split[i]="&nbsp;";var letter=$("t","span");letter.html(split[i],true).css(_style);_array.push(letter);$obj.add(letter)}return _array}function splitWord($obj){var _array=[];var text=$obj.div.innerHTML;text=text.replace("&nbsp;"," ");var split=text.split(" ");$obj.empty();for(var i=0;i<split.length;i++){var word=$("t","span");var empty=$("t","span");word.html(split[i]).css(_style);empty.html("&nbsp",true).css(_style);_array.push(word);_array.push(empty);$obj.add(word);$obj.add(empty)}return _array}this.split=function($obj,by){if(by=="word")return splitWord($obj);else return splitLetter($obj)}},"Static");Class(function Fullscreen(){Inherit(this,Events);var _this=this;this.isOpen=false;(function(){addHandlers()}());function addHandlers(){["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange","onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onmsfullscreenerror"].forEach(function(evt){if(typeof document[evt]!=="undefined")document[evt]=update})}function update(){var isOpen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);if(isOpen===_this.isOpen)return;_this.isOpen=isOpen;_this.events.fire(Events.FULLSCREEN,{fullscreen:_this.isOpen})}this.open=function(element){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");element=element||document.body;["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].every(function(method){if(typeof element[method]=="undefined")return true;element[method]()})};this.close=function(){if(!Device.system.fullscreen)return console.warn("Fullscreen API not supported");["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].every(function(method){if(typeof document[method]=="undefined")return true;document[method]()})}},"static");Class(function GPU(){Inherit(this,Component);var _this=this;var _split={};Hydra.ready(function(){_this.detect=function(match){if(!Device.graphics.webgl)return;return Device.graphics.webgl.detect(match)};_this.detectAll=function(){if(!Device.graphics.webgl)return;var match=true;for(var i=0;i<arguments.length;i++){if(!Device.graphics.webgl.detect(arguments[i]))match=false}return match};_this.matchGPU=function(str,min){var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:99999;var num=splitGPU(str);return num>=min&&num<max};_this.gpu=Device.graphics.webgl?Device.graphics.webgl.gpu:"";function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);_split[string]=num;return num}catch(e){return-1}}Mobile.iOS=Modules.require("iOSDevices").find();_this.BLACKLIST=Modules.require("GPUBlacklist").match();_this.T0=function(){if(Device.mobile)return false;if(_this.BLACKLIST)return true;if(_this.detectAll("intel","hd")){return _this.matchGPU("hd graphics ",1e3,4e3)}return false}();_this.T1=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(!_this.detect(["nvidia","amd","radeon","geforce"]))return true;return false}();_this.T2=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(_this.detect(["nvidia","amd","radeon","geforce"]))return true;return false}();_this.T3=function(){if(_this.BLACKLIST)return false;if(Device.mobile)return false;if(_this.detect(["titan","amd radeon pro","quadro"]))return true;if(_this.matchGPU("gtx ",104e1))return true;if(_this.matchGPU("radeon (tm) rx ",400))return true;if(_this.matchGPU("radeon pro ",420))return true;return false}();_this.MT0=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["legacy","ipad mini 1","5x","ipad 4"]))return true;if(Device.system.os=="android"&&_this.detect("sgx"))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",0,330);if(_this.detect("mali"))return _this.matchGPU("mali-t",0,628);return false}();_this.MT1=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["5s","ipad air 1"]))return true;if(Device.system.os=="android"&&!_this.MT0)return true;return false}();_this.MT2=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["6x","ipad air 2"]))return true;if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",399);return false}();_this.MT3=function(){if(!Device.mobile)return false;if(Mobile.iOS.includes(["6s","ipad pro","7x"]))return true;if(_this.detect("nvidia tegra")&&Device.detect("pixel c")){return true}if(_this.detect("adreno"))return _this.matchGPU("adreno (tm) ",530);if(navigator.platform.toLowerCase().includes("mac"))return true;return false}();_this.lt=function(num){if(_this.TIER>-1){return _this.TIER<=num}return false};_this.gt=function(num){if(_this.TIER>-1){return _this.TIER>=num}return false};_this.eq=function(num){if(_this.TIER>-1){return _this.TIER==num}return false};_this.mobileEq=function(num){if(_this.M_TIER>-1){return _this.M_TIER==num}return false};_this.mobileLT=function(num){if(_this.M_TIER>-1){return _this.M_TIER<=num}return false};_this.mobileGT=function(num){if(_this.M_TIER>-1){return _this.M_TIER>=num}return false};for(var key in _this){if(key.charAt(0)=="T"&&_this[key]===true)_this.TIER=Number(key.charAt(1));if(key.slice(0,2)=="MT"&&_this[key]===true)_this.M_TIER=Number(key.charAt(2))}_this.OVERSIZED=!Device.mobile&&_this.TIER<2&&Math.max(window.innerWidth,window.innerHeight)>144e1;_this.initialized=true});this.ready=function(){var promise=Promise.create();_this.wait(function(){return promise.resolve()},_this,"initialized");return promise}},"static");Module(function GPUBlacklist(){this.exports={match:function match(){if(!Device.graphics.webgl)return true;return Device.graphics.webgl.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","radeon r9 200","mali-4","mali-3","mali-2"])}}});Class(function InlineVideo(_params){Inherit(this,Component);var _this=this;var _evt={time:0,duration:0};this.width=_params.width||0;this.height=_params.height||0;this.loop=_params.loop||true;this.fps=1e3/(_params.fps||24);this.autoPlay=_params.autoPlay||false;this.playing=false;this.loaded=false;var _video,_canvas,_context,_duration;var _frameTime=0;var _frameCount=0;(function(){initVideo();initCanvas();addHandlers();_video.div.addEventListener("timeupdate",render,false)}());function initVideo(){if(!_params.src)console.warn("src is required");_video=_this.initClass(Video,{src:_params.src,loop:_params.loop,width:_params.width,height:_params.height});_video.div.load();_this.video=_video;_this.src=_params.src}function initCanvas(){_canvas=_this.initClass(Canvas,_this.width,_this.height);_context=_canvas.context;_this.element=_canvas.object;_this.div=_canvas.div;_this.object=_canvas.object}function tick(t,dt,delta){_frameTime+=delta;if(_frameTime<_this.fps)return;_frameTime-=_this.fps;_frameCount++;if(_frameCount*_this.fps>_duration){_frameCount=0;if(!_this.loop)pause()}_video.div.currentTime=_frameCount*_this.fps/1e3}function play(){if(!_this.loaded)return defer(play);_this.startRender(tick);_this.playing=true}function pause(){_this.stopRender(tick);_this.playing=false}function addHandlers(){_video.div.addEventListener("canplaythrough",loaded,false);_video.div.addEventListener("timeupdate",render,false)}function loaded(){_video.div.removeEventListener("canplaythrough",loaded,false);_this.loaded=true;_duration=_video.div.duration*1e3;if(_this.autoPlay)play();if(_this.onLoad&&typeof _this.onLoad=="function")_this.onLoad()}function render(){if(!_this.loaded)return;_context.drawImage(_video.div,0,0,_canvas.width,_canvas.height);_evt.time=_video.div.currentTime;_evt.duration=_video.div.duration;_this.events.fire(Events.UPDATE,_evt,true)}function size(width,height){_this.width=width;_this.height=height;_canvas.size(width,height)}this.play=play;this.pause=pause;this.size=size;this.render=render;this.seek=_video.seek;this.stop=_video.stop;this.ready=function(){return _this.loaded}});Module(function iOSDevices(){this.exports={find:function find(){if(Device.system.os=="ios"&&navigator.platform.toLowerCase().includes("macintel"))return"";if(!Device.graphics.webgl)return"legacy";var detect=Device.graphics.webgl.detect;if(detect(["a9","a10","a11","a12","a13","a14"])||navigator.platform.toLowerCase().includes("mac"))return Device.mobile.phone?"6s, 7x":"ipad pro";if(detect("a8"))return Device.mobile.phone?"6x":"ipad air 2, ipad mini 4";if(detect("a7"))return Device.mobile.phone?"5s":"ipad air 1, ipad mini 2, ipad mini 3";if(detect(["sgx554","sgx 554"]))return Device.mobile.phone?"":"ipad 4";if(detect(["sgx543","sgx 543"]))return Device.mobile.phone?"5x, 5c, 4s":"ipad mini 1, ipad 2";return"legacy"}}});Class(function Video(_params){Inherit(this,Component);var _this=this;var _inter,_time,_lastTime,_buffering,_seekTo,_loop,_forceRender;var _tick=0;var _event={};this.loop=false;this.playing=false;this.loaded={start:0,end:0,percent:0};this.width=_params.width||0;this.height=_params.height||0;(function(){createDiv();if(_params.preload!==false)preload()}());function createDiv(){var src=_params.src;if(src&&!src.includes(["webm","mp4","ogv"]))src+="."+Device.media.video;_this.div=document.createElement("video");if(src)_this.div.src=src;_this.div.controls=_params.controls;_this.div.id=_params.id||"";_this.div.width=_params.width;_this.div.height=_params.height;_loop=_this.div.loop=_params.loop;_this.object=$(_this.div);_this.width=_params.width;_this.height=_params.height;_this.object.size(_this.width,_this.height);if(Device.mobile){_this.object.attr("webkit-playsinline",true);_this.object.attr("playsinline",true)}}function preload(){_this.div.preload="auto";_this.div.load()}function tick(){if(!_this.div||!_this.events)return _this.stopRender(tick);_this.duration=_this.div.duration;_this.time=_this.div.currentTime;if(_this.div.currentTime==_lastTime){_tick++;if(_tick>30&&!_buffering){_buffering=true;_this.events.fire(Events.ERROR,null,true)}}else{_tick=0;if(_buffering){_this.events.fire(Events.READY,null,true);_buffering=false}}_lastTime=_this.div.currentTime;if(_this.div.currentTime>=(_this.duration||_this.div.duration)-.001){if(!_loop){if(!_forceRender)_this.stopRender(tick);_this.events.fire(Events.COMPLETE,null,true)}}if(_this.div){_event.time=_this.div.currentTime;_event.duration=_this.div.duration;_event.loaded=_this.loaded;_this.events.fire(Events.UPDATE,_event,true)}}function checkReady(){if(!_this.div)return false;if(!_seekTo){_this.buffered=_this.div.readyState==_this.div.HAVE_ENOUGH_DATA}else{var max=-1;var seekable=_this.div.seekable;if(seekable){for(var i=0;i<seekable.length;i++){if(seekable.start(i)<_seekTo){max=seekable.end(i)-.5}}if(max>=_seekTo)_this.buffered=true}else{_this.buffered=true}}if(_this.buffered){_this.stopRender(checkReady);_this.events.fire(Events.READY,null,true)}}function handleProgress(){if(!_this.ready())return;var range=0;var bf=_this.div.buffered;var time=_this.div.currentTime;while(!(bf.start(range)<=time&&time<=bf.end(range))){range+=1}_this.loaded.start=bf.start(range)/_this.div.duration;_this.loaded.end=bf.end(range)/_this.div.duration;_this.loaded.percent=_this.loaded.end-_this.loaded.start;_this.events.fire(Events.PROGRESS,_this.loaded,true)}this.set("loop",function(bool){if(!_this.div)return;_loop=bool;_this.div.loop=bool});this.get("loop",function(){return _loop});this.set("src",function(src){if(src&&!src.includes(["webm","mp4","ogv"]))src+="."+Device.media.video;_this.div.src=src});this.get("src",function(){return _this.div.src});this.play=function(){if(!_this.div)return false;_this.playing=true;_this.div.play();_this.startRender(tick)};this.pause=function(){if(!_this.div)return false;_this.playing=false;_this.div.pause();_this.stopRender(tick)};this.stop=function(){_this.playing=false;_this.stopRender(tick);if(!_this.div)return false;_this.div.pause();if(_this.ready())_this.div.currentTime=0};this.volume=function(v){if(!_this.div)return false;_this.div.volume=v;if(_this.muted){_this.muted=false;_this.div.removeAttribute("muted")}};this.mute=function(){if(!_this.div)return false;_this.volume(0);_this.muted=true;_this.object.attr("muted",true)};this.seek=function(t){if(!_this.div)return false;if(_this.div.readyState<=1){Timer.create(function(){_this.seek&&_this.seek(t)},32);return}_this.div.currentTime=t};this.canPlayTo=function(t){_seekTo=null;if(t)_seekTo=t;if(!_this.div)return false;if(!_this.buffered)_this.startRender(checkReady);return this.buffered};this.ready=function(){if(!_this.div)return false;return _this.div.readyState>=2};this.size=function(w,h){if(!_this.div)return false;this.div.width=this.width=w;this.div.height=this.height=h;this.object.css({width:w,height:h})};this.forceRender=function(){_forceRender=true;_this.startRender(tick)};this.trackProgress=function(){_this.div.addEventListener("progress",handleProgress)};this.destroy=function(){this.stop();this.object.remove();this.div.src="";return this._destroy()}});Class(function Webcam(_width,_height,_audio,_options){Inherit(this,Component);var _this=this;(function(){createVideo();initUserMedia()}());function createVideo(){_this.div=document.createElement("video");_this.div.width=_width;_this.div.height=_height;_this.div.autoplay=true;_this.element=$(_this.div)}function initUserMedia(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:_options||true,audio:_audio},success,error)}function success(stream){_this.div.src=window.URL.createObjectURL(stream);_this.events.fire(Events.READY,null,true);_this.element.show()}function error(){_this.events.fire(Events.ERROR,null,true)}this.get("width",function(){return _width});this.get("height",function(){return _height});this.set("options",function(options){_options=options;initUserMedia()});this.size=function(w,h){_this.div.width=_width=w;_this.div.height=_height=h;_this.element.size(w,h)};this.getPixels=function(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_width;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_height;if(!_this.canvas)_this.canvas=_this.initClass(Canvas,width,height,null);_this.canvas.context.drawImage(_this.div,0,0,width,height);return _this.canvas.context.getImageData(0,0,width,height)};this.ready=function(){return _this.div.readyState>0};this.destroy=function(){success=error=null;return this._destroy()}});Class(function Scroll(_object,_params){Inherit(this,Component);var _this=this;this.x=0;this.y=0;this.max={x:0,y:0};this.delta={x:0,y:0};this.enabled=true;var _scrollTarget={x:0,y:0};var _scrollInertia={x:0,y:0};var _axes=["x","y"];(function(){initParams();if(_this.object)style();addHandlers();resize();_this.startRender(loop)}());function initParams(){if(!_object.div){_params=_object;_object=null}if(!_params)_params={};_this.object=_object;_this.hitObject=_params.hitObject||_this.object;_this.max.y=_params.height||0;_this.max.x=_params.width||0;_this.scale=_params.scale||1;_this.drag=function(){if(typeof _params.drag!=="undefined")return _params.drag;return!!Device.mobile}();_this.mouseWheel=_params.mouseWheel!==false;_this.limit=_params.limit!==false;if(Array.isArray(_params.axes))_axes=_params.axes}function style(){_this.object.css({overflow:"auto"})}function loop(){_axes.forEach(function(axis){if(_this.isInertia){_scrollInertia[axis]*=.9;_scrollTarget[axis]+=_scrollInertia[axis]}if(_this.limit)_scrollTarget[axis]=Math.max(_scrollTarget[axis],0);if(_this.limit)_scrollTarget[axis]=Math.min(_scrollTarget[axis],_this.max[axis]/_this.scale);_this.delta[axis]=(_scrollTarget[axis]*_this.scale-_this[axis])*.6;_this[axis]+=_this.delta[axis];if(_this.object){if(axis=="x")_this.object.div.scrollLeft=_this.x;if(axis=="y")_this.object.div.scrollTop=_this.y}})}function stopInertia(){_this.isInertia=false;clearTween(_scrollTarget)}function addHandlers(){if(!Device.mobile){if(Device.system.browser=="ie"){window.addEventListener("wheel",scroll,true)}else{__window.bind("wheel",scroll)}}if(_this.drag){if(_this.hitObject)_this.hitObject.bind("touchstart",function(e){return e.preventDefault()});var input=_this.hitObject?_this.initClass(Interaction,_this.hitObject):Mouse.input;_this.events.sub(input,Interaction.START,down);_this.events.sub(input,Interaction.DRAG,drag);_this.events.sub(input,Interaction.END,up)}_this.events.sub(Events.RESIZE,resize)}function scroll(e){if(!_this.enabled)return;if(e.preventDefault)e.preventDefault();if(!_this.mouseWheel)return;stopInertia();_axes.forEach(function(axis){var delta="delta"+axis.toUpperCase();if(Device.system.os=="mac"){if(Device.system.browser=="firefox"){if(e.deltaMode===1){_scrollTarget[axis]+=e[delta]*4;_scrollInertia[axis]=e[delta]*4;_this.isInertia=true;return}_scrollTarget[axis]+=e[delta];return}if(Device.system.browser.includes(["chrome","safari"])){_scrollTarget[axis]+=e[delta]*.33;_scrollInertia[axis]=e[delta]*.33;_this.isInertia=true;return}}if(Device.system.os=="windows"){if(Device.system.browser=="firefox"){if(e.deltaMode===1){_scrollTarget[axis]+=e[delta]*10;_scrollInertia[axis]=e[delta]*10;_this.isInertia=true;return}}}_scrollTarget[axis]+=e[delta]})}function down(){if(!_this.enabled)return;stopInertia()}function drag(){if(!_this.enabled)return;_axes.forEach(function(axis){_scrollTarget[axis]-=Mouse.delta[axis]})}function up(){if(!_this.enabled)return;var m=function(){if(Device.system.os=="android")return 35;return 25}();var obj={};_axes.forEach(function(axis){obj[axis]=_scrollTarget[axis]-Mouse.delta[axis]*m});tween(_scrollTarget,obj,25e2,"easeOutQuint")}function resize(){if(!_this.enabled)return;stopInertia();if(!_this.object)return;var p={};if(Device.mobile)_axes.forEach(function(axis){return p[axis]=_this.max[axis]?_scrollTarget[axis]/_this.max[axis]:0});if(typeof _params.height=="undefined")_this.max.y=_this.object.div.scrollHeight-_this.object.div.clientHeight;if(typeof _params.width=="undefined")_this.max.x=_this.object.div.scrollWidth-_this.object.div.clientWidth;if(Device.mobile)_axes.forEach(function(axis){return _this[axis]=_scrollTarget[axis]=p[axis]*_this.max[axis]})}this.onDestroy=function(){__window.unbind("wheel",scroll)}});Class(function Shaders(){Inherit(this,Component);var _this=this;(function(){}());function parseSingleShader(code){var uniforms=code.split("#!UNIFORMS")[1].split("#!")[0];var varyings=code.split("#!VARYINGS")[1].split("#!")[0];var attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];while(code.includes("#!SHADER")){code=code.slice(code.indexOf("#!SHADER"));var split=code.split("#!SHADER")[1];var br=split.indexOf("\n");var name=split.slice(0,br).split(": ")[1];var glsl=split.slice(br);if(name.includes(".vs"))glsl=attributes+uniforms+varyings+glsl;else glsl=uniforms+varyings+glsl;_this[name]=glsl;code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i];var text=split[i+1];if(text.includes("#!UNIFORMS"))parseSingleShader(text);else _this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];if(typeof obj==="string"){_this[key]=require(obj)}}}function require(shader){if(!shader.includes("require"))return shader;shader=shader.replace(/# require/g,"#require");while(shader.includes("#require")){var split=shader.split("#require(");var name=split[1].split(")")[0];name=name.replace(/ /g,"");if(!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}this.parse=function(code,file){if(!code.includes("{@}")){file=file.split("/");file=file[file.length-1];_this[file]=code}else{parseCompiled(code);parseRequirements()}_this.shadersParsed=true};this.onReady=this.ready=function(callback){var promise=Promise.create();if(callback)promise.then(callback);_this.wait(function(){return promise.resolve()},_this,"shadersParsed");return promise};this.getShader=function(string){if(_this.FALLBACKS){if(_this.FALLBACKS[string]){string=_this.FALLBACKS[string]}}var code=_this[string];if(code){while(code.includes("#test ")){try{var test=code.split("#test ")[1];var name=test.split("\n")[0];var glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];if(!eval(name)){code=code.replace(glsl,"")}code=code.replace("#test "+name+"\n","");code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}}}return code}},"static");Class(function Lighting(){Inherit(this,Component);var _this=this;var _particleDepthShader;var _lights=[];(function(){}());function loop(){decomposeLights(_lights)}function decomposeLights(lights){for(var i=lights.length-1;i>-1;i--){var light=lights[i];if(!light.parent)light.updateMatrixWorld();else if(!light.parent.parent)light.parent.updateMatrixWorld();if(!light._world)light._world=new THREE.Vector3;light.getWorldPosition(light._world)}}function updateArrays(shader){var lights=shader.lights;var lighting=shader.__lighting;var light;lighting.position.length=0;lighting.color.length=0;lighting.intensity.length=0;lighting.distance.length=0;for(var i=0;i<lights.length;i++){light=lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}for(i=0;i<_lights.length;i++){light=_lights[i];lighting.position.push(light._world);lighting.color.push(light.color.r,light.color.g,light.color.b);lighting.intensity.push(light.intensity);lighting.distance.push(light.distance)}}this.add=function(light){_lights.push(light);Render.start(loop)};this.remove=function(light){_lights.remove(light)};this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;var lighting={position:[],color:[],intensity:[],distance:[]};shader.__lighting=lighting;if(_lights[0]&&!_lights[0]._world)decomposeLights(_lights);decomposeLights(shader.lights);updateArrays(shader);return lighting};this.update=function(shader){decomposeLights(shader.lights);updateArrays(shader)};this.getParticleDepthShader=function(light,size){if(!_particleDepthShader){_particleDepthShader=new Shader("ParticleDepth");_particleDepthShader.uniforms={pointSize:{type:"f",value:size||5},lightPos:{type:"v3",value:light.position},far:{type:"f",value:light.shadow.camera.far}};_particleDepthShader.receiveShadow=true}var shader=_particleDepthShader.clone();shader.set("pointSize",size||5);shader.set("lightPos",light.position);shader.set("far",light.shadow.camera.far);return shader}},"static");Class(function Object3D(){Inherit(this,Component);var _this=this;this.group=new THREE.Group;this.freezeMatrix=function(group){group=group||_this.group;group.matrixAutoUpdate=false;group.updateMatrix()};this.add=function(child){this.group.add(child.group||child)};this.remove=function(child){this.group.remove(child.group||child)}});Class(function BasicPass(){Inherit(this,NukePass);var _this=this;this.fragmentShader=["varying vec2 vUv;","uniform sampler2D tDiffuse;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"];this.init(this.fragmentShader)});Class(function FXLayer(_parentNuke,_pass){Inherit(this,Component);var _this=this;var _nuke,_rt;var _scene=new THREE.Scene;var _objects=[];var _rts={};var _id=Utils.timestamp();this.resolution=1;this.autoVisible=true;this.enabled=true;function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}function initRT(){_rt=Utils3D.createRT(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr);_this.rt=_rt}function updateTopParent(obj){var parent=obj.parent;while(parent){parent.updateMatrixWorld();parent=parent.parent}}this.create=function(nuke,pass){if(!nuke)return;_this=this;_this.scene=_scene;_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr});_nuke.parentNuke=nuke;_parentNuke=nuke;if(pass)_nuke.add(pass);_this.nuke=_nuke;initRT();addListeners()};this.addObject=function(object){if(!_nuke)return;var clone=object.clone();object["clone_"+_id]=clone;_scene.add(clone);_objects.push(object);return clone};this.removeObject=function(object){if(!_nuke)return;_scene.remove(object["clone_"+_id]);_objects.remove(object);delete object["clone_"+_id]};this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled)return;if(!_this.forceRender&&(!_parentNuke.enabled||!_objects.length))return;if(stage){_nuke.stage=stage;_this.setSize(stage.width,stage.height)}if(camera){_nuke.camera=camera}else{_nuke.camera=_nuke.parentNuke.camera}for(var i=_objects.length-1;i>-1;i--){var obj=_objects[i];var clone=obj["clone_"+_id];if(_this.autoVisible){clone.material.visible=true;var parent=obj;while(parent){if(parent.visible==false||parent.material&&parent.material.visible==false){clone.material.visible=false}parent=parent.parent}}if(_this.forceRender){clone.material.visible=true}obj.updateMatrixWorld();if(!obj.ignoreMatrix)Utils3D.decompose(obj,clone)}_nuke.rtt=_rt;_nuke.render()};this.addPass=function(pass){if(!_nuke)return;_nuke.add(pass)};this.removePass=function(pass){if(!_nuke)return;_nuke.remove(pass)};this.setSize=function(width,height){if(!_nuke)return;if(_rt.width==width&&_rt.height==height)return;_this.events.unsub(Events.RESIZE,resizeHandler);_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr);_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)};this.setDPR=function(dpr){if(!_nuke)return;_nuke.dpr=dpr};this.getObjects=function(){return _objects};if(_parentNuke instanceof Nuke)this.create(_parentNuke,_pass)});Namespace("FX");Class(function Nuke(_stage,_params){Inherit(this,Component);var _this=this;if(!_params.renderer)console.error("Nuke :: Must define renderer");_this.stage=_stage;_this.renderer=_params.renderer;_this.camera=_params.camera;_this.scene=_params.scene;_this.rtt=_params.rtt;_this.enabled=_params.enabled==false?false:true;_this.passes=_params.passes||[];var _dpr=_params.dpr||1;var _rts={};var _rtStack=[];var _rttPing,_rttPong,_nukeScene,_nukeMesh,_rttCamera;(function(){initNuke();addListeners()}());function initNuke(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,"ping");_rttPong=Nuke.getRT(width,height,"pong");_rttCamera=new THREE.OrthographicCamera(_this.stage.width/-2,_this.stage.width/2,_this.stage.height/2,_this.stage.height/-2,1,1e3);_nukeScene=new THREE.Scene;_nukeMesh=new THREE.Mesh(Nuke.getPlaneGeom(),new THREE.MeshBasicMaterial);_nukeScene.add(_nukeMesh)}function finalRender(scene,camera){if(_this.rtt){_this.renderer.render(scene,camera||_this.camera,_this.rtt)}else{_this.renderer.render(scene,camera||_this.camera)}_this.postRender&&_this.postRender()}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){var width=_this.stage.width*_dpr;var height=_this.stage.height*_dpr;_rttPing.dispose();_rttPong.dispose();_rttPing=Nuke.getRT(width,height,"ping");_rttPong=Nuke.getRT(width,height,"pong");_rttCamera.left=_this.stage.width/-2;_rttCamera.right=_this.stage.width/2;_rttCamera.top=_this.stage.height/2;_rttCamera.bottom=_this.stage.height/-2;_rttCamera.updateProjectionMatrix()}_this.add=function(pass,index){if(!pass.pass){defer(function(){_this.add(pass,index)});return}if(typeof index=="number"){_this.passes.splice(index,0,pass);return}_this.passes.push(pass)};_this.remove=function(pass){if(typeof pass=="number"){_this.passes.splice(pass)}else{_this.passes.remove(pass)}};_this.renderToTexture=function(clear,rtt){_this.renderer.render(_this.scene,_this.camera,rtt||_rttPing,typeof clear=="boolean"?clear:true)};_this.render=function(){if(!_this.enabled||!_this.passes.length){finalRender(_this.scene);return}if(!_this.multiRender){_this.renderer.render(_this.scene,_this.camera,_rttPing,true)}var pingPong=true;for(var i=0;i<_this.passes.length-1;i++){_nukeMesh.material=_this.passes[i].pass;_nukeMesh.material.uniforms.tDiffuse.value=pingPong?_rttPing.texture:_rttPong.texture;_this.renderer.render(_nukeScene,_rttCamera,pingPong?_rttPong:_rttPing);pingPong=!pingPong}_nukeMesh.material=_this.passes[_this.passes.length-1].pass;_nukeMesh.material.uniforms.tDiffuse.value=pingPong?_rttPing.texture:_rttPong.texture;finalRender(_nukeScene,_rttCamera)};_this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler);if(!_rts[width+"_"+height]){var rttPing=Nuke.getRT(width*_dpr,height*_dpr,"ping");var rttPong=Nuke.getRT(width*_dpr,height*_dpr,"pong");_rts[width+"_"+height]={ping:rttPing,pong:rttPong,name:width+"_"+height};_rtStack.push(_rts[width+"_"+height]);if(_rtStack.length>3){var _rts2=_rtStack.shift();delete _rts[_rts2.name];_rts2.ping.dispose();_rts2.pong.dispose()}}var rts=_rts[width+"_"+height];_rttPing=rts.ping;_rttPong=rts.pong};_this.set("dpr",function(v){_dpr=v||Device.pixelRatio;resizeHandler()});_this.get("dpr",function(){return _dpr});_this.get("output",function(){return _nukeMesh.material.uniforms?_nukeMesh.material.uniforms.tDiffuse.value:null})},function(){var _plane;var _rts={};Nuke.getPlaneGeom=function(){if(!_plane)_plane=new THREE.PlaneBufferGeometry(2,2,1,1);return _plane};Nuke.getRT=function(width,height,type){return Utils3D.createRT(width,height)}});Class(function NukePass(_fs,_vs,_pass){Inherit(this,Component);var _this=this;this.name=typeof _fs=="string"?_fs:Utils.getConstructorName(_fs);function prefix(code){if(!code)throw"No shader "+_fs+" found";var pre="";pre+="precision highp float;\n";pre+="precision highp int;\n";if(!code.includes("uniform sampler2D tDiffuse")){pre+="uniform sampler2D tDiffuse;\n";pre+="varying vec2 vUv;\n"}code=pre+code;return code}function getVS(){return"\n        precision highp float;\n        precision highp int;\n\n        varying vec2 vUv;\n\n        attribute vec2 uv;\n        attribute vec3 position;\n\n        void main() {\n            vUv = uv;\n            gl_Position = vec4(position, 1.0);\n        }\n        "}this.init=function(fs){if(_this.pass)return;_this=this;var name=fs||this.constructor.toString().match(/function ([^\(]+)/)[1];var fragmentShader=Array.isArray(fs)?fs.join(""):null;_this.uniforms=_this.uniforms||{};_this.uniforms.tDiffuse={type:"t",value:null};_this.pass=new THREE.RawShaderMaterial({uniforms:_this.uniforms,vertexShader:typeof _vs==="string"?Shaders.getShader(name+".vs"):getVS(),fragmentShader:fragmentShader||prefix(Shaders.getShader(name+".fs"))});_this.uniforms=_this.pass.uniforms};this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]);this.uniforms[key].value=value};this.tween=function(key,value,time,ease,delay,callback,update){tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(){if(!_this.pass)_this.init(_fs);return new NukePass(null,null,_this.pass.clone())};if(typeof _fs==="string"){defer(function(){_this.init(_fs)})}else if(_pass){_this.pass=_pass;_this.uniforms=_pass.uniforms}});Class(function Raycaster(_camera){Inherit(this,Component);var _this=this;var _mouse=new THREE.Vector3;var _raycaster=new THREE.Raycaster;var _debug=null;(function(){}());function intersect(objects){var hit;if(Array.isArray(objects)){hit=_raycaster.intersectObjects(objects)}else{hit=_raycaster.intersectObject(objects)}if(_debug)updateDebug();return hit}function updateDebug(){var vertices=_debug.geometry.vertices;vertices[0].copy(_raycaster.ray.origin.clone());vertices[1].copy(_raycaster.ray.origin.clone().add(_raycaster.ray.direction.clone().multiplyScalar(1e4)));_debug.geometry.verticesNeedUpdate=true}this.set("camera",function(camera){_camera=camera});this.set("pointsThreshold",function(value){_raycaster.params.Points.threshold=value});this.debug=function(scene){var geom=new THREE.Geometry;geom.vertices.push(new THREE.Vector3(-100,0,0));geom.vertices.push(new THREE.Vector3(100,0,0));var mat=new THREE.LineBasicMaterial({color:1671168e1});_debug=new THREE.Line(geom,mat);scene.add(_debug)};this.checkHit=function(objects,mouse){mouse=mouse||Mouse;var rect=_this.rect||Stage;_mouse.x=mouse.x/rect.width*2-1;_mouse.y=-(mouse.y/rect.height)*2+1;_raycaster.setFromCamera(_mouse,_camera);return intersect(objects)};this.checkFromValues=function(objects,origin,direction){_raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY);return intersect(objects)}});Class(function ScreenProjection(_camera){Inherit(this,Component);var _this=this;var _v3=new THREE.Vector3;var _v32=new THREE.Vector3;var _value=new THREE.Vector3;(function(){}());this.set("camera",function(v){_camera=v});this.unproject=function(mouse,distance){var rect=_this.rect||Stage;_v3.set(mouse.x/rect.width*2-1,-(mouse.y/rect.height)*2+1,.5);_v3.unproject(_camera);var pos=_camera.position;_v3.sub(pos).normalize();var dist=distance||-pos.z/_v3.z;_value.copy(pos).add(_v3.multiplyScalar(dist));return _value};this.project=function(pos,screen){screen=screen||Stage;if(pos instanceof THREE.Object3D){pos.updateMatrixWorld();_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)}else{_v32.copy(pos)}_v32.project(_camera);_v32.x=(_v32.x+1)/2*screen.width;_v32.y=-(_v32.y-1)/2*screen.height;return _v32}});Class(function Shader(_vertexShader,_fragmentShader,_name,_material){Inherit(this,Component);var _this=this;this.receiveShadow=false;this.receiveLight=false;this.lights=[];this.uniforms={};this.name=_vertexShader;(function(){if(!_fragmentShader)_fragmentShader=_vertexShader;if(Hydra.LOCAL&&_name)expose();if(_material){_this.uniforms=_material.uniforms;_this.attributes=_material.attributes;defer(function(){if(_this.receiveLight){initLights();Render.start(updateLights)}})}}());function expose(){Dev.expose(_name,_this)}function process(code,type){var lights=initLights();var header="";if(!_this.useShaderMaterial&&!_this.receiveShadow){if(type=="vs"){header=["precision highp float;","precision highp int;","attribute vec2 uv;","attribute vec3 position;","attribute vec3 normal;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;",""].join("\n")}else{header=[code.includes("dFdx")?"#extension GL_OES_standard_derivatives : enable":"","precision highp float;","precision highp int;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;",""].join("\n")}}else{if(type=="fs"){header=["uniform mat4 modelViewMatrix;",""].join("\n")}}code=lights+code;code=header+code;var threeChunk=function threeChunk(a,b){return THREE.ShaderChunk[b]+"\n"};return code.replace(/#s?chunk\(\s?(\w+)\s?\);/g,threeChunk)}function initLights(){if(!_this.receiveLight)return"";var lighting=Lighting.getLighting(_this);var numLights=lighting.position.length;if(numLights==0){if(!Shader.disableWarnings)console.warn("Lighting enabled but 0 lights added. Be sure to add them before calling shader.material");return""}return["#define NUM_LIGHTS "+numLights,"uniform vec3 lightPos["+numLights+"];","uniform vec3 lightColor["+numLights+"];","uniform float lightIntensity["+numLights+"];","uniform float lightDistance["+numLights+"];",""].join("\n")}function updateMaterialLight(lighting){_material.uniforms.lightPos={type:"v3v",value:lighting.position};_material.uniforms.lightColor={type:"fv",value:lighting.color};_material.uniforms.lightIntensity={type:"fv1",value:lighting.intensity};_material.uniforms.lightDistance={type:"fv1",value:lighting.distance};Render.start(updateLights)}function updateLights(){if(_material.visible!==false)Lighting.update(_this,true)}this.get("material",function(){if(!_material){var params={};params.vertexShader=process(Shaders.getShader(_vertexShader+".vs")||_vertexShader,"vs");params.fragmentShader=process(Shaders.getShader(_fragmentShader+".fs")||_fragmentShader,"fs");if(_this.attributes)params.attributes=_this.attributes;if(_this.uniforms)params.uniforms=_this.uniforms;for(var uniform in _this.uniforms){if(typeof _this.uniforms[uniform].value=="undefined")throw"Uniforms need a value property"}if(_this.receiveShadow){for(var key in THREE.UniformsLib.lights){params.uniforms[key]=THREE.UniformsLib.lights[key]}}_material=_this.receiveShadow||_this.useShaderMaterial?new THREE.ShaderMaterial(params):new THREE.RawShaderMaterial(params);_material.shader=_this;_this.uniforms=_material.uniforms;if(_this.receiveLight)updateMaterialLight(_this.__lighting);if(_this.receiveShadow){_material.lights=true;if(params.vertexShader.includes("dFdx"))_material.extensions.derivatives=true}}return _material});this.set=function(key,value){if(typeof value!=="undefined")_this.uniforms[key].value=value;return _this.uniforms[key].value};this.getValues=function(){var out={};for(var key in _this.uniforms){out[key]=_this.uniforms[key].value}return out};this.copyUniformsTo=function(obj){for(var key in _this.uniforms){obj.uniforms[key]=_this.uniforms[key]}};this.cloneUniformsTo=function(obj){for(var key in _this.uniforms){obj.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value}}};this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)};this.clone=function(name){var shader=new Shader(_vertexShader,_fragmentShader,name||_name,_this.material.clone());shader.receiveLight=this.receiveLight;shader.receiveShadow=this.receiveShadow;shader.lights=this.lights;shader.material.shader=shader;return shader};this.updateLighting=function(){var lighting=Lighting.getLighting(_this,true);_material.uniforms.lightPos.value=lighting.position;_material.uniforms.lightColor.value=lighting.color;_material.uniforms.lightIntensity.value=lighting.intensity;_material.uniforms.lightDistance.value=lighting.distance};this.onDestroy=function(){Render.stop(updateLights);_material&&_material.dispose&&_material.dispose()}},function(){Shader.copyUniforms=function(to,from){for(var key in from.uniforms){to.uniforms[key]=from.uniforms[key]}};Shader.CustomBasicMaterial=function(vertexShader,fragmentShader,uniforms){if(typeof fragmentShader!=="string"){uniforms=fragmentShader;fragmentShader=vertexShader}function MeshCustomMaterial(parameters){THREE.MeshBasicMaterial.call(this);this.uniforms=THREE.UniformsUtils.merge([THREE.ShaderLib.basic.uniforms,uniforms]);setFlags(this);this.setValues(parameters)}MeshCustomMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);MeshCustomMaterial.prototype.constructor=MeshCustomMaterial;MeshCustomMaterial.prototype.isMeshBasicMaterial=true;MeshCustomMaterial.prototype.copy=function(source){THREE.MeshBasicMaterial.prototype.copy.call(this,source);this.uniforms=THREE.UniformsUtils.clone(source.uniforms);setFlags(this);return this};function setFlags(material){material.vertexShader=Shaders.getShader(vertexShader+".vs")||vertexShader;material.fragmentShader=Shaders.getShader(fragmentShader+".fs")||fragmentShader;material.type="MeshCustomMaterial"}return MeshCustomMaterial};Shader.CustomStandardMaterial=function(vertexShader,fragmentShader,uniforms){if(typeof fragmentShader!=="string"){uniforms=fragmentShader;fragmentShader=vertexShader}function MeshCustomMaterial(parameters){THREE.MeshStandardMaterial.call(this);this.uniforms=THREE.UniformsUtils.merge([THREE.ShaderLib.standard.uniforms,uniforms]);setFlags(this);this.setValues(parameters)}MeshCustomMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);MeshCustomMaterial.prototype.constructor=MeshCustomMaterial;MeshCustomMaterial.prototype.isMeshStandardMaterial=true;MeshCustomMaterial.prototype.copy=function(source){THREE.MeshStandardMaterial.prototype.copy.call(this,source);this.uniforms=THREE.UniformsUtils.clone(source.uniforms);setFlags(this);return this};function setFlags(material){material.vertexShader=Shaders.getShader(vertexShader+".vs")||vertexShader;material.fragmentShader=Shaders.getShader(fragmentShader+".fs")||fragmentShader;material.type="MeshCustomMaterial"}return MeshCustomMaterial}});Class(function ParticlePhysicsBufferConverter(_geom,_system){Inherit(this,Component);var _this=this;var _convert=[];var _particles=_system.particles;_convert.push({name:"position",props:["x","y","z"],size:3});this.add=function(name,props){var obj={name:name,props:props,size:props.length};_convert.push(obj);return obj};this.exec=function(){var index=0;var p=_particles.start();while(p){for(var i=_convert.length-1;i>-1;i--){var obj=_convert[i];if(obj.disabled)continue;var attribute=_geom.attributes[obj.name];for(var j=0;j<obj.size;j++){attribute.array[index*obj.size+j]=p[obj.props[j]]||p.pos[obj.props[j]]||0}attribute.needsUpdate=true}++index;p=_particles.next()}};this.find=function(name){for(var i=0;i<_convert.length;i++){var obj=_convert[i];if(obj.name==name)return obj}}});Class(function RandomEulerRotation(_container){var _this=this;var _euler=["x","y","z"];var _rot;this.speed=1;(function(){initRotation()}());function initRotation(){_rot={};_rot.x=Math.random(0,2);_rot.y=Math.random(0,2);_rot.z=Math.random(0,2);_rot.vx=Math.random(-5,5)*.0025;_rot.vy=Math.random(-5,5)*.0025;_rot.vz=Math.random(-5,5)*.0025}this.update=function(){var time=Render.TIME;for(var i=0;i<3;i++){var v=_euler[i];switch(_rot[v]){case 0:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 1:_container.rotation[v]+=Math.cos(Math.sin(time*.25))*_rot["v"+v]*_this.speed;break;case 2:_container.rotation[v]+=Math.cos(Math.cos(time*.25))*_rot["v"+v]*_this.speed;break}}};this.startRender=function(){Render.start(_this.update)};this.stopRender=function(){Render.stop(_this.update)};this.onDestroy=function(){this.stopRender()}});Class(function Utils3D(){var _this=this;var _objectLoader,_geomLoader,_bufferGeomLoader;var _textures={};AssetLoader.waitForLib("THREE",function(){if(!window.Vector2){window.Vector2=THREE.Vector2;window.Vector3=THREE.Vector3;window.Vector4=THREE.Vector4;window.Matrix3=THREE.Matrix3;window.Matrix4=THREE.Matrix4;window.Quaternion=THREE.Quaternion}if(!window.Vec2){window.Vec2=THREE.Vector2;window.Vec3=THREE.Vector3;window.Vec4=THREE.Vector4;window.Mat3=THREE.Matrix3;window.Mat4=THREE.Matrix4;window.Quat=THREE.Quaternion}});this.decompose=function(local,world){local.matrixWorld.decompose(world.position,world.quaternion,world.scale)};this.createDebug=function(size,color){var geom=new THREE.IcosahedronGeometry(size||40,1);var mat=color?new THREE.MeshBasicMaterial({color:color}):new THREE.MeshNormalMaterial;return new THREE.Mesh(geom,mat)};this.createRT=function(width,height){var params={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:false};return new THREE.WebGLRenderTarget(width,height,params)};this.getTexture=function(path){if(!_textures[path]){var texture=new THREE.Texture;texture.promise=Promise.create();texture._dispose=texture.dispose;texture.dispose=function(){delete _textures[path];this._dispose()};_textures[path]=texture;Assets.decodeImage(path).then(function(imgBmp){texture.image=imgBmp;texture.needsUpdate=true;if(!THREE.Math.isPowerOfTwo(imgBmp.width*imgBmp.height))texture.minFilter=THREE.LinearFilter;texture.onUpdate=function(){if(imgBmp.close)imgBmp.close();texture.onUpdate=null};texture.promise.resolve();if(texture.onload){texture.onload();texture.onload=null}})}return _textures[path]};this.setInfinity=function(v){var inf=Number.POSITIVE_INFINITY;v.set(inf,inf,inf);return v};this.getCubemap=function(src){var path="cube_"+(Array.isArray(src)?src[0]:src);if(!_textures[path]){var images=[];for(var i=0;i<6;i++){var img=new Image;img.crossOrigin="";img.src=Assets.getPath(Array.isArray(src)?src[i]:src);images.push(img);img.onload=function(){_textures[path].needsUpdate=true}}_textures[path]=new THREE.Texture;_textures[path].image=images;_textures[path].minFilter=THREE.LinearFilter}return _textures[path]};this.loadObject=function(name){var json=(typeof name==="undefined"?"undefined":_typeof(name))=="object"?name:Assets.JSON[name];if(json.type=="hydra_c4d"){var group=new THREE.Group;var mat=new THREE.MeshBasicMaterial({wireframe:true,color:104448e1});json.geometries.forEach(function(obj){var data=obj.data;var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));var mesh=new THREE.Mesh(geometry,mat);mesh.position.copy(obj.position);mesh.rotation.x=obj.rotation.x;mesh.rotation.y=obj.rotation.y;mesh.rotation.z=obj.rotation.z;mesh.scale.copy(obj.scale);mesh.name=obj.id;group.add(mesh)});return group}else{if(!_objectLoader)_objectLoader=new THREE.ObjectLoader;return _objectLoader.parse(Assets.JSON[name])}};this.loadGeometry=function(name){if(!_geomLoader)_geomLoader=new THREE.JSONLoader;if(!_bufferGeomLoader)_bufferGeomLoader=new THREE.BufferGeometryLoader;var json=Assets.JSON[name];if(json.type=="BufferGeometry"){return _bufferGeomLoader.parse(json)}else{return _geomLoader.parse(json.data).geometry}};this.disposeAllTextures=function(){for(var key in _textures){_textures[key].dispose()}};this.disableWarnings=function(){window.console.warn=function(str,msg){};window.console.error=function(){}};this.loadBufferGeometry=function(name){var data=Assets.JSON[name];var geometry=new THREE.BufferGeometry;if(data.data)data=data.data;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal||data.position.length),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv||data.position.length/3*2),2));return geometry};this.loadSkinnedGeometry=function(name){var data=Assets.JSON[name];var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(data.position),3));geometry.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(data.normal),3));geometry.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(data.uv),2));geometry.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(data.skinIndices),4));geometry.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(data.skinWeights),4));geometry.bones=data.bones.slice(0);return geometry};this.loadCurve=function(obj){if(typeof obj==="string")obj=Assets.JSON[obj];var data=obj;var points=[];for(var j=0;j<data.length;j+=3){points.push(new THREE.Vector3(data[j+0],data[j+1],data[j+2]))}return new THREE.CatmullRomCurve3(points)};this.setLightCamera=function(light,size,near,far,texture){light.shadow.camera.left=-size;light.shadow.camera.right=size;light.shadow.camera.top=size;light.shadow.camera.bottom=-size;light.castShadow=true;if(near)light.shadow.camera.near=near;if(far)light.shadow.camera.far=far;if(texture)light.shadow.mapSize.width=light.shadow.mapSize.height=texture;light.shadow.camera.updateProjectionMatrix()};this.getRepeatTexture=function(src){var texture=this.getTexture(src);texture.onload=function(){texture.wrapS=texture.wrapT=THREE.RepeatWrapping};return texture};this.forceVisible=function(group){var setProperties=function setProperties(obj){if(typeof obj.visible!=="undefined"){obj.__visible=obj.visible;obj.visible=true}if(typeof obj.frustumCulled!=="undefined"){obj.__frustumCulled=obj.frustumCulled;obj.frustumCulled=false}};var children=group.children;children.forEach(function(child){setProperties(child);if(child.material)setProperties(child.material);_this.forceVisible(child)})};this.resetForceVisible=function(group){var setProperties=function setProperties(obj){if(typeof obj.__visible!=="undefined"){obj.visible=obj.__visible;delete obj.__visible}if(typeof obj.__frustumCulled!=="undefined"){obj.frustumCulled=obj.__frustumCulled;delete obj.__frustumCulled}};var children=group.children;children.forEach(function(child){setProperties(child);if(child.material)setProperties(child.material);_this.resetForceVisible(child)})};this.findTexturesByPath=function(path){var array=[];for(var key in _textures){if(key.includes(path))array.push(_textures[key])}return array}},"static");Class(function Warp($object,_useCSS){Inherit(this,Component);var _this=this;var _time,_setupCSS,_complete;this.useCSS=_useCSS;var point=function point(){this.x=0;this.y=0};this.points=[new point,new point,new point,new point];this.tl=this.points[0];this.tr=this.points[1];this.bl=this.points[2];this.br=this.points[3];function setDefaultPoints(){if(_this.points[1].x==0)_this.points[1].x=_this.width;if(_this.points[2].y==0)_this.points[2].y=_this.height;if(_this.points[3].x==0)_this.points[3].x=_this.width;if(_this.points[3].y==0)_this.points[3].y=_this.height}function general2DProjection(x1s,y1s,x1d,y1d,x2s,y2s,x2d,y2d,x3s,y3s,x3d,y3d,x4s,y4s,x4d,y4d){var s=basisToPoints(x1s,y1s,x2s,y2s,x3s,y3s,x4s,y4s);var d=basisToPoints(x1d,y1d,x2d,y2d,x3d,y3d,x4d,y4d);return multmm(d,adj(s))}function basisToPoints(x1,y1,x2,y2,x3,y3,x4,y4){var m=[x1,x2,x3,y1,y2,y3,1,1,1];var v=multmv(adj(m),[x4,y4,1]);return multmm(m,[v[0],0,0,0,v[1],0,0,0,v[2]])}function adj(m){return[m[4]*m[8]-m[5]*m[7],m[2]*m[7]-m[1]*m[8],m[1]*m[5]-m[2]*m[4],m[5]*m[6]-m[3]*m[8],m[0]*m[8]-m[2]*m[6],m[2]*m[3]-m[0]*m[5],m[3]*m[7]-m[4]*m[6],m[1]*m[6]-m[0]*m[7],m[0]*m[4]-m[1]*m[3]]}function multmm(a,b){var c=Array(9);for(var i=0;i!=3;++i){for(var j=0;j!=3;++j){var cij=0;for(var k=0;k!=3;++k){cij+=a[3*i+k]*b[3*k+j]}c[3*i+j]=cij}}return c}function multmv(m,v){return[m[0]*v[0]+m[1]*v[1]+m[2]*v[2],m[3]*v[0]+m[4]*v[1]+m[5]*v[2],m[6]*v[0]+m[7]*v[1]+m[8]*v[2]]}function transform2d(points,w,h){var x1=points[0].x;var y1=points[0].y;var x2=points[1].x;var y2=points[1].y;var x3=points[2].x;var y3=points[2].y;var x4=points[3].x;var y4=points[3].y;var t=general2DProjection(0,0,x1,y1,w,0,x2,y2,0,h,x3,y3,w,h,x4,y4);for(var i=0;i<9;i++){t[i]=t[i]/t[8]}t=[t[0],t[3],0,t[6],t[1],t[4],0,t[7],0,0,1,0,t[2],t[5],0,t[8]];if(Device.system.os=="ios"||Device.system.browser=="safari"){for(var i=0;i<t.length;i++){t[i]=t[i].toFixed(8)}}t="matrix3d("+t.join(", ")+")";return t}function applyCSS(time,ease){_setupCSS=false;var transform=transform2d(_this.points,_this.width,_this.height);var tween=CSS.transformProperty+" "+time+"ms "+TweenManager.getEase(ease)+" 0ms";$object.div.style[CSS.styles.vendorTransition]=tween;$object.div.style[CSS.styles.vendorTransform]=transform;_this.delayedCall(function(){if(_complete)_complete();_complete=null;if($object.willChange){$object.willChange(false);$object.div.style[CSS.styles.vendorTransition]=""}},time)}(function(){}());this.render=function(){var t=Render.TIME;if(t-_time<5||!_this.points||!$object.div)return false;_time=t;if(!_this.width){_this.width=$object.width;_this.height=$object.height;$object.transformPoint(0,0);if(!_this.width)throw"Warp requires width and height";setDefaultPoints()}$object.div.style[CSS.prefix("Transform")]=transform2d(_this.points,_this.width,_this.height)};this.tween=function(point,properties,time,ease,delay,complete){if(!this.points)return;if(typeof delay!=="number"){complete=delay;delay=0}var p;switch(point){case"tl":p=this.points[0];break;case"tr":p=this.points[1];break;case"bl":p=this.points[2];break;case"br":p=this.points[3];break;default:throw point+"not found on WarpView. Only tl, tr, bl, br accepted.";break}if(this.useCSS){if(!_setupCSS){$object.willChange(CSS.transformProperty);_setupCSS=true;_this.render();Render.setupTween(function(){applyCSS(time,ease)})}if(complete)_complete=complete;p.copyFrom(properties)}else{return tween(p,properties,time,ease,delay,complete,this.render)}};this.destroy=function(){this.points.forEach(function(p){TweenManager.clearTween(p)});return this._destroy()}});Class(function WiggleBehavior(_position,_angle){Inherit(this,Component);var _this=this;_angle=_angle||Math.radians(Math.rand(0,360));var _wobble=new THREE.Vector3;var _origin=new THREE.Vector3;this.target=_wobble;this.scale=1;this.alpha=.025;this.speed=1;this.zMove=2;this.enabled=true;(function(){if(_position)_origin.copy(_position)}());this.update=function(){if(!_this.enabled||_this.disabled)return;var t=window.Render?Render.TIME||Date.now():Date.now();_wobble.x=Math.cos(_angle+t*(.00075*_this.speed))*(_angle+Math.sin(t*(.00095*_this.speed))*200);_wobble.y=Math.sin(Math.asin(Math.cos(_angle+t*(.00085*_this.speed))))*(Math.sin(_angle+t*(.00075*_this.speed))*150);_wobble.x*=Math.sin(_angle+t*(.00075*_this.speed))*2;_wobble.y*=Math.cos(_angle+t*(.00065*_this.speed))*1.75;_wobble.x*=Math.cos(_angle+t*(.00075*_this.speed))*1.1;_wobble.y*=Math.sin(_angle+t*(.00025*_this.speed))*1.15;_wobble.z=Math.sin(_angle+_wobble.x*.0025)*(100*_this.zMove);_wobble.multiplyScalar(_this.scale*.1);_wobble.add(_origin);if(_position){if(_this.ease)_position.interp(_wobble,_this.alpha,_this.ease);else _position.lerp(_wobble,_this.alpha)}};this.copyOrigin=function(){_origin.copy(_position)};this.startRender=function(){Render.start(_this.update)};this.stopRender=function(){Render.stop(_this.update)};this.onDestroy=function(){Render.stop(_this.update)}});Class(function Tests(){this.getDPR=function(){if(GPU.lt(1))return 1;if(GPU.mobileLT(1))return 1;return Math.min(Device.pixelRatio,1.75)};this.playExploreVideo=function(){if(Device.system.os=="ios")return false;return true};this.introLine1Size=function(){return 104};this.introLine2Size=function(){return 206};this.cinematicTrailerSpace=function(){if(window.__locale=="es-ES")return 260;if(window.__locale=="ru")return 300;return 220};this.introPromptSize=function(){if(window.__locale=="pl")return 480;if(window.__locale=="pt-BR")return 420;return 340};this.introTitleSpace=function(){if(window.__locale=="pl")return 50;if(window.__locale=="ru")return 40;if(window.__locale=="es-MX")return 40;return 0};this.skipPromptWidth=function(){if(window.__locale=="es-ES")return 120;if(window.__locale=="de")return 250;if(window.__locale=="fr")return 120;if(window.__locale=="pl")return 120;if(window.__locale=="ru")return 160;return 100};this.beginMissionPromptWidth=function(){if(window.__locale=="de")return 230;if(window.__locale=="es-ES")return 230;if(window.__locale=="es-MX")return 230;if(window.__locale=="fr")return 320;if(window.__locale=="it")return 240;if(window.__locale=="pl")return 240;return 220};this.buildTitleSpace=function(){if(window.__locale=="fr")return 50;return 0};this.buildPromptWidth=function(){if(window.__locale=="de")return 300;if(window.__locale=="fr")return 320;if(window.__locale=="it")return 320;if(window.__locale=="pt-BR")return 320;return 260};this.upgradePromptWidth=function(){if(window.__locale=="fr")return 250;if(window.__locale=="pt-BR")return 250;return 180};this.fortTitleSize=function(){if(window.__locale=="pt-BR")return 120;if(window.__locale=="it")return 120;if(window.__locale=="pl")return 110;return 140};this.defendPromptWidth=function(){if(window.__locale=="de")return 400;return 320};this.teamUpSize=function(){if(window.__locale=="de")return 1.1;if(window.__locale=="es-ES")return.9;if(window.__locale=="es-MX")return 1.1;if(window.__locale=="fr")return.9;if(window.__locale=="pl")return 1.3;return 1.55};this.teamUpFontSize=function(){if(window.__locale=="it")return 130;if(window.__locale=="ru")return 150;return 300}},"static");Class(function Tracking(){var DEBUG=false;this.sectionScroll={eventCategory:"scrolling",eventAction:"section-scroll",group:"sections"};this.scrollPrompt={eventCategory:"scrolling",eventAction:"scroll-prompt",group:"sections"};this.sideNav={eventCategory:"side-navigation",eventAction:"side-nav",group:"sections"};this.preOrder={eventCategory:"pre-order",eventAction:"clicked",eventLabel:"landing"};this.gameplayTrailer={eventCategory:"video",eventAction:"gameplay-trailer",eventLabel:"landing"};this.cinematicTrailer={eventCategory:"video",eventAction:"cinematic-trailer",eventLabel:"landing"};this.skipVideo={eventCategory:"video",eventAction:"skip-video",eventLabel:"explore"};this.completeVideo={eventCategory:"video",eventAction:"complete-video",eventLabel:"explore"};this.beginMission={eventCategory:"explore",eventAction:"begin-mission",eventLabel:"explore"};this.hotspot={eventCategory:"collect",eventAction:"hotspot",group:"hotspots"};this.buildFort={eventCategory:"collect",eventAction:"build-fort",eventLabel:"collect"};this.upgrade={eventCategory:"forts",eventAction:"upgrade",group:"forts"};this.defendPrompt={eventCategory:"forts",eventAction:"defend-prompt",eventLabel:"forts"};this.weaponNav={eventCategory:"weapons",eventAction:"weapon-nav",group:"weapons"};this.weaponSwipe={eventCategory:"weapons",eventAction:"weapon-swipe",group:"weapons"};this.heroes={eventCategory:"team",eventAction:"heroes",eventLabel:"team"};this.enemies={eventCategory:"team",eventAction:"enemies",eventLabel:"team"};this.focus={eventCategory:"team",eventAction:"focus",group:"heroes"};this.defocus={eventCategory:"team",eventAction:"defocus",group:"heroes"};var _groups={sections:["landing","explore","collect","forts","weapons","team"],weapons:["breacher","bullseye","sword","crusader","spikes"],hotspots:["planks","brick","metal","bolts"],forts:["shack","fortress"],heroes:["outlander","soldier","ninja","constructor"]};this.event=function(event,index){var eventLabel=event.eventLabel||((typeof index==="undefined"?"undefined":_typeof(index))!==undefined&&event.group?_groups[event.group][index]:null);if(window.ga)ga("send","event",event.eventCategory,event.eventAction,eventLabel);if(DEBUG)console.log("send","event",event.eventCategory,event.eventAction,eventLabel)};this.pageView=function(index){var section=_groups.sections[index];if(window.ga)ga("send","pageview",location.pathname+"/explore/"+section);if(DEBUG)console.log("send","pageview",location.pathname+"/explore/"+section)}},"static");Class(function Blocker(){Inherit(this,Element);var _this=this;var $container,$message,$text,$icon;var _dimensions={};var _anim,_logo;var _cover=false;var _lockLandscape=true;(function(){initHTML();initSize();addListener();checkOrientation()}());function initHTML(){$container=_this.element;$container.size("100%").setZ(1e11).bg("#382e4a");$container.hide();Stage.add($container);$message=$container.create("rotation-message").size(400,400).center();$message.css({opacity:0}).transform({scale:1.1});$icon=$message.create("icon");$icon.size(100,100).center().bg("assets/images/common/ui/rotate.png");_anim=_this.initClass(CSSAnimation);_anim.loop=true;_anim.ease="easeInOutQuint";_anim.duration=3e3;_anim.frames=[{rotation:0},{rotation:-180}];_anim.applyTo($icon)}function initSize(){_dimensions.width=Stage.width;_dimensions.height=Stage.height}function rotateMessage(flip){if(flip){$container.show();_anim.play();$message.tween({opacity:1,scale:1},15e2,"easeOutCubic",200)}else{_this.landscape=true;_anim.stop();$container.hide();$message.css({opacity:0})}_cover=flip}function addListener(){_this.events.sub(Events.RESIZE,checkOrientation)}function checkOrientation(){if(!Device.mobile)return;if(Stage.width<Stage.height&&(Stage.height>_dimensions.height*.9||Stage.height>_dimensions.width*.9))rotateMessage(true);else rotateMessage(false)}this.ready=function(){if(!Device.mobile)return Promise.resolve();var promise=Promise.create();this.wait(promise.resolve,_this,"landscape");return promise}},"Singleton");Class(function Container(){Inherit(this,Element);var _this=this;var $this=this.element;var _intro=void 0,_scroll=void 0;var _sections=[];(function(){$this.css({position:"static"});Stage.add($this);initIntro();loadDynamicIntro()}());function initIntro(){_intro=_this.initClass(Intro);_sections.push(_intro);Tracking.pageView(0)}function loadDynamicIntro(){var loader=_this.initClass(AssetLoader,Assets.list().filter(["intro/","geometry/characters","js/lib","shaders/"]));loader.add(1);Promise.all([AssetLoader.waitForLib("THREE"),Shaders.ready()]).then(function(){loader.trigger()});var loaded=function loaded(){_this.events.unsub(loader,Events.COMPLETE,loaded);initDynamicIntro();loadSections()};_this.events.sub(loader,Events.COMPLETE,loaded)}function initDynamicIntro(){World.instance();Stage.add(World.ELEMENT);World.ELEMENT.setZ(-1);World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;World.ready().then(_intro.initScene)}function loadSections(){var loader=_this.initClass(AssetLoader,Assets.list());var bar=_this.initClass(LoaderBar);_this.events.sub(loader,Events.PROGRESS,bar.progress);_this.events.sub(loader,Events.COMPLETE,function(){bar.animateOut(function(){bar=bar.destroy()});initSections()})}function initSections(){var explore=void 0,collect=void 0,forts=void 0,weapons=void 0,team=void 0;var delay=200;_this.delayedCall(function(){return explore=_this.initClass(Explore)},delay);_this.delayedCall(function(){return collect=_this.initClass(Collect)},delay+=100);_this.delayedCall(function(){return forts=_this.initClass(Forts)},delay+=100);_this.delayedCall(function(){return weapons=_this.initClass(Weapons)},delay+=100);_this.delayedCall(function(){return team=_this.initClass(Team)},delay+=200);_this.delayedCall(function(){_sections.push(explore);_sections.push(collect);_sections.push(forts);_sections.push(weapons);_sections.push(team);Config.CLASS_NAMES.forEach(function(className,i){var isLast=i==Config.CLASS_NAMES.length-1;var controlled=_this.initClass(Controlled,className,isLast);_sections.push(controlled)});var footer=_this.initClass(Footer);_sections.push(footer);_scroll=_this.initClass(ScrollInteraction,_sections);_this.initClass(NavView,_scroll);StormWipe.instance();BlockWipe.instance()},delay+=200)}},"singleton");Class(function Playground(){Inherit(this,Component);var _this=this;var _view;(function(){Global.PLAYGROUND=Utils.query("p")||Utils.query("playground");initThree();initView();defer(window.onresize);Mobile.isAllowNativeScroll=false}());function initThree(){World.instance();Stage.add(World.ELEMENT)}function initView(){var request=Global.PLAYGROUND.split("/")[0];var view=window["Playground"+request]||window[request]||null;if(!view)throw"No Playground class "+request+" found.";_view=!!view.instance?view.instance():_this.initClass(view);if(_view.element)Stage.add(_view.element);World.SCENE.add(_view.group||_view.mesh||_view.object3D||new THREE.Group);Dev.expose("view",_view)}},"singleton");Class(function ScrollInteraction(_sections){Inherit(this,Component);var _this=this;var $prompt=void 0;var _scroll=void 0,_current=void 0;var _progress=0;var _active=0;(function(){init();initPrompt();addHandlers();_this.startRender(loop)}());function init(){_this.events.fire(FortniteEvents.PAGE_CHANGE,{index:0,init:true});_active=0;_current=_sections[_active]}function initPrompt(){$prompt=Stage.create("ScrollPrompt");$prompt.inner=$prompt.create("Inner");$prompt.css({bottom:70,right:70});$prompt.inner.css({opacity:0,background:'url("'+Assets.getPath("assets/images/common/ui/arrow-down.png")+'") no-repeat',backgroundColor:"#feff02",backgroundSize:"14px 14px",backgroundPosition:"center center",padding:20,margin:-20,borderRadius:1e3});$prompt.y=0;animateInPrompt(true)}function loop(){_progress+=_scroll.delta.y;_progress+=(0-_progress)*.3;$prompt.y+=(_progress*.3-$prompt.y)*.2;if(Math.abs($prompt.y)<.1)$prompt.y=0;$prompt.transform();if(Math.abs(_progress)>100){_this.events.fire(FortniteEvents.SCROLL_INTENT);if(_this.isPaused||_this.isTransition)return;if(_progress>0)increment(1,"scroll");if(_progress<0)increment(-1,"scroll")}}function increment(dir,refer){var index=_active;index+=dir;index=Math.min(_sections.length-1,index);index=Math.max(0,index);if(index!==_active){_this.events.fire(FortniteEvents.PAGE_CHANGE,{index:index,isScroll:refer==="scroll",isPrompt:refer==="prompt"})}}function animateInPrompt(isInit){if(isInit){$prompt.inner.transform({scale:.5});$prompt.inner.tween({opacity:1,scale:1},1e3,"easeOutElastic");return}$prompt.inner.transform({scale:1});$prompt.inner.tween({opacity:1},600,"easeInOutCubic")}function animateOutPrompt(){$prompt.inner.tween({opacity:0},200,"easeOutCubic")}function addHandlers(){_scroll=_this.initClass(Scroll,{limit:false});$prompt.interact(null,click);$prompt.hit.css({padding:30,margin:-30,borderRadius:"100%"});_this.events.sub(Events.MOUNT,mount);_this.events.sub(Events.UNMOUNT,unmount);_this.events.sub(FortniteEvents.PAUSE_SCROLL,pause);_this.events.sub(FortniteEvents.RESUME_SCROLL,resume);_this.events.sub(FortniteEvents.INCREMENT_SCROLL,forceIncrement);_this.events.sub(FortniteEvents.PAGE_CHANGE,pageChange)}function pageChange(e){if(e.init)return;_this.isTransition=true;var dir=Math.sign(e.index-_active);animateOutPrompt();var transition=3;if(_active===0||e.index===0){transition=1;StormWipe.instance().wipe(dir)}else if(_active<6&&e.index<6){transition=2;BlockWipe.instance().wipe(dir)}_current.scrollOut(dir,transition);_active=e.index;_current=_sections[_active];_current.scrollIn(dir,transition);_this.wait(_current,"animComplete",function(){_this.delayedCall(function(){_this.isTransition=false;if(!_this.isPaused)animateInPrompt()},Device.mobile?500:0)});if(_active<6){Tracking.pageView(_active);if(e.isScroll)Tracking.event(Tracking.sectionScroll,_active);if(e.isPrompt)Tracking.event(Tracking.scrollPrompt,_active)}}function click(){if(Global.PAUSED||_this.isPaused||_this.isTransition)return;increment(1,"prompt")}function mount(){_scroll.enabled=true}function unmount(){_scroll.enabled=false}function pause(){_this.isPaused=true;animateOutPrompt()}function resume(){_this.isPaused=false;if(_current.animComplete)animateInPrompt()}function forceIncrement(e){increment(e.dir)}});Class(function Collect(){Inherit(this,Element);var _this=this;var $this=this.element;var _movement=void 0,_view=void 0,_scene=void 0,_animTimer=void 0;(function(){if(Utils.query("p")=="Collect"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.scrollIn(1)})}$this.css({position:"static"});initViews()}());function initViews(){_movement=_this.initClass(CollectMovement);_view=_this.initClass(CollectView,_movement.move);_scene=_this.initClass(CollectScene,_movement.move)}this.scrollIn=function(dir){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);if(_view.isComplete){_movement.reset();_view.reset()}_movement.scrollIn(dir);_view.scrollIn(dir);_scene.scrollIn(dir)};this.scrollOut=function(dir){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_movement.scrollOut(dir);_view.scrollOut(dir);_scene.scrollOut(dir)}});Class(function Controlled(_classname,_isLast){Inherit(this,Component);var _this=this;var $view=void 0;var _animTimer=void 0;(function(){mount();addHandlers()}());function addHandlers(){_this.events.sub(Events.RESIZE,resize);_this.events.sub(Events.MOUNT,mount);_this.events.sub(Events.UNMOUNT,unmount);_this.events.sub(Events.SCROLL_TO_TOP,scrollToTop)}function resize(){if(Global.PAUSED)return;if(!$view)return;$view.css({width:Stage.width,height:Stage.height})}function mount(){var div=document.querySelectorAll(_classname)[0];if(div){$view=$(div)}else{$view=Stage.create("Controlled");$view.css({background:"#4a2966"})}$view.css({position:"absolute",top:0}).setZ(10);if(!_this.isActive)$view.hide();div=document.querySelectorAll("#homePage")[0];if(div)$(div).css({overflow:"hidden"});resize()}function unmount(){$view.css({position:"relative",top:0,zIndex:"auto"})}function scrollToTop(){if(!_isLast)return;_this.scrollOut(-1)}this.scrollIn=function(dir){_this.isActive=true;if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);if(_isLast&&dir<0){_this.isFooterOpen=false;$view.tween({y:0,math:true},500,"easeOutCubic");return}$view.show();$view.transform({y:Stage.height*dir});$view.tween({y:0,math:true},500,"easeOutCubic")};this.scrollOut=function(dir){_this.isActive=false;if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;if(_isLast&&dir>0){_this.isFooterOpen=true;defer(function(){$view.tween({y:-Global.FOOTER_HEIGHT,math:true},500,"easeOutCubic")});return}$view.tween({y:Stage.height*-dir,math:true},500,"easeOutCubic").onComplete(function(){$view.hide()})}});Class(function Explore(){Inherit(this,Element);var _this=this;var $this=this.element;var _view=void 0,_scene=void 0,_animTimer=void 0;(function(){if(Utils.query("p")=="Explore"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.scrollIn(1)});_this.delayedCall(function(){videoComplete()},1e3)}$this.css({position:"static"});initScene();initView();addHandlers();Ray.instance()}());function initView(){_view=_this.initClass(ExploreView,_scene)}function initScene(){_scene=_this.initClass(ExploreScene)}function addHandlers(){_this.events.sub(_view,Events.COMPLETE,videoComplete)}function videoComplete(){_this.isVideoComplete=true;_view.videoComplete();_scene.videoComplete()}this.scrollIn=function(dir,transition){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);_view.scrollIn(dir,transition);_scene.scrollIn(dir,transition)};this.scrollOut=function(dir,transition){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_view.scrollOut(dir,transition);_scene.scrollOut(dir,transition)}});Class(function Footer(){Inherit(this,Component);var _this=this;var $view=void 0,$parent=void 0,$explore=void 0;var _animTimer=void 0;var _height=0;(function(){mount();addHandlers()}());function addHandlers(){_this.events.sub(Events.RESIZE,resize);_this.events.sub(Events.MOUNT,mount);_this.events.sub(Events.UNMOUNT,unmount)}function resize(){if(Global.PAUSED)return;if(!$view)return;_height=$view.div.clientHeight;Global.FOOTER_HEIGHT=_height;if(_this.isActive){$view.transform({y:Stage.height-_height})}if($explore)$explore.css({height:Stage.height})}function mount(){var div=document.querySelectorAll("footer")[0];if(div){$view=$(div);$parent=$($view.div.parentNode);resize()}else{$view=Stage.create("Footer");$view.css({background:"#111"});$parent=$("FooterParent")}$view.setZ(10);$parent.css({position:"absolute",top:0,width:"100%"});if(!_this.isActive)$view.hide();div=document.querySelectorAll(".fortnite-wrapper")[0];if(div)$(div).css({overflow:"hidden"});div=document.querySelectorAll(".explore-container")[0];if(div){$explore=$(div);resize()}else{$explore=Stage.create("ExploreContainer")}resize()}function unmount(){$view.show();$view.css({width:"auto",height:"auto"});$view.clearTransform();$parent.css({position:"relative",top:"auto",width:"auto"})}this.scrollIn=function(dir){_this.isActive=true;if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);$view.show();$view.transform({y:Stage.height*dir});_height=$view.div.clientHeight;Global.FOOTER_HEIGHT=_height;$view.tween({y:Stage.height-_height,math:true},500,"easeOutCubic")};this.scrollOut=function(dir){_this.isActive=false;if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;$view.tween({y:Stage.height*-dir,math:true},500,"easeOutCubic").onComplete(function(){$view.hide()})}});Class(function Forts(){Inherit(this,Element);var _this=this;var $this=this.element;var _view=void 0,_scene=void 0,_animTimer=void 0;(function(){if(Utils.query("p")=="Forts"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.scrollIn(1)});_this.delayedCall(function(){},2e3)}$this.css({position:"static"});initViews()}());function initViews(){_scene=_this.initClass(FortsScene);_view=_this.initClass(FortsView,_scene)}this.scrollIn=function(dir){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);_view.scrollIn(dir);_scene.scrollIn(dir)};this.scrollOut=function(dir){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_view.scrollOut(dir);_scene.scrollOut(dir)}});Class(function Intro(){Inherit(this,Element);var _this=this;var $this=this.element;var _view=void 0,_scene=void 0,_animTimer=void 0;(function(){if(Utils.query("p")=="Intro"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.initScene()});_this.delayedCall(function(){},2e3)}$this.css({position:"static"});initView()}());function initView(){_view=_this.initClass(IntroView)}this.initScene=function(){_scene=_this.initClass(IntroScene);_view.loaded()};this.scrollIn=function(dir){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);_view.scrollIn(dir);_scene.scrollIn(dir)};this.scrollOut=function(dir){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_view.scrollOut(dir);_scene.scrollOut(dir)}});Class(function Team(){Inherit(this,Element);var _this=this;var $this=this.element;var _view=void 0,_scene=void 0,_animTimer=void 0;var _copy={title:Copy.messages["epic.fortnite.at.explore.team.title"],heroes:Copy.messages["epic.fortnite.at.explore.team.heroes"],enemies:Copy.messages["epic.fortnite.at.explore.team.enemies"],enemiesText:Copy.messages["epic.fortnite.at.explore.team.enemies.description"],hero1Text:Copy.messages["epic.fortnite.at.explore.team.hero3.description"],hero1Title:Copy.messages["epic.fortnite.at.explore.team.hero3.name"],hero2Text:Copy.messages["epic.fortnite.at.explore.team.hero1.description"],hero2Title:Copy.messages["epic.fortnite.at.explore.team.hero1.name"],hero3Text:Copy.messages["epic.fortnite.at.explore.team.hero4.description"],hero3Title:Copy.messages["epic.fortnite.at.explore.team.hero4.name"],hero4Text:Copy.messages["epic.fortnite.at.explore.team.hero2.description"],hero4Title:Copy.messages["epic.fortnite.at.explore.team.hero2.name"]};(function(){if(Utils.query("p")=="Team"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.scrollIn(1)});_this.delayedCall(function(){},1e3);Ray.instance().close()}$this.css({position:"static"});initViews();defer(function(){_this.events.fire(Team.HEROES)})}());function initViews(){_view=_this.initClass(TeamView,_copy);_scene=_this.initClass(TeamScene,_copy)}this.scrollIn=function(dir){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);_view.scrollIn(dir);_scene.scrollIn(dir)};this.scrollOut=function(dir){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_view.scrollOut(dir);_scene.scrollOut(dir)}},function(){Team.ENEMIES="fortnite_team_enemies";Team.HEROES="fortnite_team_heroes";Team.ACTIVATE_INFO="fortnite_activate_info";Team.DEACTIVATE_INFO="fortnite_deativate_info";Team.HOVER_IN="fortnite_hover_in";Team.HOVER_OUT="fortnite_hover_out"});Class(function Weapons(){Inherit(this,Element);var _this=this;var $this=this.element;var _interaction=void 0,_view=void 0,_scene=void 0,_animTimer=void 0;var _copy={cta:Copy.messages["epic.fortnite.at.explore.weapons.cta"],description:Copy.messages["epic.fortnite.at.explore.weapons.description"],name:Copy.messages["epic.fortnite.at.explore.weapons.name"],rey1:Copy.messages["epic.fortnite.at.explore.weapons.rey1"],rey2:Copy.messages["epic.fortnite.at.explore.weapons.rey2"],rey3:Copy.messages["epic.fortnite.at.explore.weapons.rey3"],rey4:Copy.messages["epic.fortnite.at.explore.weapons.rey4"],title:Copy.messages["epic.fortnite.at.explore.weapons.sub.title"],defend:Copy.messages["epic.fortnite.at.explore.weapons.title"],weapon1Title:Copy.messages["epic.fortnite.at.explore.weapons.weapon1.name"],weapon1Text:Copy.messages["epic.fortnite.at.explore.weapons.weapon1.description"],weapon2Title:Copy.messages["epic.fortnite.at.explore.weapons.weapon2.name"],weapon2Text:Copy.messages["epic.fortnite.at.explore.weapons.weapon2.description"],weapon3Title:Copy.messages["epic.fortnite.at.explore.weapons.weapon3.name"],weapon3Text:Copy.messages["epic.fortnite.at.explore.weapons.weapon3.description"],weapon4Title:Copy.messages["epic.fortnite.at.explore.weapons.weapon4.name"],weapon4Text:Copy.messages["epic.fortnite.at.explore.weapons.weapon4.description"],weapon5Title:Copy.messages["epic.fortnite.at.explore.weapons.weapon5.name"],weapon5Text:Copy.messages["epic.fortnite.at.explore.weapons.weapon5.description"]};(function(){if(Utils.query("p")=="Weapons"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.scrollIn(1)});_this.delayedCall(function(){},2e3)}$this.css({position:"static"});initViews()}());function initViews(){_interaction=_this.initClass(WeaponsInteraction);_view=_this.initClass(WeaponsView,_copy);_scene=_this.initClass(WeaponsScene,_interaction.move,_copy)}this.scrollIn=function(dir){if(_animTimer)clearTimeout(_animTimer);_animTimer=_this.delayedCall(function(){return _this.animComplete=true},700);_interaction.scrollIn(dir);_view.scrollIn(dir);_scene.scrollIn(dir)};this.scrollOut=function(dir){if(_animTimer)clearTimeout(_animTimer);_this.animComplete=false;_interaction.scrollOut(dir);_view.scrollOut(dir);_scene.scrollOut(dir)}},function(){Weapons.NEXT="weapons_next";Weapons.PREV="weapons_prev";Weapons.CHANGE="weapons_change"});Class(function VFX(){Inherit(this,Component);var _this=this;var _nuke,_composite;(function(){initNuke();initPass();addHandlers();resize()}());function initNuke(){_nuke=_this.initClass(Nuke,Stage,{renderer:World.RENDERER,scene:World.SCENE,camera:World.CAMERA,dpr:World.DPR});_this.isReady=true}function initPass(){_composite=_this.initClass(NukePass,"Post","Post");_composite.uniforms={uResolution:World.RESOLUTION,uTime:World.TIME};_nuke.add(_composite)}function addHandlers(){_this.events.sub(Events.RESIZE,resize)}function resize(){if(Global.PAUSED)return;_nuke.setSize(Stage.width,Stage.height)}this.render=function(){if(!_this.isReady)checkReady();_nuke.render()};function checkReady(){if(!_nuke.passes.length)return;_this.isReady=true;World.ELEMENT.show()}this.ready=function(){var promise=Promise.create();_this.wait(_this,"isReady").then(promise.resolve);return promise}},"singleton");Class(function World(){Inherit(this,Component);var _this=this;var _renderer=void 0,_scene=void 0,_camera=void 0,_controls=void 0,_vfx=void 0;World.DPR=Tests.getDPR();(function(){initWorld();initControls();addHandlers();_this.startRender(loop)}());function initWorld(){_renderer=new THREE.WebGLRenderer({powerPreference:"high-performance",antialias:false});_renderer.setPixelRatio(World.DPR);_renderer.setSize(Stage.width,Stage.height);_renderer.setClearColor("#000000");_scene=new THREE.Scene;_camera=new THREE.PerspectiveCamera(45,Stage.width/Stage.height,.01,1e3);_scene.add(_camera);World.SCENE=_scene;World.RENDERER=_renderer;World.ELEMENT=$(_renderer.domElement);World.CAMERA=_camera;World.TIME={type:"f",value:0};World.RESOLUTION={type:"v2",value:new THREE.Vector2(Stage.width*World.DPR,Stage.height*World.DPR)};World.PLANE=new THREE.PlaneBufferGeometry(1,1);World.RAYCASTER=_this.initClass(Raycaster,World.CAMERA)}function initControls(){_camera.position.set(0,0,6);_camera.target=new THREE.Vector3(0,0,0);_camera.lookAt(_camera.target);_controls=new THREE.OrbitControls(_camera,World.ELEMENT.div);_controls.target=_camera.target;World.CONTROLS=_controls}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;_renderer.setSize(Stage.width,Stage.height);_camera.aspect=Stage.width/Stage.height;_camera.updateProjectionMatrix();World.RESOLUTION.value.set(Stage.width*World.DPR,Stage.height*World.DPR)}function loop(t,delta){if(Global.PAUSED)return;World.TIME.value+=delta*.001;if(_controls&&_controls.enabled)_controls.update();_renderer.render(_scene,_camera)}this.setCamera=function(camera){_camera=camera;_renderer.camera=_camera;World.CAMERA=camera};World.ready=function(){return Promise.resolve()}},function(){var _instance;World.instance=function(){if(!_instance)_instance=new World;return _instance}});Class(function Background(_config,_numColors){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0;_numColors=_numColors||4;(function(){initGeometry();initShader();initMesh();initGui()}());function initGeometry(){_geometry=new THREE.PlaneBufferGeometry(2,2)}function initShader(){_shader=_this.initClass(Shader,"Background");_shader.uniforms={uResolution:World.RESOLUTION,uTime:World.TIME,uDOF:{type:"f",value:1},uDiffuse:{type:"f",value:.02},uRotation:{type:"v2",value:new THREE.Vector2},uBaseColor:{type:"c",value:new THREE.Color}};for(var i=0;i<_numColors;i++){addColorUniforms(i+1)}function addColorUniforms(i){_shader.uniforms["uColor"+i]={type:"c",value:new THREE.Color};_shader.uniforms["uStrength"+i]={type:"f",value:1};_shader.uniforms["uOpacity"+i]={type:"f",value:1};_shader.uniforms["uFalloff"+i]={type:"f",value:1};_shader.uniforms["uPosition"+i]={type:"v3",value:new THREE.Vector3(0,1,0)}}_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.depthTest=false}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.renderOrder=0;_mesh.frustumCulled=false;_this.add(_mesh)}function initGui(){var config=void 0;if(_config){config=_config;for(var prop in config){updateGUI(prop)}return}config={uBaseColor:"#3b314a",uDiffuse:.03,uDOF:.3};for(var i=0;i<_numColors;i++){addColorData(i+1)}function addColorData(i){config["uColor"+i]="#ffffff";config["uStrength"+i]=1;config["uOpacity"+i]=1;config["uFalloff"+i]=1;config["uPosition"+i+"_x"]=.1;config["uPosition"+i+"_y"]=1;config["uPosition"+i+"_z"]=.1}config={uBaseColor:"#123b85",uDiffuse:.04,uDOF:1.9500000000000002,uColor1:"#42639d",uStrength1:1,uOpacity1:.56,uFalloff1:3.3000000000000003,uPosition1_x:-.5,uPosition1_y:-.7000000000000001,uPosition1_z:-.5,uColor2:"#0d57ad",uStrength2:1,uOpacity2:1,uFalloff2:1.55,uPosition2_x:-.2,uPosition2_y:-.2,uPosition2_z:0,uColor3:"#fd9f6c",uStrength3:2.5500000000000003,uOpacity3:.09,uFalloff3:1.1,uPosition3_x:0,uPosition3_y:-1,uPosition3_z:0,uColor4:"#faac67",uStrength4:1.25,uOpacity4:0,uFalloff4:.9,uPosition4_x:1,uPosition4_y:-1,uPosition4_z:1};var gui=new dat.gui.GUI;gui.remember(config);var g1=gui.addFolder("Common");g1.addColor(config,"uBaseColor").onChange(function(){return updateGUI("uBaseColor")});g1.add(config,"uDiffuse").min(0).max(1).step(.01).onChange(function(){return updateGUI("uDiffuse")});g1.add(config,"uDOF").min(0).max(5).step(.05).onChange(function(){return updateGUI("uDOF")});for(var _i3=0;_i3<_numColors;_i3++){addColorGUI(_i3+1)}function addColorGUI(i){var g=gui.addFolder("Color "+i);g.addColor(config,"uColor"+i).onChange(function(){return updateGUI("uColor"+i)});g.add(config,"uStrength"+i).min(1).max(5).step(.05).onChange(function(){return updateGUI("uStrength"+i)});g.add(config,"uOpacity"+i).min(0).max(1).step(.01).onChange(function(){return updateGUI("uOpacity"+i)});g.add(config,"uFalloff"+i).min(0).max(20).step(.05).onChange(function(){return updateGUI("uFalloff"+i)});g.add(config,"uPosition"+i+"_x").min(-1).max(1).step(.1).onChange(function(){return updateGUI("uPosition"+i+"_x")});g.add(config,"uPosition"+i+"_y").min(-1).max(1).step(.1).onChange(function(){return updateGUI("uPosition"+i+"_y")});g.add(config,"uPosition"+i+"_z").min(-1).max(1).step(.1).onChange(function(){return updateGUI("uPosition"+i+"_z")})}for(var _prop in config){updateGUI(_prop)}function updateGUI(prop){if(!!~prop.indexOf("_")){var split=prop.split("_");_shader.uniforms[split[0]].value[split[1]]=config[prop]}else if(typeof config[prop]=="number"){_shader.set(prop,config[prop])}else{_shader.uniforms[prop].value.set(config[prop])}}gui.close();__window.keydown(function(e){if(e.keyCode>48&&e.keyCode<53)_this["isKey"+(e.keyCode-48)]=true});__window.keyup(function(e){if(e.keyCode>48&&e.keyCode<53)_this["isKey"+(e.keyCode-48)]=false});_this.events.sub(Mouse.input,Interaction.DRAG,function(){if(_this.isKey1)console.log(1);if(_this.isKey2)console.log(2);if(_this.isKey3)console.log(3);if(_this.isKey4)console.log(4)})}});Class(function BlockWipe(){Inherit(this,Object3D);var _this=this;var _geometry=void 0;var _meshes=[];var _height=1;var _colors=[["#113a85","#cb66c9"],["#cb66c9","#113a85"]];(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);initGeometry();initMeshes();addHandlers();TweenManager.addCustomEase({name:"wipeInOut",curve:"cubic-bezier(.34,.15,.08,.97)"})}());function initGeometry(){_geometry=new THREE.PlaneGeometry(192e1,118e1);_geometry.vertices.forEach(function(v){v.initialY=v.y});updateGeometry()}function initMeshes(){["#0aa6ff"].forEach(function(color,i){var shader=new THREE.MeshBasicMaterial({color:color,transparent:true,depthTest:false});var mesh=new THREE.Mesh(_geometry,shader);mesh.position.y=-128e1;mesh.position.z=i*.01;mesh.renderOrder=10;mesh.shader=shader;_this.add(mesh);mesh.visible=false;_meshes.push(mesh)});World.SCENE.add(_this.group)}function updateGeometry(){_geometry.vertices[0].y=_geometry.vertices[0].initialY-Math.random(0,200,2);_geometry.vertices[1].y=_geometry.vertices[1].initialY-Math.random(0,200,2);_geometry.vertices[2].y=_geometry.vertices[2].initialY+Math.random(0,200,2);_geometry.vertices[3].y=_geometry.vertices[3].initialY+Math.random(0,200,2);_geometry.verticesNeedUpdate=true}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=192e1/108e1;if(r1>r2){_this.group.scale.setScalar(_height/108e1*(r1/r2))}else{_this.group.scale.setScalar(_height/108e1)}}this.wipe=function(dir){updateGeometry();_meshes.forEach(function(mesh,i){mesh.visible=true;mesh.position.y=128e1*-dir});var colors=_colors.random();tween(_meshes[0].position,{y:128e1*dir},1e3,"easeOutQuart").onComplete(function(){_meshes.forEach(function(mesh){mesh.visible=false})})}},"singleton");Class(function DragPrompt(){Inherit(this,Element);var _this=this;var $this=this.element;var $hand=void 0,$handGrab=void 0,$arrowL=void 0,$arrowR=void 0;var _idleTimer=void 0;(function(){initHTML();style();addHandlers()}());function initHTML(){$hand=$this.create("Hand");$handGrab=$this.create("Hand");$arrowL=$this.create("ArrowLeft");$arrowR=$this.create("ArrowRight");Stage.add($this)}function style(){$this.center().css({opacity:0});$hand.size(60,60).center().bg("assets/images/common/ui/hand.png").css({transformOrigin:"50% 100px",opacity:0});$handGrab.size(60,60).center().bg("assets/images/common/ui/hand-grab.png").css({transformOrigin:"50% 100px",opacity:0});$arrowL.size(25,25).center().css({marginTop:-5}).bg("assets/images/common/ui/arrow-left.png");$arrowL.transform({x:-50});$arrowR.size(25,25).center().css({marginTop:-5}).bg("assets/images/common/ui/arrow-left.png");$arrowR.transform({x:50,rotation:180});$this.hide()}function animateHand(){if(!_this.animating)return;$arrowL.tween({x:-50},1e3,"easeInOutCubic");$hand.clearTween().css({opacity:0}).transform({rotation:-10}).tween({opacity:1},300,"easeOutSine",function(){$hand.tween({rotation:10,opacity:0},1e3,"easeOutCubic");$arrowR.tween({x:65},600,"easeOutCubic",function(){$arrowR.tween({x:50},1e3,"easeInOutCubic")});$handGrab.clearTween().css({opacity:0}).transform({rotation:10}).tween({opacity:1},300,"easeOutSine",600,function(){$handGrab.tween({rotation:-10,opacity:0},1e3,"easeOutCubic");$arrowL.tween({x:-65},600,"easeOutCubic");_this.delayedCall(animateHand,600)})})}function play(){$this.show();_this.animating=true;animateHand();$this.transform({scale:.8,y:10}).tween({opacity:1,scale:1,y:0},1e3,"easeOutCubic")}function addHandlers(){_this.events.sub(FortniteEvents.PAGE_CHANGE,cancel);_this.events.sub(Mouse.input,Interaction.START,cancel)}function cancel(){if(_idleTimer)clearTimeout(_idleTimer);$this.tween({opacity:0},400,"easeInOutCubic").onComplete(function(){_this.animating=false;$this.hide()})}this.start=function(){_idleTimer=_this.delayedCall(play,3e3)}},"singleton");Class(function LoaderBar(){Inherit(this,Element);var _this=this;var $this=this.element;var _progress=0;(function(){style();addHandlers()}());function style(){$this.size("100%",5).css({right:"100%",bottom:0,background:"#f8f902"});$this.x=0}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){$this.x=_progress*Stage.width;$this.transform()}this.progress=function(e){_progress=e.percent;$this.transform({x:_progress*Stage.width})};this.animateOut=function(callback){$this.tween({opacity:0},1e3,"easeInOutCubic").onComplete(callback)}});Class(function StormWipe(){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0,_alphaTween=void 0;(function(){initMesh()}());function initMesh(){var geometry=new THREE.PlaneBufferGeometry(2,2);_shader=_this.initClass(Shader,"StormWipe");_shader.uniforms={uTime:{value:0},uResolution:World.RESOLUTION,uColor1:{type:"c",value:new THREE.Color("#8d50fa")},uColor2:{type:"c",value:new THREE.Color("#512bac")},uColor3:{type:"c",value:new THREE.Color("#181324")},uWipe:{type:"f",value:-1.4},uAlpha:{type:"f",value:0}};_shader.material.transparent=true;_shader.material.depthTest=false;_mesh=new THREE.Mesh(geometry,_shader.material);_mesh.renderOrder=10;_mesh.visible=false;_this.add(_mesh);World.SCENE.add(_this.group)}function loop(t,delta){_shader.uniforms.uTime.value+=delta*.001}this.wipe=function(dir){_mesh.visible=true;_this.startRender(loop);_shader.uniforms.uTime.value+=Math.random(5,20,3);if(_alphaTween)_alphaTween.stop();_alphaTween=_shader.tween("uAlpha",1,100,"easeOutCubic").onComplete(function(){_alphaTween=_shader.tween("uAlpha",0,100,"easeInOutCubic",800)});_shader.set("uWipe",-1.4*dir);_shader.tween("uWipe",1.4*dir,1e3,"linear").onComplete(function(){_mesh.visible=false;_this.stopRender(loop)})}},"singleton");Class(function UIWarpPrompt(_text,_w,_h,_yellow){Inherit(this,Element);var _this=this;var $this=this.element;var $wrapper=void 0;(function(){initPrompt();addHandlers()}());function initPrompt(){$wrapper=$this.create(".wrapper");$wrapper.size("100%");$this.inner=$wrapper.create("Background");_this.inner=$this.inner;$this.back=$this.inner.create("Background");$this.backCover=$this.back.create(".back-cover");$this.glow=$this.back.create(".glow");$this.text=$this.inner.create("Text");$this.text.html(_text);_w=_w||260;_h=_h||70;$this.size(_w,_h).center();$this.inner.size(_w,_h);$this.back.size(_w,_h);$this.glow.size(_w,_h).css({boxShadow:"0 "+_h*.2+"px "+_h*.7+"px rgba(0,0,0,0.25)",opacity:0});$this.backCover.size(_w,_h).bg("#000").css({opacity:.05}).transformPoint("50%","100%").transform({scaleY:0});$this.back.warp=_this.initClass(Warp,$this.back);var w=$this.back.warp;var s=6;w.tl.r1=Math.random(-s,s);w.tl.r2=Math.random(-s,s);w.tl.r3=Math.random(0,1,3);w.tl.r4=Math.random(0,1,3);w.tr.r1=Math.random(-s,s);w.tr.r2=Math.random(-s,s);w.tr.r3=Math.random(0,1,3);w.tr.r4=Math.random(0,1,3);w.bl.r1=Math.random(-s,s);w.bl.r2=Math.random(-s,s);w.bl.r3=Math.random(0,1,3);w.bl.r4=Math.random(0,1,3);w.br.r1=Math.random(-s,s);w.br.r2=Math.random(-s,s);w.br.r3=Math.random(0,1,3);w.br.r4=Math.random(0,1,3);$this.text.size("100%").css({color:_yellow?"#000":"#fff",lineHeight:_h+Math.round(_h*.07),fontSize:Math.round(_h*.5),letterSpacing:"0.01em",textAlign:"center"});$this.transform({scale:1})}function loop(t){t*=.002;var w=$this.back.warp;w.tl.x=Math.sin(t*w.tl.r3+w.tl.r4*3.14)*w.tl.r1;w.tl.y=Math.sin(t*w.tl.r4+w.tl.r3*3.14)*w.tl.r2;w.tr.x=Math.sin(t*w.tr.r3+w.tr.r4*3.14)*w.tr.r1+$this.width;w.tr.y=Math.sin(t*w.tr.r4+w.tr.r3*3.14)*w.tr.r2;w.bl.x=Math.sin(t*w.bl.r3+w.bl.r4*3.14)*w.bl.r1;w.bl.y=Math.sin(t*w.bl.r4+w.bl.r3*3.14)*w.bl.r2+$this.height;w.br.x=Math.sin(t*w.br.r3+w.br.r4*3.14)*w.br.r1+$this.width;w.br.y=Math.sin(t*w.br.r4+w.br.r3*3.14)*w.br.r2+$this.height;w.render()}function addHandlers(){$this.interact(hover,click)}function hover(e){_this.events.fire(Events.HOVER,e);if(_this.active)return;if(e.action=="over"){$this.glow.tween({opacity:1},500,"easeOutSine");$this.backCover.clearTween().transformPoint("50%","100%").transform({scaleY:0}).tween({scaleY:1},300,"easeOutCubic");$this.inner.tween({scale:1.03},300,"easeOutCubic")}else{$this.glow.tween({opacity:0},500,"easeOutSine");$this.backCover.clearTween().transform({scaleY:1}).transformPoint("50%","0%").tween({scaleY:0},500,"easeOutCubic");$this.inner.tween({scale:1},500,"easeOutCubic")}}function click(){$wrapper.tween({scale:.94},50,"easeOutCubic",function(){$wrapper.tween({scale:1},500,"easeOutCubic")});_this.events.fire(Events.CLICK,null,true)}this.animateIn=function(){$this.show().tween({opacity:1},200,"easeOutSine");_this.startRender(loop)};this.hoverOut=function(){$this.glow.tween({opacity:0},500,"easeOutSine");$this.backCover.clearTween().transform({scaleY:1}).transformPoint("50%","0%").tween({scaleY:0},500,"easeOutCubic");$this.inner.tween({scale:1},500,"easeOutCubic")};this.animateOut=function(){$this.tween({opacity:0},300,"easeOutSine",function(){$this.hide();_this.stopRender(loop)})}});Class(function VideoOverlay(){Inherit(this,Element);var _this=this;var $this,$bg,$video,$close;(function(){initHTML();initVideo();initClose();addListeners();resizeHandler()}());function initHTML(){$this=_this.element;$this.size("100%").setZ(100).hide();Stage.add($this);$bg=$this.create(".bg");$bg.size("100%").bg("#000")}function initVideo(){$video=$this.create("VideoContainer");$video.size(128e1,720).center().bg("#000");$video.glow=$video.create("VideoGlow");$video.glow.size("100%").css({boxShadow:"0 10px 150px #dd66dc"});$video.frame=$video.create("IframeContainer","iframe");$video.frame.div.width="100%";$video.frame.div.height="100%";$video.frame.div.frameBorder="0"}function initClose(){var size=60;$close=$video.create("VideoClosePrompt");$close.fontStyle("BurbankBigCondensed-Black",size,"#fff");$close.size(size,size).center().css({lineHeight:size,textAlign:"center"}).transform({scale:.8});$close.text("x")}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler);$bg.interact(null,close);$close.interact(hover,close)}function resizeHandler(){var scaleX=Math.range(Stage.width,0,155e1,0,1,true);var scaleY=Math.range(Stage.height,0,950,0,1,true);var scale=Math.min(scaleX,scaleY);$video.size(128e1*scale,720*scale).center();$close.css({marginLeft:640*scale,marginTop:-400*scale})}function hover(e){if(!_this.visible)return;if(e.action=="over"){$close.tween({scale:1},200,"easeOutCubic")}else{$close.tween({scale:.8},400,"easeOutCubic")}}function close(){_this.animateOut()}this.animateIn=function(url){if(_this.visible)return;_this.visible=true;$video.frame.div.src="https://www.youtube.com/embed/"+url.split("?v=")[1]+"?autoplay=1";$this.show().clearAlpha();$bg.css({opacity:0}).tween({opacity:.8},800,"easeInOutSine");$video.transform({scaleX:.85,scaleY:.85,rotation:Math.random(-3,3,3)}).css({opacity:0});$video.tween({scaleX:1,scaleY:1,opacity:1,rotation:0},14e2,"easeOutBack",300);$video.glow.css({opacity:0}).tween({opacity:.5},1e3,"easeOutSine",300);$close.css({opacity:0}).tween({opacity:1},500,"easeOutSine",15e2)};this.animateOut=function(){if(!_this.visible)return;_this.visible=false;$close.tween({opacity:0},200,"easeOutCubic");$video.tween({scaleX:.9,scaleY:.9,opacity:0},700,"easeOutCubic");$this.tween({opacity:0},800,"easeOutSine",function(){$video.frame.div.src="";$this.hide()})}},"singleton");Class(function NavView(_scroll){Inherit(this,Element);var _this=this;var $this;var _items,_active;var _size=30;(function(){initHTML();initItems();addListeners();animateIn()}());function initHTML(){$this=_this.element}function initItems(){var items=["Home","Explore","Collect","Build","Weapons","Team"];_items=[];var top=0;var count=0;items.forEach(function(name){var data={size:_size,name:name,index:count};var item=_this.initClass(NavItem,data);item.name=name;item.element.css({top:top});top+=_size;count++;_items.push(item)});$this.size(_size,top).center(0,1).css({right:55});defer(function(){_active=_items[0];_active.activate()})}function animateIn(){_items.forEach(function(item){item.animateIn()})}function animateOut(){_items.forEach(function(item){item.animateOut()})}function addListeners(){_items.forEach(function(item){_this.events.sub(item,Events.HOVER,hover);_this.events.sub(item,Events.CLICK,click)});_this.events.sub(FortniteEvents.PAGE_CHANGE,pageChange);_this.events.sub(FortniteEvents.PAUSE_SCROLL,pause);_this.events.sub(FortniteEvents.RESUME_SCROLL,resume);_this.events.sub(Events.SCROLL_TO_TOP,scrollToTop)}function hover(e){clearTimeout(_this.timeout);switch(e.action){case"over":_items.forEach(function(item){if(e.name==item.name)item.hoverIn();else item.hoverOut()});break;case"out":_this.timeout=_this.delayedCall(function(){_items.forEach(function(item){item.hoverOut()})},200);break}}function click(e){if(_scroll.isPaused||_scroll.isTransition)return;_this.events.fire(FortniteEvents.PAGE_CHANGE,{index:e.index});Tracking.event(Tracking.sideNav,e.index)}function scrollToTop(){if(_scroll.isPaused||_scroll.isTransition)return;if(_items.indexOf(_active)===0)return;_this.events.fire(FortniteEvents.PAGE_CHANGE,{index:0});Tracking.event(Tracking.sideNav,0)}function pageChange(e){if(_active)_active=_active.deactivate();if(e.index>5)return;_active=_items[e.index];_active.activate()}function pause(){animateOut()}function resume(){animateIn()}});Class(function NavItem(_data){Inherit(this,Element);var _this=this;var $this,$title,$circle;(function(){initHTML();initCircle();addListeners()}());function initHTML(){$this=_this.element;$this.size(_data.size,_data.size).invisible()}function initText(){$title=$this.create(".close");$title.fontStyle("BurbankBigCondensed-Black",24,"#fff");$title.size(200,18).center(0,1).css({opacity:0,letterSpacing:1,textTransform:"uppercase",right:_data.size,lineHeight:24,textAlign:"right"});$title.text(_data.name)}function initCircle(){$circle=$this.create(".circle");$circle.size(_data.size*.5,_data.size*.5).center().css({opacity:.8,boxSizing:"border-box",borderRadius:_data.size,border:"2px solid #fff"});$circle.transform({scale:.7});$circle.fill=$circle.create(".fill");$circle.fill.size("100%").bg("#fff").css({borderRadius:_data.size,opacity:0}).transform({scale:.5})}function addListeners(){$this.interact(hover,click)}function hover(e){if(_this.active)return;_data.action=e.action;_this.events.fire(Events.HOVER,_data)}function click(){if(_this.active)return;_this.events.fire(Events.CLICK,_data)}this.hoverIn=function(){if(_this.hovered||_this.active)return;_this.hovered=true;$circle.tween({opacity:1,scale:.85},300,"easeOutBack");$circle.fill.tween({opacity:.8},500,"easeOutBack")};this.hoverOut=function(){if(!_this.hovered||_this.active)return;_this.hovered=false;$circle.tween({opacity:.8,scale:.7},400,"easeOutSine");$circle.fill.tween({opacity:0},500,"easeOutBack")};this.activate=function(){if(_this.active)return;_this.active=true;$this.hit.hide();$circle.tween({opacity:1,scale:1},400,"easeOutBack");$circle.fill.tween({opacity:1,scale:1},500,"easeOutBack")};this.deactivate=function(){if(!_this.active)return;_this.active=false;$this.hit.show();$circle.tween({opacity:.8,scale:.7},400,"easeOutBack");$circle.fill.tween({opacity:0,scale:.5},300,"easeInBack");return null};this.animateIn=function(){$this.visible().transform({x:10}).css({opacity:0}).tween({x:0,opacity:1},800,"easeOutBack",_data.index*100)};this.animateOut=function(){$this.tween({x:10,opacity:0},500,"easeOutBack",_data.index*50).onComplete(function(){$this.invisible()})}});Class(function PlaygroundBuild(){Inherit(this,Object3D);var _this=this;var _placement=[{model:"floor",pos:[7.19,0,-5.768],rot:[0,0,0]},{model:"archway",pos:[6.95,0,-5.925],rot:[0,0,0]},{model:"archway",pos:[15.17,0,2.315],rot:[0,90,0]},{model:"archway",pos:[6.95,0,10.496],rot:[0,0,0]},{model:"archwaySupportLarge",pos:[-9.115,0,10.679],rot:[0,0,0]},{model:"archwaySupportLarge",pos:[-9.115,0,-5.798],rot:[0,0,0]},{model:"stairF",pos:[15.246,0,2.41],rot:[0,-90,0]},{model:"balconyO",pos:[31.642,12.286,2.642],rot:[0,-90,0]},{model:"balconyO",pos:[23.667,12.286,-21.604],rot:[0,0,0]},{model:"stairF",pos:[-.389,11.95,-13.231],rot:[0,90,0]},{model:"roofWall",pos:[6.92,11.816,-5.723],rot:[0,0,0]},{model:"roofWall",pos:[6.92,11.816,10.129],rot:[0,0,0]},{model:"archway",pos:[-1.07,11.895,2.315],rot:[0,90,0]},{model:"balconyO",pos:[-16.608,24.008,-13.573],rot:[0,90,0]},{model:"archwayLarge",pos:[-9.143,11.595,10.788],rot:[0,0,0]},{model:"archwayLarge",pos:[-9.143,11.595,-5.735],rot:[0,0,0]},{model:"floor",pos:[-8.794,23.825,-5.183],rot:[0,0,0]},{model:"archway",pos:[-8.972,23.928,-5.15],rot:[0,0,0]},{model:"archway",pos:[-1.07,24.09,2.315],rot:[0,90,0]},{model:"archway",pos:[-16.8,24.09,2.315],rot:[0,90,0]},{model:"archway",pos:[-8.972,23.928,10.496],rot:[0,0,0]},{model:"roofC",pos:[-9.15,36.606,-5.048],rot:[0,0,0]}];var _count=-1;(function(){World.CAMERA.position.set(1,.5,1);World.CAMERA.target.set(0,15,0);World.CAMERA.position.multiplyScalar(50);initBackground();initGrid();initLights();animateIn()}());function initBackground(){_this.initClass(Background)}function initGrid(){var grid=_this.initClass(Grid);grid.group.position.y=52;grid.group.scale.setScalar(20)}function initLights(){[{pos:new THREE.Vector3(-.2,1,.3),color:"#fff",value:.7},{pos:new THREE.Vector3(-.3,-1,.5),color:"#FF5461",value:.2},{pos:new THREE.Vector3(.2,.1,1),color:"#5922FF",value:.15}].forEach(function(d){var light=new THREE.DirectionalLight(d.color,d.value);light.position.copy(d.pos);World.SCENE.add(light)});var light=new THREE.AmbientLight("#222");World.SCENE.add(light)}function animateIn(){tween(_this.group.rotation,{y:-8},3e3,"easeInOutCubic");var s=.8;tween(_this.group.scale,{x:s,y:s,z:s},3e3,"easeInOutCubic");var _loop3=function _loop3(i){_this.delayedCall(function(){var p=_placement[i];var wood=_this.initClass(FortPiece,p.model);wood.group.rotation.reorder("YZX");wood.group.position.set(p.pos[0],p.pos[1],p.pos[2]);wood.group.rotation.set(Math.radians(p.rot[0]),Math.radians(p.rot[1]),Math.radians(p.rot[2]));wood.animateIn()},i*75+400)};for(var i=0;i<22;i++){_loop3(i)}}});Class(function PlaygroundCharacter(){Inherit(this,Component);var _this=this;this.group=new THREE.Group;(function(){World.CAMERA.target.y=90;World.CAMERA.position.multiplyScalar(40);var view=_this.initClass(Character);_this.group.add(view.group)}())});Class(function PlaygroundDemo(){Inherit(this,Component);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0;this.group=new THREE.Group;(function(){initGeometry();initShader();initMesh();_this.startRender(loop)}());function initGeometry(){_geometry=new THREE.IcosahedronBufferGeometry(.5,2)}function initShader(){_shader=_this.initClass(Shader,"Shader")}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader.material);_this.group.add(_mesh)}function loop(t,dt,delta){_mesh.rotation.y+=.01*delta/16}});Class(function PlaygroundGuns(){Inherit(this,Object3D);var _this=this;var _grid=void 0,_circle=void 0;var _weapons=[];var _currentWeapon=0;var _anim={progress:0};var _rotation=new THREE.Euler;this.inner=new THREE.Group;_this.add(_this.inner);(function(){World.CAMERA.position.set(-110,35,0);World.RENDERER.setClearColor("#dedede");World.CAMERA.fov=35;World.CAMERA.updateProjectionMatrix();World.CONTROLS.enabled=false;World.CAMERA.lookAt(World.CAMERA.target);initBackground();initGrid();initWeapons();initLights();initText();initCircle();initAnimation()}());function initBackground(){_this.initClass(Background)}function initGrid(){_grid=_this.initClass(Grid);_this.inner.add(_grid.group);_grid.group.rotation.y=.5}function initWeapons(){var weapon1=_this.initClass(Weapon,"crusader");_this.inner.add(weapon1.group);var weapon2=_this.initClass(Weapon,"breacher");_this.inner.add(weapon2.group);var weapon3=_this.initClass(Weapon,"bullseye");_this.inner.add(weapon3.group);var weapon4=_this.initClass(Weapon,"spikes");_this.inner.add(weapon4.group);var weapon5=_this.initClass(Weapon,"sword");_this.inner.add(weapon5.group);_weapons.push(weapon1);_weapons.push(weapon2);_weapons.push(weapon3);_weapons.push(weapon4);_weapons.push(weapon5)}function initText(){var geometry=new THREE.PlaneBufferGeometry(592,192);var shader=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/common/boom2.png"),transparent:true});var mesh=new THREE.Mesh(geometry,shader);mesh.scale.setScalar(.1);mesh.rotation.y=-Math.PI/2;mesh.position.set(50,5,0);World.SCENE.add(mesh)}function initCircle(){_circle=_this.initClass(WeaponCircle);_circle.group.rotation.y=-.5}function initLights(){[{pos:new THREE.Vector3(-.2,1,.3),color:"#fff",value:1},{pos:new THREE.Vector3(-.3,-1,.5),color:"#e7faff",value:.9},{pos:new THREE.Vector3(.2,.1,1),color:"#f1e6ff",value:.9}].forEach(function(d){var light=new THREE.DirectionalLight(d.color,d.value);light.position.copy(d.pos);_this.inner.add(light)});var light=new THREE.AmbientLight("#725b3a");_this.inner.add(light)}function initAnimation(){_rotation.reorder("YXZ");_this.inner.rotation.reorder("YXZ");_this.delayedCall(_weapons[_currentWeapon].animateIn,400);_this.inner.rotation.y=1;_rotation.y=1;tween(_rotation,{y:-.5},1e3,"easeInOutQuart");_anim.progress=.15;addHandlers();_this.startRender(loop)}function loop(t,delta){_this.inner.rotation.y+=(_rotation.y-_this.inner.rotation.y)*.05;_this.group.rotation.z+=(_rotation.z-_this.group.rotation.z)*.05;if(_rotation.z>.26)_rotation.z+=(.26-_rotation.z)*.2;if(_rotation.z<-.1)_rotation.z+=(-.1-_rotation.z)*.2;if(_this.isTransition)return;_circle.end.value+=(_anim.progress-_circle.end.value)*.1}function addHandlers(){_this.events.sub(Mouse.input,Interaction.DRAG,drag)}function drag(){_rotation.y+=Mouse.delta.x*.006;_rotation.z+=Mouse.delta.y*.003;if(_this.isTransition)return;_anim.progress-=Mouse.delta.x*.0008;if(_anim.progress>1)next();if(_anim.progress<0)prev()}function next(){_this.isTransition=true;_this.delayedCall(function(){return _this.isTransition=false},1e3);_weapons[_currentWeapon%_weapons.length].animateOut();_currentWeapon++;_this.delayedCall(_weapons[_currentWeapon%_weapons.length].animateIn,400);tween(_circle.start,{value:1},1e3,"easeOutCubic").onComplete(function(){_circle.start.value=0;_circle.end.value=0;_anim.progress=.15});tween(_circle.end,{value:1},200,"easeOutCubic")}function prev(){_this.isTransition=true;_this.delayedCall(function(){return _this.isTransition=false},1e3);_weapons[_currentWeapon%_weapons.length].animateOut();_currentWeapon--;if(_currentWeapon<0)_currentWeapon=_weapons.length-1;_this.delayedCall(_weapons[_currentWeapon%_weapons.length].animateIn,400);_circle.start.value=1;_circle.end.value=1;tween(_circle.end,{value:.85},1e3,"easeInOutCubic").onComplete(function(){_circle.start.value=0;_anim.progress=.85});tween(_circle.start,{value:0},600,"easeInOutCubic")}});Class(function PlaygroundHarvest(){Inherit(this,Component);var _this=this;this.group=new THREE.Group;(function(){World.CAMERA.target.y=2;World.CAMERA.position.multiplyScalar(3);var view=_this.initClass(Van);_this.group.add(view.group)}())});Class(function PlaygroundIsolatedBackground(){Inherit(this,Object3D);var _this=this;(function(){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;_this.initClass(TeamBackground)}())});Class(function PlaygroundSchem(){Inherit(this,Object3D);var _this=this;(function(){initMesh()}());function initMesh(){var shader=_this.initClass(Shader,"Schematic");shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/weapons/schematics/004.jpg")},uMask:{type:"c",value:new THREE.Color("#204a8e")}};shader.material.transparent=true;var mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.renderOrder=8;mesh.scale.set(3,4,1);_this.add(mesh)}});Class(function PlaygroundVideo(){Inherit(this,Element);var _this=this;var $this=this.element;var _video=void 0;(function(){initVideo()}());function initVideo(){_video=_this.initClass(Video,{src:Assets.CDN+"assets/videos/explore-720.mp4",width:128e1,height:720});_video.object.bg("#f00").transform({scale:.5});_video.div.setAttribute("crossorigin","anonymous");Stage.add(_video);Stage.bind("touchend",function(){_video.play()});_video.div.crossOrigin=""}});Class(function Ray(){Inherit(this,Element);var _this=this;var $this=this.element;var _icon=void 0,_messageDown=void 0,_messageUp=void 0,_room=void 0,_model=void 0;(function(){if(Utils.query("p")=="Ray"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.bigModel();_this.animateIn()})}$this.css({position:"static"});initViews();addHandlers();_this.isModel=true}());function initViews(){Stage.add($this);_messageDown=_this.initClass(RayMessageDown);_messageUp=_this.initClass(RayMessageUp);_icon=_this.initClass(RayIcon);_room=_this.initClass(RayRoom);_model=_this.initClass(RayModel)}function addHandlers(){_this.events.sub(_icon,Events.CLICK,toggle)}function toggle(){return}this.animateIn=function(){_this.isActive=true;if(_this.isModel)_model.animateIn();if(_this.isModel)_room.animateIn();if(!_this.isModel)_icon.animateIn()};this.animateOut=function(){_this.isActive=false;_model.animateOut();_room.animateOut();_icon.animateOut();if(_messageDown.isOpenRequest)_messageDown.close();if(_messageUp.isOpenRequest)_messageUp.close()};this.change=function(text){if(!_this.isActive)_this.animateIn();if(_this.isModel&&_this.isBig){_messageDown.change(text)}else{_messageUp.change(text)}};this.close=function(){if(_messageDown.isOpenRequest)_messageDown.close();if(_messageUp.isOpenRequest)_messageUp.close()};this.disableModel=function(){_room.animateOut();_messageUp.toIcon();_this.isModel=false};this.enableModel=function(){_messageUp.toMiniRey();_this.isModel=true};this.bigModel=function(){_this.isBig=true;_model.big();_room.disable()};this.smallModel=function(){_this.isBig=false;_model.small();_room.enable()}},"singleton");Class(function RayIcon(){Inherit(this,Element);var _this=this;var $this=this.element;(function(){style();addHandlers()}());function style(){$this.css({bottom:90,left:90}).setZ(1);$this.css({padding:20,margin:-20,background:'url("'+Assets.getPath("assets/images/common/ui/ray.png")+'") rgba(32, 152, 138, 1.0) no-repeat',backgroundSize:"30px 30px",backgroundPosition:"center center",borderRadius:1e3});$this.css({opacity:0})}function addHandlers(){$this.click(click)}function click(){_this.events.fire(Events.CLICK,null,true)}this.animateIn=function(){_this.isActive=true;$this.tween({opacity:1},300,"easeOutCubic")};this.animateOut=function(){_this.isActive=false;$this.tween({opacity:0},200,"easeOutCubic")}});Class(function RayMessageDown(){Inherit(this,Element);var _this=this;var $this=this.element;var $tailCont=void 0,$box=void 0,$text=void 0;var _openTimeout=void 0;var _tails=[];(function(){initHTML();style()}());function initHTML(){$tailCont=$this.create("TailContainer");for(var i=0;i<3;i++){var $tail=$tailCont.create("Tail");_tails.push($tail)}$box=$this.create("Box");$text=$this.create("Text")}function style(){$this.css({top:"65%",left:"20%",transformOrigin:"10% 0%"}).setZ(1);$tailCont.size(100,100).css({top:100,transformOrigin:"50% 0%"});$tailCont.transform({scaleY:-1});_tails.forEach(function($tail,i){$tail.size(100,100).bg("assets/images/ray/speech/tail"+(i+1)+".png")});$box.size(300,100).css({background:"#24a295",top:100});$box.warp=_this.initClass(Warp,$box);$box.warp.render();$box.warp.bl.yTarget=$box.warp.bl.y;$box.warp.br.yTarget=$box.warp.br.y;$box.warp.br.xTarget=$box.warp.br.x;$box.warp.tr.xTarget=$box.warp.tr.x;$text.css({position:"relative",top:115,left:20,maxWidth:260,fontFamily:"OpenSans",fontWeight:"500",fontSize:14,letterSpacing:"0.03em",lineHeight:"1.4em"});$this.css({opacity:0});$this.invisible()}function loop(t){var s=.2;$box.warp.bl.x=(Math.sin(t*.01*s)-1)*5;$box.warp.tl.x=(Math.sin(t*.0046*s)-1)*7;$box.warp.bl.y+=($box.warp.bl.yTarget+(Math.sin(t*.007*s)+1)*5-$box.warp.bl.y)*.1*.8;$box.warp.br.y+=($box.warp.br.yTarget+(Math.sin(t*.01*s)+1)*5-$box.warp.br.y)*.16*.8;$box.warp.tl.y=(Math.sin(t*.012*s)-1)*6;$box.warp.tr.y=(Math.sin(t*.003*s)-1)*5;$box.warp.tr.x+=($box.warp.tr.xTarget+(Math.sin(t*.0085*s)+1)*7-$box.warp.tr.x)*.08*.8;$box.warp.br.x+=($box.warp.br.xTarget+(Math.sin(t*.0055*s)+1)*6-$box.warp.br.x)*.12*.8;$box.warp.render();$tailCont.transform({scaleY:Math.map(Math.sin(t*.02*s),-1,1,.8,1)*-1,scaleX:Math.map(Math.cos(t*.014*s),-1,1,.8,1)})}function updateText(text){$this.visible();$text.clearTween();$text.tween({opacity:0,math:true},200,"easeOutCubic").onComplete(function(){$text.html(text);_openTimeout=_this.delayedCall(function(){var w=Math.max(100,$text.div.clientWidth+40);var h=$text.div.clientHeight+30;$box.warp.bl.yTarget=h;$box.warp.br.yTarget=h;$box.warp.tr.xTarget=w;$box.warp.br.xTarget=w;if(_this.isOpen){$text.tween({opacity:1,math:true},700,"easeOutCubic",300)}if(!_this.isOpen){$this.clearTween();_this.isOpen=true;_tails.forEach(function($tail){return $tail.hide()});_tails[Math.random(0,2)].show();$this.transform({scale:.1,rotation:Math.random(-20,20)});$this.tween({opacity:1,scale:1,rotation:0,spring:1,damping:.9},1e3,"easeOutElastic",100);$text.tween({opacity:1,math:true},700,"easeOutCubic",900)}},200)});if(_this.isOpen){$this.tween({rotation:Math.random(-5,2,2),math:true},150,"easeInOutCubic",200).onComplete(function(){$this.tween({rotation:0,spring:1,damping:.6},500,"easeOutElastic")})}}this.change=function(text){_this.startRender(loop);_this.isOpenRequest=true;updateText(text)};this.close=function(){_this.isOpenRequest=false;if(_openTimeout)clearTimeout(_openTimeout);$this.clearTween();$text.clearTween();$text.tween({opacity:0,math:true},200,"easeOutCubic",100);$this.tween({opacity:0,scale:.1,rotation:Math.random(-20,20),math:true},300,"easeInBack").onComplete(function(){_this.isOpen=false;_this.stopRender(loop);$this.invisible()})}});Class(function RayMessageUp(){Inherit(this,Element);var _this=this;var $this=this.element;var $tailCont=void 0,$box=void 0,$text=void 0;var _openTimeout=void 0;var _tails=[];(function(){initHTML();style()}());function initHTML(){$tailCont=$this.create("TailContainer");for(var i=0;i<3;i++){var $tail=$tailCont.create("Tail");_tails.push($tail)}$box=$this.create("Box");$text=$this.create("Text")}function style(){$this.css({bottom:"17%",left:"8%",transformOrigin:"10% 100%"}).setZ(1);$tailCont.size(100,100).css({bottom:0,transformOrigin:"50% 0%"});_tails.forEach(function($tail,i){$tail.size(100,100).bg("assets/images/ray/speech/tail"+(i+1)+".png")});$box.size(300,100).css({background:"#24a295",bottom:100});$box.warp=_this.initClass(Warp,$box);$box.warp.render();$box.warp.tl.yTarget=$box.warp.tl.y;$box.warp.tr.yTarget=$box.warp.tr.y;$box.warp.tr.xTarget=$box.warp.tr.x;$box.warp.br.xTarget=$box.warp.br.x;$text.css({position:"relative",bottom:115,left:20,maxWidth:260,fontFamily:"OpenSans",fontWeight:"500",fontSize:14,letterSpacing:"0.03em",lineHeight:"1.4em"});$this.css({opacity:0});$this.invisible()}function loop(t){var s=.2;$box.warp.br.y=(Math.sin(t*.01*s)+1)*5+100;$box.warp.bl.x=(Math.sin(t*.01*s)-1)*5;$box.warp.bl.y=(Math.sin(t*.007*s)+1)*5+100;$box.warp.tl.x=(Math.sin(t*.0046*s)-1)*7;$box.warp.tl.y+=($box.warp.tl.yTarget+(Math.sin(t*.012*s)-1)*6-$box.warp.tl.y)*.1*.8;$box.warp.tr.y+=($box.warp.tr.yTarget+(Math.sin(t*.003*s)-1)*5-$box.warp.tr.y)*.16*.8;$box.warp.tr.x+=($box.warp.tr.xTarget+(Math.sin(t*.0085*s)+1)*7-$box.warp.tr.x)*.08*.8;$box.warp.br.x+=($box.warp.br.xTarget+(Math.sin(t*.0055*s)+1)*6-$box.warp.br.x)*.12*.8;$box.warp.render();$tailCont.transform({scaleY:Math.map(Math.sin(t*.02*s),-1,1,.8,1),scaleX:Math.map(Math.cos(t*.014*s),-1,1,.8,1)})}function updateText(text){$this.visible();$text.clearTween();$text.tween({opacity:0,math:true},200,"easeOutCubic").onComplete(function(){$text.html(text);_openTimeout=_this.delayedCall(function(){var w=Math.max(100,$text.div.clientWidth+40);var h=$text.div.clientHeight+30;$box.warp.tl.yTarget=100-h;$box.warp.tr.yTarget=100-h;$box.warp.tr.xTarget=w;$box.warp.br.xTarget=w;if(_this.isOpen){$text.tween({opacity:1,math:true},700,"easeOutCubic",300)}if(!_this.isOpen){$this.clearTween();_this.isOpen=true;_tails.forEach(function($tail){return $tail.hide()});_tails[Math.random(0,2)].show();$this.transform({scale:.1,rotation:Math.random(-20,20)});$this.tween({opacity:1,scale:1,rotation:0,spring:1,damping:.9},1e3,"easeOutElastic",100);$text.tween({opacity:1,math:true},700,"easeOutCubic",900)}},200)});if(_this.isOpen){$this.tween({rotation:Math.random(-5,2,2),math:true},150,"easeInOutCubic",200).onComplete(function(){$this.tween({rotation:0,spring:1,damping:.6},500,"easeOutElastic")})}}this.change=function(text){_this.startRender(loop);_this.isOpenRequest=true;updateText(text)};this.close=function(){_this.isOpenRequest=false;if(_openTimeout)clearTimeout(_openTimeout);$this.clearTween();$text.clearTween();$text.tween({opacity:0,math:true},200,"easeOutCubic",100);$this.tween({opacity:0,scale:.1,rotation:Math.random(-20,20),math:true},300,"easeInBack").onComplete(function(){_this.isOpen=false;_this.stopRender(loop);$this.invisible()})};this.toIcon=function(){$this.css({bottom:90,left:60})};this.toMiniRey=function(){$this.css({bottom:"17%",left:"8%"})}});Class(function RayModel(){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0,_mixer=void 0;var _actIntro=void 0,_actIdle=void 0;(function(){if(Utils.query("p")=="RayModel"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);defer(function(){_this.animateIn()})}initGeometry();initShader();initMesh();initAnimation();addHandlers()}());function initGeometry(){_geometry=Utils3D.loadSkinnedGeometry("geometry/ray/ray-rig")}function initShader(){var MeshCustomMaterial=Shader.CustomBasicMaterial("Character");_shader=new MeshCustomMaterial({map:Utils3D.getTexture("assets/images/ray/texture.jpg"),transparent:true,skinning:true});_shader.uniforms.uMask={value:Utils3D.getTexture("assets/images/ray/mask.jpg")}}function initMesh(){_mesh=new THREE.SkinnedMesh(_geometry,_shader);_mesh.cont=new THREE.Group;_mesh.root=new THREE.Group;_mesh.root.add(_mesh.children[0]);_mesh.cont.add(_mesh.root);_mesh.add(_mesh.cont);_mesh.root.scale.setScalar(.13);_mesh.position.y=-2.6;_mesh.position.z=2;_mesh.renderOrder=10;_this.add(_mesh)}function initAnimation(){_mixer=new THREE.AnimationMixer(_mesh);var idleClip=THREE.AnimationClip.parseAnimation(Assets.JSON["geometry/ray/ray-anim"].animation,_geometry.bones);_actIdle=_mixer.clipAction(idleClip);_actIdle.weight=0;_actIdle.play();_actIdle.multitween=true;var introClip=THREE.AnimationClip.parseAnimation(Assets.JSON["geometry/ray/ray-anim-in"].animation,_geometry.bones);_actIntro=_mixer.clipAction(introClip);_actIntro.weight=1;_actIntro.play();_actIntro.multiTween=true}function loop(t,delta){_actIdle.time=t*.009%20;_mixer.update(0)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){var ratio=Stage.width/Stage.height;if(_this.isBig){_this.group.position.x=Math.map(ratio,1,2,-1.5,-4.2)}else{_this.group.position.x=Math.map(ratio,1,2,-2.4,-5.6)}}this.animateIn=function(){World.SCENE.add(_this.group);_this.startRender(loop);tween(_mesh.cont.rotation,{z:0},10,"linear");if(_this.isBig){_mesh.cont.position.x=-2;tween(_mesh.cont.position,{x:0},2e3,"easeOutCubic");_mesh.cont.scale.setScalar(.2);tween(_mesh.cont.scale,{x:1,y:1,z:1},15e2,"easeOutCubic");_actIntro.time=0;tween(_actIntro,{time:20},2e3,"easeOutSine");_actIntro.weight=1;_actIdle.weight=0;tween(_actIntro,{weight:0},1e3,"linear",1e3);tween(_actIdle,{weight:1},1e3,"linear",1e3);_mixer.update(0)}else{_actIntro.weight=0;_actIdle.weight=1;_mesh.cont.position.x=0;_mesh.cont.scale.setScalar(0);tween(_mesh.cont.scale,{x:1,y:1,z:1,damping:.9,spring:1.5},1e3,"easeOutElastic")}};this.animateOut=function(){tween(_mesh.cont.rotation,{z:Math.random(-.4,.4,2)},200,"easeInBack");tween(_mesh.cont.scale,{x:0,y:0},200,"easeInBack").onComplete(function(){World.SCENE.remove(_this.group);_this.stopRender(loop)})};this.big=function(){_this.isBig=true;_mesh.root.scale.setScalar(.4);_mesh.position.y=-1.1;resize()};this.small=function(){_this.isBig=false;_mesh.root.scale.setScalar(.13);_mesh.position.y=-2.6;resize()}});Class(function RayRoom(){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0;(function(){if(Utils.query("p")=="RayRoom"){World.CAMERA.position.set(0,0,10);World.CAMERA.lookAt(World.CAMERA.target);World.CONTROLS.enabled=false;defer(function(){_this.animateIn()})}initMesh();addHandlers();_this.enabled=true}());function initMesh(){_shader=_this.initClass(Shader,"RayRoom");_shader.uniforms={uTime:World.TIME,uMap:{type:"t",value:Utils3D.getTexture("assets/images/ray/room.jpg")},uMouse:{type:"v2",value:new THREE.Vector2}};_shader.material.transparent=true;_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.renderOrder=9;_mesh.scale.setScalar(1);_this.add(_mesh);_this.group.position.y=-2.8;_this.group.position.z=1;_this.group.rotation.reorder("YXZ")}function loop(){_shader.uniforms.uMouse.value.lerp(Mouse.perc,.02)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){var ratio=Stage.width/Stage.height;_this.group.position.x=Math.map(ratio,1,2,-2.7,-6.3)}this.animateIn=function(){if(!_this.enabled)return;if(_this.visible)return;_this.startRender(loop);_this.visible=true;World.SCENE.add(_this.group);_mesh.scale.setScalar(.2);var s=1;tween(_mesh.scale,{x:s,y:s,z:s},1e3,"easeOutElastic")};this.animateOut=function(){if(!_this.visible)return;_this.visible=false;var s=.2;tween(_mesh.scale,{x:s,y:s,z:s},300,"easeInBack").onComplete(function(){World.SCENE.remove(_this.group);_this.stopRender(loop)})};this.disable=function(){_this.enabled=false};this.enable=function(){_this.enabled=true}});Class(function CollectEndScreen(_copy){Inherit(this,Element);var _this=this;var $this=this.element;var $heading=void 0;var _buildPrompt=void 0;(function(){$this.css({position:"static"});initHTML();style();addHandlers()}());function initHTML(){$heading=$this.create("Heading");$heading.html(_copy.title.toUpperCase());_buildPrompt=_this.initClass(UIWarpPrompt,_copy.cta1.toUpperCase(),Tests.buildPromptWidth())}function style(){$heading.css({left:0,right:0,top:"50%",marginTop:-180-Tests.buildTitleSpace(),fontSize:70,textAlign:"center"});_buildPrompt.element.css({left:"50%",top:"50%",marginTop:150});$heading.hide();_buildPrompt.element.hide()}function addHandlers(){_this.events.sub(_buildPrompt,Events.CLICK,next)}function next(){_this.events.fire(FortniteEvents.INCREMENT_SCROLL,{dir:1});Tracking.event(Tracking.buildFort)}this.animateIn=function(){$heading.show().css({opacity:0});$heading.tween({opacity:1},500,"easeOutCubic");_buildPrompt.element.show().css({opacity:0});_buildPrompt.element.tween({opacity:1},500,"easeOutCubic");_buildPrompt.animateIn()};this.reset=function(){$heading.hide();_buildPrompt.animateOut();_buildPrompt.element.hide()};this.animateOut=function(){_buildPrompt.animateOut()}});Class(function CollectHotSpot(_params,_move,_index){Inherit(this,Element);var _this=this;var $this=this.element;var $inner=void 0,$coin=void 0,$plus=void 0;var _video=void 0;(function(){initHTML();initVideo();style();addHandlers();_this.startRender(loop)}());function initHTML(){$inner=$this.create("Inner");$coin=$inner.create("Coin");$plus=$coin.create("Plus")}function initVideo(){_video=_this.initClass(CollectHotSpotVideo,_params.type)}function style(){$inner.x=0;$inner.y=0;$inner.scale=.9*_params.scale;$inner.transform();$coin.bg("assets/images/common/ui/yellow-gradient.jpg","cover").css({padding:24,margin:-24,borderRadius:1e3});$coin.x=0;$coin.y=0;$coin.r1=Math.random(0,1,3);$coin.r2=Math.random(0,1,3);$plus.size(20,20).center().bg("assets/images/common/ui/plus.png","contain")}function loop(t){$coin.x=Math.sin(t*.001)*10*Stage.height/108e1;$coin.y=Math.sin(t*.00052+4.14)*5*Stage.height/108e1;$coin.scale=Math.sin(t*.002*($coin.r1+.5)+$coin.r2*3)*Math.sin(t*.005*($coin.r2+.5)+$coin.r2*3)*.1*($coin.r1+.3)+.9;$coin.rotation=Math.sin(t*.002*$coin.r2+$coin.r1*4)*(5+5*$coin.r1);$coin.transform()}function collect(isForce){_this.delayedCall(function(){var step=80;var x=-$this.css("left")-Stage.height/108e1*_move.ease.x+_index*step-1.5*step;var y=-$this.css("top")+Stage.height*.5-100;$this.css({opacity:1});$this.tween({x:x,y:y,scale:.5,opacity:0,math:true},500,"easeInQuint").onComplete(function(){$this.hide()})},isForce?0:15e2)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();$this.interact(hover,click);$this.hit.css({padding:30,margin:-30,borderRadius:"100%"});_this.events.sub(Mouse.input,Interaction.START,stageDown);_this.events.sub(Mouse.input,Interaction.END,stageUp)}function resize(){if(Global.PAUSED)return;var w=2921/108e1*Stage.height;var h=Stage.height;$this.css({left:_params.pos[0]*w-.5*w,top:_params.pos[1]*h-.5*h})}function hover(e){if(e.action=="over"){$inner.tween({scale:1*_params.scale},200,"easeOutCubic")}else{$inner.tween({scale:.9*_params.scale},400,"easeOutCubic")}}function click(){if(_this.isActivated)return;_this.isActivated=true;_this.events.fire(Events.CLICK,{index:_index},true);_video.activate();collect();Tracking.event(Tracking.hotspot,_index)}function stageDown(){if(Global.PAUSED)return;$coin.tween({opacity:.2},Math.random(200,400),"easeInOutCubic",70)}function stageUp(){if(Global.PAUSED)return;$coin.tween({opacity:1},300,"easeOutCubic")}this.reset=function(){_this.isActivated=false;$this.show().css({opacity:1});$this.transform({x:0,y:0,scale:1});resize()}});Class(function CollectHotSpotVideo(_type){Inherit(this,Element);var _this=this;var $this=this.element;var _video=void 0;var $arc=void 0;var _size=1.2;(function(){initVideo();initArc();style()}());function initVideo(){_video=_this.initClass(Video,{src:Assets.CDN+("assets/videos/collect/"+_type+"-512"),loop:true,width:200*_size,height:200*_size,preload:true});$this.add(_video)}function initArc(){$arc=$this.create("Arc");$arc.bg=$arc.create("Background");$arc.rightMask=$arc.create("RightMask");$arc.rightLine=$arc.rightMask.create("RightLine");$arc.leftMask=$arc.create("LeftMask");$arc.leftLine=$arc.leftMask.create("LeftLine")}function style(){$this.size(200*_size,200*_size).center().css({borderRadius:1e3,overflow:"hidden"});$arc.size("100%");$arc.bg.css({top:0,right:0,bottom:0,left:0,borderRadius:1e3,border:"10px solid #fff"});$arc.rightMask.css({top:0,right:0,bottom:0,left:"50%",overflow:"hidden"});var s=7;$arc.rightLine.css({top:0,right:0,bottom:0,left:0,borderRadius:"0 1000px 1000px 0",transformOrigin:"0% 50%",border:s+"px solid #f4ea54",borderLeft:"none"});$arc.leftMask.css({top:0,left:0,bottom:0,right:"50%",overflow:"hidden"});$arc.leftLine.css({top:0,right:0,bottom:0,left:0,borderRadius:"1000px 0 0 1000px",transformOrigin:"100% 50%",border:s+"px solid #f4ea54",borderRight:"none"});$arc.rightLine.transform({rotation:180});$arc.leftLine.transform({rotation:180});$this.hide()}this.activate=function(){_video.play();$this.show();$this.css({opacity:0});$this.transform({scale:.2});$this.tween({opacity:1,scale:1,math:true,damping:.5,spring:1},1e3,"easeOutElastic");$arc.rightLine.tween({rotation:360,math:true},600,"easeInCubic",300).onComplete(function(){$arc.leftLine.tween({rotation:360,math:true},600,"easeOutCubic").onComplete(function(){$this.tween({opacity:0,scale:.2,math:true},500,"easeInBack").onComplete(function(){_video.stop();$this.hide()})})})}});Class(function CollectMovement(){Inherit(this,Component);var _this=this;var _inertiaTween=void 0,_upTimeout=void 0;var _height=1;var _move={target:new THREE.Vector3,ease:new THREE.Vector3,inertia:new THREE.Vector3,limit:new THREE.Vector3,speed:1,scale:1,hoverMove:0};(function(){initScene();addHandlers();_move.ease.x=_move.target.x=_move.limit.x}());function initScene(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);_this.move=_move}function loop(t,delta){var limitStrengthX=Math.map(Math.abs(_move.target.x)-_move.limit.x,0,400,.1,.8,true);if(_move.target.x<-_move.limit.x)_move.target.x+=(-_move.limit.x-_move.target.x)*limitStrengthX;if(_move.target.x>_move.limit.x)_move.target.x+=(_move.limit.x-_move.target.x)*limitStrengthX;var limitStrengthY=Math.map(Math.abs(_move.target.y)-_move.limit.y,0,150,.1,.8,true);if(_move.target.y<-_move.limit.y)_move.target.y+=(-_move.limit.y-_move.target.y)*limitStrengthY;if(_move.target.y>_move.limit.y)_move.target.y+=(_move.limit.y-_move.target.y)*limitStrengthY;_move.target.x+=_move.inertia.x*(Math.abs(_move.target.x)>_move.limit.x?.1:1);_move.target.y+=_move.inertia.y*(Math.abs(_move.target.y)>_move.limit.y?.1:1);_move.ease.lerp(_move.target,.5);if(Device.mobile)return;var hoverTarget=9*(Math.smoothStep(.85,1,Mouse.perc.x)-Math.smoothStep(.15,0,Mouse.perc.x))*(delta/16);if(_this.isDown)hoverTarget=0;_move.hoverMove+=(hoverTarget-_move.hoverMove)*.1;_move.target.x-=_move.hoverMove}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_this.events.sub(Mouse.input,Interaction.DRAG,drag);_this.events.sub(Mouse.input,Interaction.START,start);_this.events.sub(Mouse.input,Interaction.END,end)}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=2921/108e1;var ratio=r1/r2;if(r1>r2){_move.scale=_height/108e1*ratio;_move.limit.x=0}else{_move.scale=_height/108e1;_move.limit.x=(2921-108e1*r1)*.5}}function drag(){if(Global.PAUSED)return;_move.target.x+=Mouse.delta.x*_move.speed*(Stage.width/Stage.height);if(Device.mobile)return;_move.target.y+=-Mouse.delta.y*_move.speed*(Stage.width/Stage.height)}function start(){if(Global.PAUSED)return;if(_upTimeout)clearTimeout(_upTimeout);_this.isDown=true;stopInertia()}function end(){_upTimeout=_this.delayedCall(function(){_this.isDown=false},700);if(Global.PAUSED)return;_move.inertia.x=Mouse.delta.x*_move.speed*(Stage.width/Stage.height);_move.inertia.y=-Mouse.delta.y*_move.speed*(Stage.width/Stage.height);_inertiaTween=tween(_move.inertia,{x:0,y:0},1e3,"easeOutQuint")}function stopInertia(){if(_inertiaTween)_inertiaTween.stop();_move.inertia.set(0,0,0)}this.scrollIn=function(){_this.startRender(loop);_move.hoverMove=0};this.scrollOut=function(){_this.stopRender(loop)};this.reset=function(){_move.ease.x=_move.target.x=_move.limit.x;_move.hoverMove=0}});Class(function CollectResource(_params,_index){Inherit(this,Element);var _this=this;var $this=this.element;var $inner=void 0,$wrapper=void 0,$circle=void 0,$image=void 0;var _info=void 0;var _type=_params.type;(function(){initHTML();initInfo();style();addHandlers()}());function initHTML(){$wrapper=$this.create("Wrapper");$circle=$wrapper.create("Circle");$inner=$wrapper.create("Inner");$image=$inner.create("Image")}function initInfo(){}function style(){var step=140;$this.css({left:_index*step-1.5*step});$wrapper.size("100%");$circle.css({padding:55,margin:-55,background:"rgba(255, 255, 255, 0.3)",boxShadow:"0px 0px 0px 6px #fff",borderRadius:1e3});$image.size(150,150).center().bg("assets/images/collect/resources/"+_type+".png","contain");$circle.css({opacity:.3});$image.css({opacity:0})}function addHandlers(){$image.hover(hover);_this.events.sub(Mouse.input,Interaction.START,stageDown);_this.events.sub(Mouse.input,Interaction.END,stageUp)}function hover(e){return}function stageDown(){if(Global.PAUSED)return;$this.tween({opacity:.2},Math.random(300,500),"easeInOutCubic",70)}function stageUp(){if(Global.PAUSED)return;$this.tween({opacity:1},300,"easeOutCubic")}this.animateIn=function(delay){_this.isCompleted=true;$image.transform({scale:.5,rotation:Math.random(-20,20)});$image.tween({opacity:1,scale:1,rotation:1,math:true,damping:.5,spring:3},1e3,"easeOutElastic");$circle.tween({opacity:1},500,"easeOutCubic")};this.scrollIn=function(delay){$wrapper.transform({y:20}).css({opacity:0}).tween({opacity:1,y:0},800,"easeOutCubic",delay)};this.scrollOut=function(){$wrapper.tween({opacity:0,y:10},400,"easeOutCubic")};this.reset=function(){_this.isCompleted=false;$circle.css({opacity:.3});$image.css({opacity:0})}});Class(function CollectResourceInfo(_params){Inherit(this,Element);var _this=this;var $this=this.element;var $title=void 0,$text=void 0;(function(){initHTML();style()}());function initHTML(){$title=$this.create("Title");$text=$this.create("Text")}function style(){$this.center();$title.html(_params.title);$title.size(300,20).css({marginLeft:-150,top:-220,fontSize:50,letterSpacing:"0.03em",textAlign:"center"});$text.html(_params.text);$text.size(440,100).css({marginLeft:-220,top:-170,fontFamily:"OpenSans",fontSize:18,lineHeight:"1.4em",textAlign:"center"});$this.css({opacity:0})}this.animateIn=function(){$this.tween({opacity:1},500,"easeInOutCubic",100)};this.animateOut=function(){$this.tween({opacity:0},200,"easeOutCubic")}});Class(function CollectScene(_move){Inherit(this,Object3D);var _this=this;var _suburb=void 0;(function(){initSuburb();addHandlers()}());function initSuburb(){_suburb=_this.initClass(CollectSuburb,_move)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;_this.group.scale.setScalar(_move.scale)}this.scrollIn=function(dir){_this.isActive=true;_this.group.position.y=2*-dir;tween(_this.group.position,{y:0},12e2,"easeOutQuart");_this.delayedCall(function(){World.SCENE.add(_this.group)},800*.207)};this.scrollOut=function(dir){tween(_this.group.position,{y:2*dir},12e2,"easeOutQuart");_this.delayedCall(function(){World.SCENE.remove(_this.group);_this.isActive=false},800*.207)}});Class(function CollectSuburb(_move){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0;(function(){initShader();initMesh();addHandlers();_this.startRender(loop)}());function initShader(){var e=new THREE.Euler(1.57,3.14,.8);var m4=(new THREE.Matrix4).makeRotationFromEuler(e);var m3=(new THREE.Matrix3).setFromMatrix4(m4);_shader=_this.initClass(Shader,"Suburb");_shader.uniforms={uTime:World.TIME,uResolution:World.RESOLUTION,uMap:{type:"t",value:Utils3D.getTexture("assets/images/collect/suburb.jpg")},uNormalMap:{type:"t",value:Utils3D.getTexture("assets/images/collect/suburb-normals.jpg")},uMaskMap:{type:"t",value:Utils3D.getTexture("assets/images/collect/suburb-mask.jpg")},uMouse:{type:"v2",value:new THREE.Vector2},uMat3:{type:"m3",value:m3},uPosX:{type:"f",value:0},uZoom:{type:"f",value:0}}}function initMesh(){_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.scale.set(2921,108e1,1);_mesh.scale.multiplyScalar(1.07);_this.add(_mesh)}function loop(t){if(!_this.parent.isActive)return;_mesh.position.x=Math.sin(t*.001)*10;_mesh.position.y=Math.sin(t*.00052+4.14)*5;_mesh.position.z=Math.sin(t*.00073+2.14)*10+5;_this.group.position.lerp(_move.ease,.5);_shader.uniforms.uZoom.value+=((_this.isDown?1:0)-_shader.uniforms.uZoom.value)*.05;var hit=World.RAYCASTER.checkHit(_mesh);if(!hit.length)return;_shader.uniforms.uMouse.value.x=hit[0].uv.x;_shader.uniforms.uMouse.value.y=hit[0].uv.y;_shader.uniforms.uPosX.value=_move.limit.x<.1?0:_move.ease.x/_move.limit.x}function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,down);_this.events.sub(Mouse.input,Interaction.END,up)}function down(){_this.isDown=true}function up(){_this.isDown=false}});Class(function CollectView(_move){Inherit(this,Element);var _this=this;var $this=this.element;var $resourceCont=void 0,$hotSpotCont=void 0;var _endScreen=void 0,_rayTimeout=void 0;var _resources=[];var _hotSpots=[];var _collected=0;var _copy={title:Copy.messages["epic.fortnite.at.explore.collect.title"],cta:Copy.messages["epic.fortnite.at.explore.collect.cta"],cta1:Copy.messages["epic.fortnite.at.explore.collect.cta1"],p1:Copy.messages["epic.fortnite.at.explore.collect.p1"],p2:Copy.messages["epic.fortnite.at.explore.collect.p2"],p3:Copy.messages["epic.fortnite.at.explore.collect.p3"],p4:Copy.messages["epic.fortnite.at.explore.collect.p4"],rey1:Copy.messages["epic.fortnite.at.explore.collect.rey1"],rey2:Copy.messages["epic.fortnite.at.explore.collect.rey2"],rey3:Copy.messages["epic.fortnite.at.explore.collect.rey3"],rey4:Copy.messages["epic.fortnite.at.explore.collect.rey4"],rey5:Copy.messages["epic.fortnite.at.explore.collect.rey5"],rey6:Copy.messages["epic.fortnite.at.explore.collect.rey6"],title1:Copy.messages["epic.fortnite.at.explore.collect.title1"],title2:Copy.messages["epic.fortnite.at.explore.collect.title2"],title3:Copy.messages["epic.fortnite.at.explore.collect.title3"],title4:Copy.messages["epic.fortnite.at.explore.collect.title4"]};(function(){$this.css({position:"static"});initHTML();initResources();initEndScreen();style();addHandlers()}());function initHTML(){$resourceCont=$this.create("Resources");$hotSpotCont=$this.create("HotSpots")}function initResources(){[{type:"planks",pos:[.13,.37],scale:.8,title:_copy.title1,rey:_copy.rey2,text:_copy.p1},{type:"brick",pos:[.3,.73],scale:1,title:_copy.title2,rey:_copy.rey3,text:_copy.p2},{type:"metal",pos:[.76,.5],scale:.7,title:_copy.title4,rey:_copy.rey4,text:_copy.p4},{type:"nuts",pos:[.91,.7],scale:.9,title:_copy.title3,rey:_copy.rey5,text:_copy.p3}].forEach(function(d,i){var hotSpot=_this.initClass(CollectHotSpot,d,_move,i,[$hotSpotCont]);_hotSpots.push(hotSpot);var resource=_this.initClass(CollectResource,d,i,[$resourceCont]);resource.index=i;resource.text=d.rey;_resources.push(resource)})}function initEndScreen(){_endScreen=_this.initClass(CollectEndScreen,_copy)}function style(){$resourceCont.css({top:"50%",left:"50%",marginTop:0});$hotSpotCont.css({top:"50%",left:"50%"});$hotSpotCont.x=0;$hotSpotCont.y=0;$hotSpotCont.transform();$this.hide()}function loop(){$hotSpotCont.x+=(Stage.height/108e1*_move.ease.x-$hotSpotCont.x)*.3;$hotSpotCont.y+=(Stage.height/108e1*-_move.ease.y-$hotSpotCont.y)*.3;$hotSpotCont.transform()}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_hotSpots.forEach(function(hotspot){_this.events.sub(hotspot,Events.CLICK,collect)})}function resize(){if(Global.PAUSED)return;if(_this.isComplete){$resourceCont.transform({scale:1,y:0})}else{$resourceCont.transform({scale:.6,y:Stage.height*.5-90})}}function collect(e){_this.delayedCall(function(){_resources[e.index].animateIn();if(++_collected>=4)complete()},2e3);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_resources[e.index].text);_rayTimeout=_this.delayedCall(function(){Ray.instance().close()},4e3)},17e2)}function complete(){_this.isComplete=true;$resourceCont.tween({scale:1,y:0},500,"easeOutCubic");_endScreen.animateIn();if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey6);_rayTimeout=_this.delayedCall(Ray.instance().close,4e3)},3e3)}this.scrollIn=function(dir){_this.startRender(loop);_this.delayedCall(function(){$this.show().css({opacity:0}).tween({opacity:1},400,"easeInOutSine");_resources.forEach(function(icon){icon.scrollIn(icon.index*200+400)});Ray.instance().change(_copy.rey1);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(Ray.instance().close,4e3);DragPrompt.instance().start()},500)};this.scrollOut=function(dir){if(_rayTimeout)clearTimeout(_rayTimeout);Ray.instance().animateOut();_resources.forEach(function(icon){icon.scrollOut()});$this.tween({opacity:0},200,"easeOutSine").onComplete(function(){$this.clearAlpha().hide();_this.stopRender(loop)});_endScreen.animateOut()};this.reset=function(){_this.isComplete=false;resize();_endScreen.reset();_collected=0;_resources.forEach(function(icon){icon.reset()});_hotSpots.forEach(function(hotspot){hotspot.reset()})}});Class(function ExploreScene(){Inherit(this,Object3D);var _this=this;var _screens=void 0,_videoOverlay=void 0;var _height=1;(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);initScreens();if(Tests.playExploreVideo())initOverlay();addHandlers()}());function initScreens(){_screens=_this.initClass(ExploreScreens);_this.tracker2D=_screens.tracker2D}function initOverlay(){var shader=new THREE.MeshBasicMaterial({color:"#000",transparent:true,depthTest:false,opacity:1});_videoOverlay=new THREE.Mesh(World.PLANE,shader);_videoOverlay.scale.set(192e1,128e1,1);_videoOverlay.shader=shader;_videoOverlay.renderOrder=3;_this.add(_videoOverlay)}function animateIn(dir){_this.group.rotation.y=-.2;tween(_this.group.rotation,{y:0},15e2,"easeOutQuart");_this.group.position.x=-1;_this.group.position.y=1*-dir;tween(_this.group.position,{x:0,y:0},15e2,"easeOutQuart")}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=192e1/108e1;if(r1>r2){_this.group.scale.setScalar(_height/108e1*(r1/r2))}else{_this.group.scale.setScalar(_height/108e1)}_this.group.position.x=-7*Math.map(r1/r2,0,1,1,0,true)}this.scrollIn=function(dir,transition){_screens.animateIn();_this.delayedCall(function(){World.SCENE.add(_this.group);if(_this.isVideoComplete)animateIn(dir)},transition==1?500:800*.207)};this.scrollOut=function(dir,transition){tween(_this.group.rotation,{y:.1},700,"easeInOutSine");tween(_this.group.position,{x:1,y:1*dir},700,"easeInOutSine");_screens.animateOut();_this.delayedCall(function(){World.SCENE.remove(_this.group)},transition==1?500:800*.207)};this.videoComplete=function(){_this.isVideoComplete=true;tween(_videoOverlay.shader,{opacity:0},500,"easeOutCubic").onComplete(function(){_this.group.remove(_videoOverlay)});animateIn(1)}});Class(function ExploreScreens(){Inherit(this,Object3D);var _this=this;var _tracker=void 0,_screenShader=void 0;var _shaders=[];var _main=void 0;var _data=[{scale:[503.56,480.97],pos:[760,0]},{scale:[505,480.97],pos:[270,0]},{scale:[503.56,480.97],pos:[-265,0]},{scale:[503.56,480.97],pos:[-780,0]},{scale:[503.56,480.97],pos:[760,500]},{scale:[503.56,480.97],pos:[260,500]},{scale:[503.56,480.97],pos:[-265,500]},{scale:[503.56,480.97],pos:[-800,500]},{scale:[533.56,520.97],pos:[800,-560]},{scale:[550.56,520.97],pos:[270,-560]},{scale:[533.56,520.97],pos:[-270,-560]},{scale:[533.56,520.97],pos:[-830,-560]}];(function(){initOverlay();initScreens();initTracker();addHandlers();_this.group.scale.setScalar(1.15)}());function initOverlay(){var shader=_this.initClass(Shader,"ExploreScreensTV");shader.uniforms={tMap:{type:"t",value:Utils3D.getTexture("assets/images/explore/overlay.jpg")},tMask:{type:"t",value:Utils3D.getTexture("assets/images/explore/overlay-mask.jpg")},resolution:World.RESOLUTION,xTilt:{type:"f",value:0}};shader.material.transparent=true;_screenShader=shader;var mesh=new THREE.Mesh(World.PLANE,shader.material);var s=1.4;mesh.scale.set(1517*s,1128*s,1);_this.add(mesh)}function getMainScreenShader(){var shader=_this.initClass(Shader,"MainTVScreen");shader.uniforms={uTime:World.TIME,uResolution:World.RESOLUTION,uScreens:{type:"t",value:Utils3D.getTexture("assets/images/explore/main-screen.jpg")},uNoise:{type:"t",value:Utils3D.getRepeatTexture("assets/images/explore/noise.jpg")},uOffset:{type:"v2",value:new THREE.Vector2},uHover:{type:"f",value:0},uMouse:{type:"v2",value:new THREE.Vector2}};_main=shader;_shaders.push(shader);return shader}function getScreenShader(i){var isGlitch=0;var isFuzz=0;if(i.toString().includes([5,10]))isFuzz=1;if(i.toString().includes([3,4,9]))isGlitch=1;var shader=_this.initClass(Shader,"TVScreen");shader.uniforms={uTime:World.TIME,uResolution:World.RESOLUTION,uScreens:{type:"t",value:Utils3D.getTexture("assets/images/explore/"+(isGlitch?"glitch":"screens")+".jpg")},uNoise:{type:"t",value:Utils3D.getRepeatTexture("assets/images/explore/noise.jpg")},uOffset:{type:"v2",value:new THREE.Vector2},uRandom:{type:"v4",value:new THREE.Vector4(Math.random(0,1,3),Math.random(0,1,3),Math.random(0,1,3),Math.random(-1,1,3))},uGlitch:{type:"f",value:isGlitch?1:0},uFuzz:{type:"f",value:isFuzz?1:0},uMouse:{type:"v2",value:new THREE.Vector2}};_shaders.push(shader);return shader}function initScreens(){_data.forEach(function(d,i){var shader=i===1?getMainScreenShader():getScreenShader(i);var mesh=new THREE.Mesh(World.PLANE,shader.material);var s=.85;mesh.scale.set(d.scale[0]*s,d.scale[1]*s,1);mesh.position.set(d.pos[0]-20,d.pos[1],-40);_this.add(mesh)})}function loop(){var tx=Mouse.tilt.x*30;var ty=Mouse.tilt.y*15;_this.group.position.x+=(tx-_this.group.position.x)*.07;_this.group.position.y+=(ty-_this.group.position.y)*.07;_this.group.rotation.y=Math.radians(-10+Math.range(_this.group.position.x,-30,30,-2,2));_this.tracker2D.copy(_tracker.proj.project(_tracker));_screenShader.set("xTilt",Mouse.tilt.x);_shaders.forEach(function(shader){shader.uniforms.uMouse.value.copy(Mouse.perc)})}function frameLoop(frame){var x=Math.random(-1,1,3);var y=Math.random(-1,1,3);_shaders.forEach(function(shader){shader.uniforms.uOffset.value.set(x,y)})}function initTracker(){_tracker=new THREE.Group;_tracker.position.set(540,-20,0);_this.group.add(_tracker);_tracker.proj=new ScreenProjection(World.CAMERA);_this.tracker2D=new THREE.Vector2}function addHandlers(){_this.events.sub(FortniteEvents.TV_HOVER,hover)}function hover(e){switch(e.action){case"over":_main.tween("uHover",1,300,"easeOutSine");break;case"out":_main.tween("uHover",0,500,"easeOutSine");break}}this.animateIn=function(){_this.startRender(loop);_this.startRender(frameLoop,30)};this.animateOut=function(){_this.stopRender(loop);_this.stopRender(frameLoop)}});Class(function ExploreVideo(){Inherit(this,Element);var _this=this;var $this=this.element;var _video=void 0,$textCont=void 0,$bars=void 0;var _skip=void 0;var _progress=0;var _copy={skip:Copy.messages["epic.fortnite.at.explore.video.skip"]};var _videoLines=[Copy.messages["epic.fortnite.at.explore.video.p1"],Copy.messages["epic.fortnite.at.explore.video.p2"],Copy.messages["epic.fortnite.at.explore.video.p3"],Copy.messages["epic.fortnite.at.explore.video.p4"]];var _text;(function(){initVideo();initText();style();addHandlers()}());function initVideo(){_video=_this.initClass(Video,{src:Assets.CDN+"assets/videos/explore-720",width:128e1,height:720,preload:true});_video.object.mouseEnabled(false);if(Device.mobile){_video.volume(0);_video.object.attr("muted",true);_video.div.crossOrigin="anonymous"}$this.add(_video);_skip=_this.initClass(UIWarpPrompt,_copy.skip.toUpperCase(),Tests.skipPromptWidth(),60);_skip.element.css({bottom:70,marginLeft:"",left:"",right:70,marginTop:"",top:"",opacity:0}).mouseEnabled(false);_this.events.sub(_skip,Events.CLICK,complete)}function initText(){$textCont=$this.create("TextContainer")}function style(){$this.size("100%").css({background:"#000"});$textCont.size(11e2,200).center().css({textAlign:"center"});_text=[];for(var i=0;i<_videoLines.length;i++){var $text=$textCont.create(".text");var height=_videoLines[i].length>50?120:60;$text.size(11e2,height).center().css({fontSize:60,letterSpacing:"0.03em",textAlign:"center",display:"block"});$text.html(_videoLines[i]);var words=SplitTextfield.split($text,"word");for(var j=0;j<words.length;j++){words[j].transform({y:20,scale:.97}).css({opacity:0,transformOrigin:"0% 0%"});var text=words[j].div.innerHTML;if(text.includes("/")){words[j-1].css({display:"inline"}).html("<br>");words[j-1].newLine=true;words[j].text(text.split("/")[1])}}_text.push(words)}}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_this.events.sub(_video,Events.UPDATE,progress);_this.events.sub(_video,Events.COMPLETE,complete)}function progress(e){if(e.time>18&&_progress==7){_progress++;animateOutText(3)}else if(e.time>14.5&&_progress==6){_progress++;animateInText(3)}else if(e.time>10.5&&_progress==5){_progress++;animateOutText(2)}else if(e.time>8.5&&_progress==4){_progress++;animateInText(2)}else if(e.time>8.33&&_progress==3){_progress++;animateOutText(1)}else if(e.time>6.1&&_progress==2){_progress++;animateInText(1)}else if(e.time>2.3&&_progress==1){_progress++;animateOutText(0)}else if(e.time>.33&&_progress===0){_progress++;animateInText(0)}}function animateInText(index){var delay=0;for(var i=0;i<_text[index].length;i++){_text[index][i].tween({scale:1,y:0,opacity:1,math:true},12e2,"easeOutElastic",delay);delay+=20;if(_text[index][i].newLine)delay+=100}}function animateOutText(index){for(var i=0;i<_text[index].length;i++){_text[index][i].tween({scale:.97,y:0,opacity:0},100,"easeOutCubic",i*2)}}function complete(e){_this.isComplete=true;_this.events.fire(Events.COMPLETE,null,true);if(_progress<8)Tracking.event(Tracking.skipVideo);if(_progress==8)Tracking.event(Tracking.completeVideo)}function resize(){if(Global.PAUSED)return;var r1=192e1/108e1;var r2=Stage.width/Stage.height;if(r1>r2){_video.object.css({top:0,left:-(Stage.height*r1-Stage.width)*.5,height:"100%",width:"auto"})}else{_video.object.css({top:-(Stage.width/r1-Stage.height)*.5,left:0,width:"100%",height:"auto"})}var s=Math.map(Stage.width,600,14e2,.4,1,true);$textCont.transform({scale:s})}this.play=function(){_video.play();_skip.element.mouseEnabled(true).transform({scaleX:.8,scaleY:.9}).css({opacity:0}).tween({opacity:1,scaleY:1,scaleX:1},1e3,"easeOutBack",500);_skip.animateIn()};this.pause=function(){_video.pause();_skip.animateOut()}});Class(function ExploreView(_scene){Inherit(this,Element);var _this=this;var $this=this.element;var _video=void 0,_prompt=void 0,_rayTimeout=void 0,_words=void 0;var $title=void 0;var _copy={title:Copy.messages["epic.fortnite.at.explore.explore.title"],explore:Copy.messages["epic.fortnite.at.explore.explore.cta1"],begin:Copy.messages["epic.fortnite.at.explore.explore.cta2"],p1:Copy.messages["epic.fortnite.at.explore.explore.p1"],rey1:Copy.messages["epic.fortnite.at.explore.explore.rey1"],rey2:Copy.messages["epic.fortnite.at.explore.explore.rey2"],rey3:Copy.messages["epic.fortnite.at.explore.explore.rey3"]};(function(){$this.css({position:"static"});initTitle();initPrompt();if(Tests.playExploreVideo())initVideo();style();addHandlers()}());function initTitle(){$title=$this.create("Title")}function initPrompt(){_prompt=_this.initClass(UIWarpPrompt,_copy.begin.toUpperCase(),Tests.beginMissionPromptWidth(),60);_prompt.element.back.bg("assets/images/common/ui/yellow-gradient.jpg");_prompt.element.text.css({color:"#00001b"});_prompt.element.css({left:"",top:""})}function initVideo(){_video=_this.initClass(ExploreVideo);_video.element.css({opacity:0})}function style(){$title.html(_copy.title.toUpperCase());$title.css({top:90,left:90,width:450,fontSize:100,lineHeight:"0.85em",letterSpacing:"0.03em"});_words=SplitTextfield.split($title,"word");for(var i=0;i<_words.length;i++){_words[i].css({opacity:0})}_words.push(_prompt.element);_prompt.element.css({opacity:0});$this.hide()}function animateIn(){for(var i=0;i<_words.length;i++){_words[i].transform({y:30,rotation:Math.random(-5,5,3)}).css({opacity:0}).tween({y:0,rotation:0,opacity:1},15e2,"easeOutElastic",i*60+200)}initRay();_prompt.animateIn()}function initRay(){Ray.instance().animateIn();if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey1);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey2);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey3);_rayTimeout=_this.delayedCall(Ray.instance().close,4e3)},2e3)},3e3)},500)}function loop(){_prompt.element.transform(_scene.tracker2D)}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();if(_video)_this.events.bubble(_video,Events.COMPLETE);_this.events.sub(_prompt,Events.CLICK,next);_this.events.sub(_prompt,Events.HOVER,hover)}function hover(e){_this.events.fire(FortniteEvents.TV_HOVER,e)}function resize(){var r1=Stage.width/Stage.height;var r2=192e1/108e1;var promptX=0;var promptY=0;if(r1>r2){promptX=-100-Stage.width*.2;promptY=-80+Stage.width*.07}else{promptY=-80+Stage.height*.13;promptX=-120-Stage.height*.31}_prompt.element.css({marginLeft:promptX,marginTop:promptY})}function next(){_this.events.fire(FortniteEvents.INCREMENT_SCROLL,{dir:1});Tracking.event(Tracking.beginMission)}function scrollIntent(){_this.events.unsub(FortniteEvents.SCROLL_INTENT,scrollIntent);_this.events.fire(Events.COMPLETE,null,true)}this.scrollIn=function(dir){_this.startRender(loop);_this.delayedCall(function(){Ray.instance().bigModel();$this.show().clearAlpha();if(_video&&!_video.isComplete){_this.events.fire(FortniteEvents.PAUSE_SCROLL);_video.element.tween({opacity:1},500,"easeInOutCubic");_video.play();_this.delayedCall(function(){_this.events.sub(FortniteEvents.SCROLL_INTENT,scrollIntent)},700)}else{for(var i=0;i<_words.length;i++){_words[i].clearTween().transform({y:30,rotation:Math.random(-5,5,3)}).css({opacity:0}).tween({y:0,rotation:0,opacity:1},15e2,"easeOutElastic",i*30+200)}initRay();_prompt.animateIn()}},500)};this.scrollOut=function(dir){if(_rayTimeout)clearTimeout(_rayTimeout);Ray.instance().animateOut();$this.tween({opacity:0},200,"easeOutSine").onComplete(function(){$this.clearAlpha().hide();_this.stopRender(loop);for(var i=0;i<_words.length;i++){_words[i].clearTween().transform({y:30,rotation:Math.random(-5,5,3)}).css({opacity:0})}_prompt.animateOut()});_this.delayedCall(function(){Ray.instance().smallModel()},400)};this.videoComplete=function(){_this.isVideoComplete=true;if(_video)_video=_video.destroy();animateIn();_this.delayedCall(function(){_this.events.fire(FortniteEvents.RESUME_SCROLL)},700)}});Class(function FortsScene(){Inherit(this,Object3D);var _this=this;var _env,_structures;var _wiggleCont=new THREE.Group;var _mouseCont=new THREE.Group;var _mouse=new THREE.Vector2;var _mouseEase=new THREE.Vector2;var _height=1;(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);_mouseCont.add(_wiggleCont);_this.add(_mouseCont);initViews();addHandlers()}());function initViews(){_env=_this.initClass(FortsSceneEnvironment,null);_structures=_this.initClass(FortsSceneStructures,null);_wiggleCont.add(_env.group);_wiggleCont.add(_structures.group);_wiggleCont.wiggle=new WiggleBehavior(_wiggleCont.position);_wiggleCont.wiggle.zMove=0;_wiggleCont.wiggle.scale=.01;_wiggleCont.wiggle.speed=.1}function loop(){_wiggleCont.wiggle.update();_mouse.lerp(Mouse.tilt,.1);_mouseEase.lerp(_mouse,.05);_mouseCont.position.x=_mouseEase.x*.22;_mouseCont.position.y=_mouseEase.y*.1}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=192e1/108e1;if(r1>r2){_mouseCont.scale.setScalar(r1/r2)}else{_mouseCont.scale.setScalar(1)}}this.scrollIn=function(dir){_this.startRender(loop);_structures.reset();_this.group.position.y=2*-dir;tween(_this.group.position,{y:0},12e2,"easeOutQuart");_this.delayedCall(function(){World.SCENE.add(_this.group)},800*.207)};this.scrollOut=function(dir){tween(_this.group.position,{y:2*dir},12e2,"easeOutQuart");_this.delayedCall(function(){_this.stopRender(loop);World.SCENE.remove(_this.group)},800*.207)};this.next=function(){_structures.next()}});Class(function FortsSceneEnvironment(){Inherit(this,Object3D);var _this=this;var SCALE=8.5;(function(){initMid();initGrass();initSky()}());function initLayout(){var geom=new THREE.PlaneBufferGeometry(1.9*SCALE,1.08*SCALE);var mat=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/forts/_layout.jpg")});var mesh=new THREE.Mesh(geom,mat);mesh.position.z=-.0001;_this.add(mesh)}function initMid(){var geom=new THREE.PlaneBufferGeometry(1.9*SCALE,.357*SCALE);var shader=getShader("FortLayer","mid");var mesh=new THREE.Mesh(geom,shader.material);mesh.position.y=-.85;_this.add(mesh)}function initGrass(){var geom=new THREE.PlaneBufferGeometry(1.9*SCALE,.389*SCALE);var shader=getShader("FortGrass","grass");var mesh=new THREE.Mesh(geom,shader.material);mesh.position.y=-2.92;_this.add(mesh)}function initSky(){var geom=new THREE.PlaneBufferGeometry(1.9*SCALE,.7*SCALE);var shader=_this.initClass(Shader,"FortBase","FortSky");shader.uniforms={tColor:{type:"t",value:Utils3D.getTexture("assets/images/forts/sky-color.jpg")},tClouds:{type:"t",value:Utils3D.getRepeatTexture("assets/images/forts/sky-clouds.jpg")},time:World.TIME};shader.material.transparent=true;shader.material.depthWrite=false;var mesh=new THREE.Mesh(geom,shader.material);mesh.position.z=-.001;mesh.position.y=1.6;_this.add(mesh)}function getShader(fs,layer){var shader=_this.initClass(Shader,"FortBase",fs);shader.uniforms={tMap:{type:"t",value:Utils3D.getTexture("assets/images/forts/"+layer+"-color.jpg")},tMask:{type:"t",value:Utils3D.getTexture("assets/images/forts/"+layer+"-mask.jpg")},time:World.TIME};shader.material.transparent=true;shader.material.depthWrite=false;return shader}});Class(function FortsSceneStructures(){Inherit(this,Object3D);var _this=this;var _geom,_shader,_forts;var _current=0;var SCALE=8.5;(function(){initPlaneGeom();initForts()}());function initPlaneGeom(){_geom=new THREE.PlaneBufferGeometry(1.649*SCALE,.827*SCALE);_geom.translate(0,.827*SCALE*.5,0)}function initForts(){_forts=[];for(var i=0;i<3;i++){_forts.push(getMesh(getShader("fort"+i)))}_forts[0].shader.set("opacity",1);_forts[0].visible=true}function getShader(layer){if(!_shader){_shader=_this.initClass(Shader,"FortBase","FortStructure");_shader.uniforms={tMap:{type:"t",value:null},tMask:{type:"t",value:null},time:World.TIME,transition:{type:"f",value:0},opacity:{type:"f",value:0}};_shader.material.transparent=true;_shader.material.depthWrite=false}var shader=_shader.clone();shader.set("transition",0);shader.set("opacity",0);shader.set("tMap",Utils3D.getTexture("assets/images/forts/"+layer+"-color.jpg"));shader.set("tMask",Utils3D.getTexture("assets/images/forts/"+layer+"-mask.jpg"));return shader}function getMesh(shader){var mesh=new THREE.Mesh(_geom,shader.material);mesh.position.y=-.827*SCALE*.5;_this.add(mesh);mesh.shader=shader;mesh.visible=false;return mesh}this.next=function(){var current=_forts[_current];++_current;if(_current>2)return;var next=_forts[_current];current.shader.tween("transition",1,300,"easeOutSine",50).onComplete(function(){current.visible=false});tween(current.scale,{y:1.3,x:1.4},300,"easeInOutCubic");next.visible=true;next.shader.tween("opacity",1,250,"easeInOutCubic",70);next.scale.set(1.1,1.03,1);tween(next.scale,{x:1,y:1},900,"easeOutElastic")};this.reset=function(){_current=0;for(var i=0;i<_forts.length;i++){_forts[i].shader.set("transition",0);_forts[i].shader.set("opacity",i==0?1:0);_forts[i].scale.set(1,1,1);_forts[i].visible=true}}});Class(function FortsView(_scene){Inherit(this,Element);var _this=this;var $this=this.element;var _rayTimeout=void 0,_button=void 0,_defend=void 0;var _titles=[];var _current=0;var _copy={fortLevel:Copy.messages["epic.fortnite.at.explore.build.fortLevel"],upgrade:Copy.messages["epic.fortnite.at.explore.build.upgrade"]||"Upgrade",small:Copy.messages["epic.fortnite.at.explore.build.fortLevel.small"],medium:Copy.messages["epic.fortnite.at.explore.build.fortLevel.medium"],large:Copy.messages["epic.fortnite.at.explore.build.fortLevel.large"],rey1:Copy.messages["epic.fortnite.at.explore.build.rey1"],rey2:Copy.messages["epic.fortnite.at.explore.build.rey2"],rey3:Copy.messages["epic.fortnite.at.explore.build.rey3"],rey4:Copy.messages["epic.fortnite.at.explore.build.rey4"],rey5:Copy.messages["epic.fortnite.at.explore.build.rey5"],rey6:Copy.messages["epic.fortnite.at.explore.build.rey6"],rey7:Copy.messages["epic.fortnite.at.explore.build.rey7"],rey8:Copy.messages["epic.fortnite.at.explore.build.rey8"],defend:Copy.messages["epic.fortnite.at.explore.weapons.title"]};(function(){initHTML();initButton();initTitles();addListeners();resizeHandler()}());function initHTML(){$this.css({position:"static"}).hide()}function initButton(){_button=_this.initClass(UIWarpPrompt,_copy.upgrade.toUpperCase(),Tests.upgradePromptWidth(),70);_button.element.css({bottom:70,marginTop:"",top:"",opacity:0}).mouseEnabled(false);_this.events.sub(_button,Events.CLICK,buttonClick);_defend=_this.initClass(UIWarpPrompt,_copy.defend.toUpperCase(),Tests.defendPromptWidth(),70,true);_defend.element.css({bottom:70,marginTop:"",top:"",opacity:0}).mouseEnabled(false);_this.events.sub(_defend,Events.CLICK,next)}function initTitles(){_titles.push(_this.initClass(FortsViewTitle,_copy.small));_titles.push(_this.initClass(FortsViewTitle,_copy.medium));_titles.push(_this.initClass(FortsViewTitle,_copy.large))}function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){if(Device.mobile.phone){if(Stage.width>Stage.height)_button.element.css({bottom:30});else _button.element.css({bottom:50})}}function buttonClick(){var current=_titles[_current];if(++_current>2)return;var next=_titles[_current];_scene.next();current.animateOut();_this.delayedCall(next.animateIn,150);if(_current==2){_button.element.mouseEnabled(false).tween({opacity:0,scaleY:.5,scaleX:.5},600,"easeOutCubic",function(){_button.animateOut();_defend.animateIn();_defend.element.mouseEnabled(true).transform({scaleX:.8,scaleY:.9}).css({opacity:0}).tween({opacity:1,scaleY:1,scaleX:1},1e3,"easeOutBack")})}if(_current==1){Ray.instance().change(_copy.rey4);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey5);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey6);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(Ray.instance().close,35e2)},3e3)},25e2)}if(_current==2){Ray.instance().change(_copy.rey7);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey8);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(Ray.instance().close,35e2)},25e2)}Tracking.event(Tracking.upgrade,_current-1)}function next(){_this.events.fire(FortniteEvents.INCREMENT_SCROLL,{dir:1});Tracking.event(Tracking.defendPrompt)}this.scrollIn=function(dir){_current=0;_this.delayedCall(function(){$this.show();_button.animateIn();_button.element.mouseEnabled(true).transform({scaleX:.8,scaleY:.9}).css({opacity:0}).tween({opacity:1,scaleY:1,scaleX:1},1e3,"easeOutBack",500);_this.delayedCall(_titles[_current].animateIn,200);if(_current!==0)return;Ray.instance().change(_copy.rey1);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey2);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey3);if(_rayTimeout)clearTimeout(_rayTimeout);_rayTimeout=_this.delayedCall(Ray.instance().close,4e3)},35e2)},25e2)},500)};this.scrollOut=function(dir){if(_rayTimeout)clearTimeout(_rayTimeout);Ray.instance().animateOut();for(var i=0;i<_titles.length;i++){_titles[i].animateOut(true)}_button.element.mouseEnabled(false).tween({opacity:0,scaleY:.5,scaleX:.5},300,"easeOutCubic").onComplete(function(){_button.animateOut()});_defend.element.mouseEnabled(false).tween({opacity:0,scaleY:.5,scaleX:.5},300,"easeOutCubic").onComplete(function(){_defend.animateOut()});$this.tween({opacity:0},300,"easeOutSine").onComplete(function(){$this.clearAlpha().hide()})}});Class(function FortsViewTitle(_text){Inherit(this,Element);var _this=this;var $this,$wrapper;var _array;(function(){initHTML();initText()}());function initHTML(){$this=_this.element;$this.invisible().transform({z:1}).setZ(10);$wrapper=$this.create(".wrapper");$wrapper.size(800,20).transform({z:2}).enable3D(2e3).setZ(1);$wrapper.css({left:75,top:75});$wrapper.size(800,20).fontStyle("BurbankBigCondensed-Black",Tests.fortTitleSize(),"#fff").text(_text.toUpperCase())}function initText(){_array=SplitTextfield.split($wrapper,"letter")}this.animateIn=function(){$this.visible();_array.forEach(function($l,i){$l.transform({rotationX:-60,y:50}).css({opacity:0});$l.tween({rotationX:0,y:0,opacity:1},13e2,"easeOutElastic",i*30)})};this.animateOut=function(isScrollOut){if(isScrollOut){_array.forEach(function($l,i){$l.tween({opacity:0},150,"easeOutCubic",i*20)});return}_array.forEach(function($l,i){$l.tween({rotationX:60,y:-50,opacity:0},300,"easeOutCubic",i*30)})}});Class(function IntroCharacter(_params,_mouse,_index){Inherit(this,Object3D);var _this=this;var _anim={sword:0,swordTarget:0};(function(){initRig()}());function initRig(){var geometry=Utils3D.loadSkinnedGeometry("geometry/characters/"+_params.type+"-rig");var MeshCustomMaterial=IntroCharacter.getMaterial();var shader=new MeshCustomMaterial({map:Utils3D.getTexture("assets/images/intro/characters/"+_params.type+"/texture.jpg"),transparent:true,skinning:true});shader.uniforms.uMask={value:Utils3D.getTexture("assets/images/intro/characters/"+_params.type+"/mask.jpg")};var mesh=new THREE.SkinnedMesh(geometry,shader);var root=new THREE.Group;root.add(mesh.children[0]);mesh.add(root);root.scale.setScalar(_params.scale);mesh.position.x=_params.x;mesh.position.y=_params.y;mesh.position.z=_index-2;_this.add(mesh);var mixer=new THREE.AnimationMixer(mesh);var animation=Assets.JSON["geometry/characters/"+_params.type+"-anim"].animation;var clip=THREE.AnimationClip.parseAnimation(animation,geometry.bones);var action=mixer.clipAction(clip);action.play();_this.startRender(function(t,delta){if(!_this.parent.group.visible)return;if(Global.PAUSED)return;mixer.update(_params.speed*delta/16)})}},function(){var _material=void 0;IntroCharacter.getMaterial=function(){if(!_material)_material=Shader.CustomBasicMaterial("Character");return _material}});Class(function IntroHands(_mouse){Inherit(this,Object3D);var _this=this;var _positions=[{x:-278.3,y:-465.3,width:146.5,height:192.9},{x:-210,y:-483.4,width:77.1,height:159.9},{x:-79.7,y:-505,width:100,height:115},{x:-3.8,y:-426.7,width:71.6,height:272.5},{x:135.2,y:-488.2,width:118.9,height:151.2},{x:264.5,y:-436.4,width:99.2,height:252.8},{x:578.7,y:-477.9,width:92.9,height:170.1},{x:695.6,y:-438.9,width:102.4,height:249.6},{x:769.1,y:-454.4,width:64.5,height:217.4},{x:922.7,y:-437.3,width:103.1,height:253.6}];var _hands=[];(function(){init();_this.startRender(loop)}());function init(){_positions.forEach(function(d,i){addHand(d,i+1)})}function addHand(d,index){var geometry=IntroHands.getGeometry();var material=new THREE.MeshBasicMaterial({transparent:true,map:Utils3D.getTexture("assets/images/intro/hands/"+Utils.padInt(index,3)+".png")});var mesh=new THREE.Mesh(geometry,material);mesh.scale.set(d.width,d.height,1);mesh.position.y=.5*d.height;var hand=new THREE.Group;hand.add(mesh);hand.random=new THREE.Vector3(Math.random(0,1,3),Math.random(0,1,3),Math.random(0,1,3));hand.position.x=d.x;hand.position.y=d.y-.5*d.height;hand.position.targetY=hand.position.y;hand.position.y-=Math.random(0,100);hand.position.z=index*.1+4;hand.position.ease=(new THREE.Vector3).copy(hand.position);_this.add(hand);_hands.push(hand)}function loop(t){if(!_this.parent.group.visible)return;if(Global.PAUSED)return;_hands.forEach(function(hand,i){var shake=hand.random.x*Math.sin(t*.05)*.02*Math.map(Math.sin(t*.001+hand.random.y*6.28))*Math.map(Math.sin(t*.000647+hand.random.z*6.28));hand.rotation.z+=(Math.sin(t*.001+hand.random.z*3.14)*Math.sin(t*.000342+hand.random.y*3.14)*.06*hand.random.z+shake-hand.rotation.z)*.2;hand.position.ease.y+=(hand.position.targetY-hand.position.ease.y)*(.005+hand.random.y*.007);hand.position.y+=(hand.position.ease.y-hand.position.y)*.1;if(Math.abs(_mouse.y-hand.position.targetY)>350)return;if(Math.abs(_mouse.x-hand.position.x)>120)return;hand.position.ease.y+=(hand.position.targetY-300-hand.position.ease.y)*(.06+hand.random.x*.06);hand.position.y+=(hand.position.ease.y-hand.position.y)*.1;hand.rotation.z-=(1-Math.pow(Math.map(Math.abs(hand.position.targetY-300-hand.position.y),0,300,1,0),4))*.02*(i<6?-1:1)*hand.random.y})}},function(){var _geometry=void 0;IntroHands.getGeometry=function(){if(_geometry)return _geometry;_geometry=new THREE.PlaneBufferGeometry(1,1);return _geometry}});Class(function IntroScene(){Inherit(this,Object3D);var _this=this;var _height=1;var _layers=[];var _mouse=new THREE.Vector2;var _mouseEase=new THREE.Vector2;var _anim={transition:0};(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);initSky();initCity();initCharacters();initFog();initWall();initHands();addHandlers();wrapLayers();World.SCENE.add(_this.group);_this.startRender(loop)}());function initSky(){var geometry=new THREE.PlaneBufferGeometry(192e1,108e1);var shader=_this.initClass(Shader,"Sky");shader.uniforms={uTime:World.TIME,uMap:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/sky.jpg")},uMask:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/sky-mask.jpg")},uFlare:{type:"f",value:0}};var mesh=new THREE.Mesh(geometry,shader.material);mesh.scale.setScalar(1.005);_this.add(mesh);_layers.push(mesh);_this.events.sub(Mouse.input,Interaction.START,function(){if(_this.isFlareTimeout)return;_this.isFlareTimeout=true;_this.delayedCall(function(){_this.isFlareTimeout=false},700);shader.tween("uFlare",.9,30,"easeOutCubic").onComplete(function(){shader.tween("uFlare",0,500,"easeInOutCubic")})})}function initCity(){var shader=_this.initClass(Shader,"IntroLayer");shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/city.jpg")},uMask:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/city-mask.jpg")}};shader.material.transparent=true;var mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.scale.set(1981.2,485.4,1);mesh.position.set(11.27,-289.6,0);_this.add(mesh);_layers.push(mesh)}function initCharacters(){[{type:"outlander",x:192.2,y:-202.6,speed:.1,scale:.883},{type:"constructor",x:707,y:-120.1,speed:.08,scale:.902},{type:"commando",x:445.5,y:-30.6,speed:.07,scale:.885},{type:"ninja",x:467.9,y:-187.6,speed:.06,scale:.848}].forEach(function(d,i){var character=_this.initClass(IntroCharacter,d,_mouse,i);_layers.push(character.group)})}function initFog(){var shader=_this.initClass(Shader,"Fog");shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/fog.jpg")},uColor:{type:"c",value:new THREE.Color("#b1ac8b")}};shader.material.transparent=true;var mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.scale.set(202e1,608,1);mesh.position.set(0,-364,5.9);_this.add(mesh);_layers.push(mesh)}function initWall(){var shader=_this.initClass(Shader,"IntroLayer");shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/wall.jpg")},uMask:{type:"t",value:Utils3D.getTexture("assets/images/intro/layers/wall-mask.jpg")}};shader.material.transparent=true;var mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.scale.set(2549.2,344.6,1);mesh.position.set(-91.2,-462.5,5);_this.add(mesh);_layers.push(mesh)}function initHands(){var hands=_this.initClass(IntroHands,_mouse);_layers.push(hands.group)}function wrapLayers(){_layers.forEach(function(layer,i){var g1=new THREE.Group;var g2=new THREE.Group;g2.add(layer);g1.add(g2);_this.add(g1);g1.inner=g2;_layers[i]=g1})}function loop(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;if(r1===0)r1=1;var r2=192e1/108e1;_mouse.x=Mouse.tilt.x*(192e1*(r1/r2)*.5);_mouse.y=-Mouse.tilt.y*(108e1*.5);_mouseEase.x+=(-Mouse.tilt.x-_mouseEase.x)*.2*.5;_mouseEase.y+=(Mouse.tilt.y-_mouseEase.y)*.1*.5;_layers.forEach(function(layer,i){layer.position.x+=(_mouseEase.x*((i+1)*5)-layer.position.x)*.1;layer.position.y+=(_mouseEase.y*((i+1)*1)-layer.position.y)*.1;layer.position.z=i*1;layer.inner.position.y=_anim.transition*(i+1)*100})}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=192e1/108e1;if(r1>r2){_this.group.scale.setScalar(_height/108e1*(r1/r2))}else{_this.group.scale.setScalar(_height/108e1)}}this.scrollIn=function(dir){_this.group.visible=true;tween(_anim,{transition:0},14e2,"easeOutQuart");_this.delayedCall(function(){_layers.forEach(function(layer){layer.visible=true})},500)};this.scrollOut=function(dir){tween(_anim,{transition:1},11e2,"easeInOutCubic").onComplete(function(){_this.group.visible=false});_this.delayedCall(function(){_layers.forEach(function(layer){layer.visible=false})},500)}});Class(function IntroView(){Inherit(this,Element);var _this=this;var $this=this.element;var $background=void 0,$wrapper=void 0,$center=void 0,$titleLine1=void 0,$titleLine2=void 0,$text=void 0;var _prompt=void 0;var $bottomLeft=void 0,$videoPrompt1=void 0,$videoPrompt2=void 0;var _words=[];var _mouse,_mouse2;var _animate={v:0};var _copy={title:Copy.messages["epic.fortnite.at.explore.home.title"].toUpperCase(),sub:Copy.messages["epic.fortnite.at.explore.home.sub"].toUpperCase(),gameplay:Copy.messages["epic.fortnite.at.explore.home.gameplay"],gameplayLink:Copy.messages["epic.fortnite.at.explore.home.gameplayLink"],cinematic:Copy.messages["epic.fortnite.at.explore.home.cinematic"],cinematicLink:Copy.messages["epic.fortnite.at.explore.home.cinematicLink"],cta:Copy.messages["epic.fortnite.at.explore.home.cta"],date1:Copy.messages["epic.fortnite.at.explore.home.copy"],date2:Copy.messages["epic.fortnite.at.explore.home.preOrderCopy"]};(function(){loadImages()}());function loadImages(){var assets=Assets.list().filter(["assets/images/common/ui/arrow-right.png","assets/images/intro/blur.jpg","assets/images/common/ui/pink-gradient.jpg"]);_this.initClass(AssetLoader,assets,init)}function init(){initElements();style();addHandlers();_this.delayedCall(animateIn,200);_this.isLoaded=true}function initElements(){$background=$this.create("background-blur");$wrapper=$this.create(".wrapper");$wrapper.size("100%").invisible();$center=$wrapper.create("Center");$titleLine1=$center.create("TitleLine1");$titleLine1.html(_copy.title.toUpperCase());var words=SplitTextfield.split($titleLine1,"word");_words=_words.concat(words);$titleLine2=$center.create("TitleLine2");$titleLine2.html(_copy.sub.toUpperCase());words=SplitTextfield.split($titleLine2,"word");_words=_words.concat(words);var label=Config.CTA_LABEL?Copy.messages[Config.CTA_LABEL]:_copy.cta;_prompt=_this.initClass(UIWarpPrompt,label.toUpperCase(),Tests.introPromptSize(),100,false,[$center]);_words.push(_prompt.inner);$bottomLeft=$wrapper.create("BottomLeft");if(_copy.gameplayLink.length){$videoPrompt1=newVideoButton();$videoPrompt1.text.html(_copy.gameplay.toUpperCase());_words.push($videoPrompt1)}if(_copy.cinematicLink.length){$videoPrompt2=newVideoButton();$videoPrompt2.text.html(_copy.cinematic.toUpperCase());_words.push($videoPrompt2)}if(_copy.date1.length||_copy.date2.length){var copy=_copy.date1.length?_copy.date1+"<br />":"";copy+=_copy.date2;$text=$bottomLeft.create("Text");$text.html(copy);_words.push($text)}}function newVideoButton(){var $el=$bottomLeft.create("VideoButton");$el.text=$el.create("Text");$el.button=$el.create("Button");$el.size(200,50);$el.text.css({fontFamily:"OpenSans",fontWeight:"500",fontSize:11,left:52,letterSpacing:"0.07em",lineHeight:40,whiteSpace:"nowrap"});$el.button.css({backgroundColor:"#fff",backgroundRepeat:"no-repeat",backgroundSize:"14px 14px",backgroundPosition:"center center",padding:20,borderRadius:1e3});$el.button.bg("assets/images/common/ui/arrow-right.png");return $el}function style(){$this.size("100%");$background.size("100%").bg("assets/images/intro/blur.jpg","cover");$center.css({left:"7%",top:"50%"});$titleLine1.css({fontSize:Tests.introLine1Size(),top:-180-Tests.introTitleSpace(),whiteSpace:"nowrap",lineHeight:"1em"});$titleLine2.css({fontSize:Tests.introLine2Size(),top:-90,whiteSpace:"nowrap",lineHeight:"1em"});if(_prompt)_prompt.element.css({left:0,top:120,margin:0});$bottomLeft.css({top:"50%",marginTop:95,marginLeft:280,left:"7%"});if($videoPrompt2){$bottomLeft.css({top:"50%",marginTop:175,marginLeft:0,left:"7%"});$videoPrompt2.css({left:Tests.cinematicTrailerSpace()})}if($text){$text.size(600,200).css({fontFamily:"OpenSans",fontSize:16,lineHeight:"1.7em",marginTop:60})}}function animateIn(){$wrapper.visible();for(var i=0;i<_words.length;i++){_words[i].transform({y:40,rotation:Math.random(-5,5,3)}).css({opacity:0}).tween({y:0,rotation:0,opacity:1,math:true},900,"easeOutBack",i*60)}_prompt.animateIn()}function loop(){_mouse.lerp(Mouse.tilt,.1);_mouse2.lerp(_mouse,.1);$wrapper.x=35*_animate.v-_mouse2.x*35*$center.scale*_animate.v;$wrapper.y=-_mouse2.y*6*$center.scale*_animate.v;$wrapper.transform();if(_prompt){_prompt.element.x=$wrapper.x*.4;_prompt.element.y=$wrapper.y*.4;_prompt.element.transform()}if($text&&!$videoPrompt2){$text.x=$wrapper.x*.3;$text.y=$wrapper.y*.4;$text.transform()}}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();if(_prompt)_this.events.sub(_prompt,Events.CLICK,preOrder);if($videoPrompt1)$videoPrompt1.interact(hover,gameplayTrailer);if($videoPrompt2)$videoPrompt2.interact(hover,cinematicTrailer)}function hover(e){switch(e.action){case"over":e.object.text.tween({opacity:.7},200,"easeOutCubic");e.object.button.tween({scale:1.15,y:0},300,"easeOutBack");break;case"out":e.object.text.tween({opacity:1},400,"easeOutCubic");e.object.button.tween({scale:1},400,"easeOutCubic");break}}function resize(){if(Global.PAUSED)return;var s=Math.map(Stage.width,800,192e1,.6,1,true)*.8;$center.scale=s;$center.transform({scale:s});$bottomLeft.css({marginTop:140*s,marginLeft:(Tests.introPromptSize()+50)*s});if($videoPrompt2){$bottomLeft.css({marginTop:270*s,marginLeft:0})}else if($text){$text.css({marginTop:125*s,marginLeft:(Tests.introPromptSize()+50)*-s})}}function preOrder(){if(Config.PREORDER_CTA)Config.PREORDER_CTA();Tracking.event(Tracking.preOrder)}function gameplayTrailer(){VideoOverlay.instance().animateIn(_copy.gameplayLink);Tracking.event(Tracking.gameplayTrailer)}function cinematicTrailer(){VideoOverlay.instance().animateIn(_copy.cinematicLink);Tracking.event(Tracking.cinematicTrailer)}this.loaded=function(){_this.wait(_this,"isLoaded").then(function(){$background.tween({opacity:0},2e3,"easeInOutSine",500).onComplete(function(){$background.remove();_mouse=new THREE.Vector2(Mouse.tilt.x,Mouse.tilt.y);_mouse2=new THREE.Vector2(Mouse.tilt.x,Mouse.tilt.y);_animate.v=0;tween(_animate,{v:1},25e2,"easeInOutSine");_this.startRender(loop)})})};this.scrollIn=function(){_this.startRender(loop);$this.show();for(var i=0;i<_words.length;i++){_words[i].clearTween().transform({y:50,rotation:Math.random(-5,5,3)}).css({opacity:0});_words[i].tween({y:0,rotation:0,opacity:1},15e2,"easeOutElastic",i*30+700)}_prompt.animateIn()};this.scrollOut=function(){$this.tween({opacity:0,y:-10},100,"easeOutSine",function(){_this.stopRender(loop);$this.hide().clearAlpha().clearTransform()});_prompt.animateOut()}});Class(function TeamBackground(){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_mesh=void 0,_points=void 0;(function(){initBackground();initGeometry();initMesh();initPoints();_this.group.rotation.reorder("YXZ");_this.startRender(loop)}());function initBackground(){_this.initClass(Background,{uBaseColor:"#52487b",uDiffuse:.03,uDOF:.9500000000000001,uColor1:"#f1edf5",uStrength1:1,uOpacity1:1,uFalloff1:1,uPosition1_x:-.6000000000000001,uPosition1_y:.5,uPosition1_z:-1,uColor2:"#f1edf5",uStrength2:1,uOpacity2:.52,uFalloff2:2.3000000000000003,uPosition2_x:-.6000000000000001,uPosition2_y:-.1,uPosition2_z:-.4,uColor3:"#fd6cda",uStrength3:1,uOpacity3:.38,uFalloff3:1.85,uPosition3_x:0,uPosition3_y:-1,uPosition3_z:0,uColor4:"#faac67",uStrength4:5,uOpacity4:.07,uFalloff4:.9,uPosition4_x:1,uPosition4_y:.30000000000000004,uPosition4_z:-1})}function initGeometry(){_geometry=new THREE.IcosahedronBufferGeometry(15,3)}function initMesh(){var shader=new THREE.MeshBasicMaterial({color:"#bdb7cd",opacity:.2,wireframe:true,transparent:true,depthTest:false,depthWrite:false});_mesh=new THREE.Mesh(_geometry,shader);_this.add(_mesh)}function initPoints(){var shader=new THREE.PointsMaterial({map:Utils3D.getTexture("assets/images/explore/dot.png"),size:.2,color:"#bdb7cd",opacity:.2,transparent:true,depthTest:false,depthWrite:false});_points=new THREE.Points(_geometry,shader);_this.add(_points)}function loop(t,delta){_this.group.rotation.y+=.001*(delta/16);_this.group.rotation.x+=.00039*(delta/16)}this.zoomIn=function(){}});Class(function TeamCanvasTexture(_fontSizeOverride){Inherit(this,Component);var _this=this;var _context=void 0;var _s=1;var _fontSize=(_fontSizeOverride||300)*_s;(function(){initCanvas()}());function initCanvas(){_this.canvas=document.createElement("canvas");_this.canvas.width=2048*_s;_this.canvas.height=1024*_s;_context=_this.canvas.getContext("2d");_context.font=_fontSize+"px BurbankBigCondensed-Black";_context.textAlign="center";_context.textBaseline="middle";_this.texture=new THREE.Texture(_this.canvas)}this.change=function(text){_context.clearRect(0,0,2048*_s,1024*_s);_context.fillStyle="#444";_context.font=_fontSize+"px BurbankBigCondensed-Black";_context.fillText(text,1024*_s,512*_s);_this.texture.needsUpdate=true}});Class(function TeamCharacter(_params,_mouse){Inherit(this,Object3D);var _this=this;(function(){if(_params.type=="ninja"){initNinja();return}initCharacter()}());function initNinja(){var geometry=Utils3D.loadSkinnedGeometry("geometry/characters/ninja-rig");var shader=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/team/heroes/ninja/texture.png"),transparent:true,skinning:true});var mesh=new THREE.SkinnedMesh(geometry,shader);mesh.position.x=_params.x;mesh.position.y=_params.y;mesh.rotation.z=Math.radians(_params.rotation);mesh.scale.setScalar(1.23);_this.add(mesh);var mixer=new THREE.AnimationMixer(mesh);var animation=Assets.JSON["geometry/characters/ninja-anim"].animation;var clip=THREE.AnimationClip.parseAnimation(animation,geometry.bones);var action=mixer.clipAction(clip);action.play();_this.startRender(function(t,delta){if(!_this.parent.group.visible)return;mixer.update(.06*delta/16)})}function initCharacter(){var geometry=new THREE.PlaneBufferGeometry(_params.width,_params.height);var shader=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+".png"),transparent:true});var mesh=new THREE.Mesh(geometry,shader);mesh.position.x=_params.x;mesh.position.y=_params.y;mesh.rotation.z=Math.radians(_params.rotation);_this.add(mesh)}});Class(function TeamEnemiesScene(){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0;var _height=1;(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);initMesh();addHandlers()}());function initMesh(){var geometry=World.PLANE;_shader=_this.initClass(Shader,"Enemies");_shader.uniforms={uTime:World.TIME,uMap:{type:"t",value:Utils3D.getTexture("assets/images/team/enemies.jpg")},uMask:{type:"t",value:Utils3D.getTexture("assets/images/team/enemies-mask.jpg")},uWipe:{type:"f",value:0},uAngle:{type:"f",value:0}};_shader.material.transparent=true;_mesh=new THREE.Mesh(geometry,_shader.material);var s=1.04;_mesh.scale.set(1767*s,108e1*s,1);_mesh.position.z=3;_mesh.renderOrder=8;_this.add(_mesh);_this.group.visible=true}function loop(){_this.group.position.x+=(Mouse.tilt.x*.3-_this.group.position.x)*.01;_this.group.position.y+=(Mouse.tilt.y*.1-_this.group.position.y)*.01}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize()}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=1767/108e1;if(r1>r2){_this.group.scale.setScalar(_height/108e1*(r1/r2))}else{_this.group.scale.setScalar(_height/108e1)}}this.activate=function(){_this.startRender(loop);_this.group.visible=true;_mesh.position.x=50;tween(_mesh.position,{x:0},15e2,"easeOutCubic");_shader.set("uAngle",.3);_shader.tween("uWipe",1,1e3,"easeOutCubic")};this.deactivate=function(){_this.stopRender(loop);_shader.set("uAngle",-.2);_shader.tween("uWipe",0,800,"easeOutCubic").onComplete(function(){_this.group.visible=false})}});Class(function TeamEnemiesView(_copy){Inherit(this,Element);var _this=this;var $this=this.element;var _info=void 0;(function(){initInfo();style()}());function initInfo(){_info=_this.initClass(TeamInfoBox,_copy.enemiesText);_info.element.css({bottom:"30%",right:"30%",top:"",left:""})}function style(){$this.css({position:"static"});$this.hide()}this.scrollIn=function(){};this.scrollOut=function(){};this.activate=function(){_this.isActive=true;$this.show();_info.updateHeight();_info.activate()};this.deactivate=function(){_this.isActive=false;$this.hide();_info.deactivate()}});Class(function TeamHeroFocus(_params){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0;(function(){initMesh()}());function initMesh(){var geometry=World.PLANE;_shader=_this.initClass(Shader,"TeamHeroFocus");_shader.uniforms={uResolution:World.RESOLUTION,uMap:{type:"t",value:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+"/texture.jpg")},uNormal:{type:"t",value:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+"/normals.jpg")},uAngle:{type:"f",value:0},uWipe:{type:"f",value:0},uMouse:{type:"v2",value:new THREE.Vector2}};_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.depthTest=false;_mesh=new THREE.Mesh(geometry,_shader.material);_mesh.scale.set(_params.focusSize,_params.focusSize,1);_mesh.position.set(_params.focusPos[0],_params.focusPos[1],_params.focusPos[2]);_mesh.renderOrder=6;_this.add(_mesh);_this.group.visible=false}function loop(){_this.group.position.x+=(Mouse.tilt.x*30-_this.group.position.x)*.01;_this.group.position.y+=(Mouse.tilt.y*25-_this.group.position.y)*.01}this.activate=function(_angle){_this.isActive=true;_shader.uniforms.uMouse.value.copy(Mouse.perc);_shader.set("uAngle",_angle);_shader.set("uWipe",0);_shader.tween("uWipe",1,16e2,"easeOutQuint");var s=.95;_this.group.scale.set(s,s,1);tween(_this.group.scale,{x:1,y:1},4e3,"easeOutCubic");_this.group.visible=true;_this.startRender(loop)};this.deactivate=function(_angle){if(!_this.isActive)return;_this.isActive=false;_shader.uniforms.uMouse.value.copy(Mouse.perc);_shader.set("uAngle",_angle);_shader.tween("uWipe",0,500,"easeOutQuint");var s=.5;tween(_this.group.scale,{x:s,y:s},500,"easeInBack").onComplete(function(){_this.group.visible=false;_this.stopRender(loop)})}});Class(function TeamHeroPair(_params,_index){Inherit(this,Object3D);var _this=this;var _shader=void 0,_mesh=void 0,_glow=void 0;var _opacity={v:0};var _wrapper=new THREE.Group;(function(){initMesh();initGlow();addHandlers();_this.startRender(loop)}());function initMesh(){_shader=_this.initClass(Shader,"TeamHeroPair");_shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+"/texture.jpg")},uNormal:{type:"t",value:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+"/normals.jpg")},uColor:{type:"c",value:new THREE.Color("#41334e")},uHover:{type:"f",value:0}};_shader.material.transparent=true;_shader.material.depthWrite=false;_shader.material.depthTest=false;_mesh=new THREE.Mesh(World.PLANE,_shader.material);_mesh.scale.set(_params.size,_params.size,1);_mesh.renderOrder=2;_wrapper.position.set(_params.pos[0],_params.pos[1],_params.pos[2]);_wrapper.add(_mesh);_this.add(_wrapper)}function initGlow(){var material=new THREE.MeshBasicMaterial({map:Utils3D.getTexture("assets/images/team/heroes/"+_params.type+"/glow.jpg"),transparent:true,blending:THREE.AdditiveBlending,opacity:0});_glow=new THREE.Mesh(World.PLANE,material);_glow.scale.set(_params.size*1.25,_params.size*1.25,1);_glow.renderOrder=1;_glow.visible=false;_wrapper.add(_glow)}function loop(t){_glow.material.opacity=.2*_opacity.v+Math.sin(t*.001)*.08*_opacity.v}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_this.events.sub(Team.HOVER_IN,hoverIn);_this.events.sub(Team.HOVER_OUT,hoverOut)}function resize(){var r1=Stage.width/Stage.height;var r2=192e1/108e1;_wrapper.position.x=_params.pos[0]*(r1/r2)}function hoverIn(e){if(e.index===_index){_glow.visible=true;tween(_opacity,{v:1},1e3,"easeOutSine")}else{_shader.tween("uHover",.7,1e3,"easeOutQuint")}}function hoverOut(e){tween(_opacity,{v:0},800,"easeOutQuint").onComplete(function(){_glow.visible=false});_shader.tween("uHover",0,1e3,"easeOutQuint")}});Class(function TeamHeroPrompt(_copy,_index){Inherit(this,Element);var _this=this;var $this=this.element;var $text=void 0,$glow=void 0;(function(){initHTML();style();addHandlers()}());function initHTML(){$glow=$this.create("Glow");$text=$this.create("Text")}function style(){$this.size("25%","70%").css({top:"30%",left:_index*25+"%"});$glow.center().css({top:"65%",boxShadow:"0px 0px 120px 70px rgba(216, 104, 214, 0.3)"});$text.html(_copy["hero"+(_index+1)+"Title"].toUpperCase());$text.size("100%",30).css({left:0,top:"60%",textAlign:"center",fontSize:40,letterSpacing:"0.03em"});$text.transform({scale:.9});$glow.css({opacity:0})}function addHandlers(){$this.hover(hover);$this.interact(null,click);_this.events.sub(Team.HOVER_IN,hoverIn);_this.events.sub(Team.HOVER_OUT,hoverOut)}function hoverIn(e){if(_index!==e.index){$text.tween({scale:.9,y:0,opacity:.2},1e3,"easeOutExpo");$glow.tween({opacity:.5},500,"easeOutCubic")}else{$text.tween({scale:1,y:-10,opacity:1},500,"easeOutQuint");$glow.tween({opacity:1},500,"easeOutCubic")}}function hoverOut(){$text.tween({scale:.9,y:0,opacity:1},1e3,"easeOutExpo");$glow.tween({opacity:0},1e3,"easeOutCubic")}function hover(e){if(e.action=="over"){_this.events.fire(Team.HOVER_IN,{index:_index})}else{_this.events.fire(Team.HOVER_OUT,{index:_index})}}function click(){_this.events.fire(Events.CLICK,{index:_index},true)}this.activate=function(){$this.show();$this.css({opacity:0}).transform({y:20,rotation:Math.random(-5,5,3)}).tween({y:0,opacity:1,rotation:0},12e2,"easeOutElastic",200+_index*100)};this.deactivate=function(){$this.tween({y:10,opacity:0},300,"easeOutCubic").onComplete(function(){$this.hide()})}});Class(function TeamHeroesScene(_copy){Inherit(this,Object3D);var _this=this;var _floor=void 0,_text=void 0,_focusBack=void 0,_focusBackShader=void 0,_focusText=void 0,_focusTextShader=void 0;var _focus=[];var _pairs=[];var _mouse=new THREE.Vector2;var _mouseEase=new THREE.Vector2;var _height=1;var _colors=[["#da845f","#d4c2a2"],["#6c879e","#a0c6d8"],["#6ca3a6","#c1e9e6"],["#e1a79b","#da7997"]];var _data=[{type:"outlander",size:1050.4,pos:[-669.8,-249.5,1],textScale:1,focusSize:16e2,focusPos:[-280.23,-419.7,0]},{type:"soldier",size:1150.76,pos:[-252.4,-100.99,0],textScale:1.3,focusSize:16e2,focusPos:[280.9,-100,0]},{type:"ninja",size:1050.7,pos:[220.96,-229.4,2],textScale:1.4,focusSize:16e2,focusPos:[-300.4,-443.6,0]},{type:"constructor",size:993.37,pos:[739.05,-244.6,3],textScale:1,focusSize:15e2,focusPos:[200.09,-402.7,0]}];(function(){var dist=World.CAMERA.position.length();var fov=World.CAMERA.fov;_height=2*dist*Math.tan(Math.radians(fov)*.5);initText();initFocusBackground();initFocusText();initFloor();initPairs();addHandlers()}());function initText(){var fontSize=Tests.teamUpFontSize();var title=_this.initClass(TeamCanvasTexture,fontSize);_this.delayedCall(function(){title.change(_copy.title.toUpperCase())},500);var shader=new THREE.MeshBasicMaterial({transparent:true,map:title.texture,opacity:.25,blending:THREE.AdditiveBlending});_text=new THREE.Mesh(World.PLANE,shader);_text.title=title;var s=Tests.teamUpSize();_text.scale.set(2e3*s,1e3*s,1);_text.position.y=270;_this.add(_text)}function initFocusBackground(){var geometry=new THREE.PlaneBufferGeometry(2,2);_focusBackShader=_this.initClass(Shader,"FocusBackground");_focusBackShader.uniforms={uResolution:World.RESOLUTION,uTime:World.TIME,uColor1:{type:"c",value:new THREE.Color("#e63a23")},uColor2:{type:"c",value:new THREE.Color("#e63a23")},uSwapColor:{type:"f",value:0},uAngle:{type:"f",value:0},uWipe:{type:"f",value:0},uMouse:{type:"v2",value:new THREE.Vector2}};_focusBackShader.material.transparent=true;_focusBackShader.material.depthWrite=false;_focusBack=new THREE.Mesh(geometry,_focusBackShader.material);_focusBack.renderOrder=4;_focusBack.visible=false;_this.add(_focusBack)}function initFocusText(){var title=_this.initClass(TeamCanvasTexture);_focusTextShader=new THREE.MeshBasicMaterial({transparent:true,map:title.texture,depthWrite:false,depthTest:true,blending:THREE.AdditiveBlending,opacity:0});_focusText=new THREE.Mesh(World.PLANE,_focusTextShader);_focusText.title=title;var s=1;_focusText.scale.set(2e3*s,1e3*s,1);_focusText.position.x=0;_focusText.position.y=220;_focusText.position.z=3;_focusText.renderOrder=5;_focusText.visible=false;_this.add(_focusText)}function initFloor(){var geometry=World.PLANE;var shader=new THREE.MeshBasicMaterial({color:"#222",transparent:true,depthWrite:false,depthTest:true,blending:THREE.AdditiveBlending});_floor=new THREE.Mesh(geometry,shader);_floor.scale.setScalar(25e2);_floor.rotation.reorder("XYZ");_floor.rotation.x=-Math.PI/2-.2;_floor.rotation.z=.5;_floor.position.set(0,-450,-100);_floor.renderOrder=1;_floor.frustumCulled=false}function initPairs(){_data.forEach(function(d,i){var pair=_this.initClass(TeamHeroPair,d,i);_pairs.push(pair);var focus=_this.initClass(TeamHeroFocus,d,i);_focus.push(focus)})}function loop(){if(!_this.parent.isActive)return;_mouse.lerp(Mouse.tilt,.1);_mouseEase.lerp(_mouse,.1);for(var i=0;i<_pairs.length;i++){var x=10+i*3;_pairs[i].group.position.x=_mouseEase.x*x;_pairs[i].group.position.y=_mouseEase.y*.1}_text.position.x=_text.positionX+_mouseEase.x*5}function addHandlers(){_this.events.sub(Events.RESIZE,resize);resize();_this.events.sub(Team.ACTIVATE_INFO,activateInfo);_this.events.sub(Team.DEACTIVATE_INFO,deactivateInfo)}function resize(){if(Global.PAUSED)return;var r1=Stage.width/Stage.height;var r2=192e1/108e1;_this.group.scale.setScalar(_height/108e1);_text.positionX=-100*(r1/r2)}function activateInfo(e){_focusBackShader.uniforms.uColor1.value.set(_colors[e.index][0]);_focusBackShader.uniforms.uColor2.value.set(_colors[e.index][1]);_focusBackShader.uniforms.uMouse.value.copy(Mouse.perc);_focusBackShader.set("uAngle",Math.random(.3,.5,2));_focusBackShader.set("uWipe",0);_focusBackShader.tween("uWipe",1.2,16e2,"easeOutQuint");_focusBack.visible=true;_focusText.title.change(_copy["hero"+(e.index+1)+"Title"].toUpperCase());var s=_data[e.index].textScale;_focusText.scale.set(2e3*s*.9,1e3*s*.9,1);tween(_focusText.scale,{x:2e3*s,y:1e3*s,z:1},6e3,"easeOutBack",200);_focusText.position.y=280-50*s;_focusText.position.x=-_data[e.index].focusPos[0]*.5*s;_focusText.visible=true;_focusTextShader.opacity=0;tween(_focusTextShader,{opacity:1},4e3,"easeOutCubic",200);_focus[e.index].activate(_focusBackShader.uniforms.uAngle.value)}function deactivateInfo(){tween(_focusTextShader,{opacity:0},300,"easeOutCubic").onComplete(function(){_focusText.visible=false});_focusBackShader.uniforms.uMouse.value.copy(Mouse.perc);_focusBackShader.set("uAngle",Math.random(-.5,-.3,2));_focusBackShader.tween("uWipe",0,500,"easeOutQuint").onComplete(function(){_focusBack.visible=false});_focus.forEach(function(focus){focus.deactivate(_focusBackShader.uniforms.uAngle.value)})}this.activate=function(){_this.startRender(loop);_this.group.visible=true;_text.title.change(_copy.title.toUpperCase());tween(_this.group.position,{x:0},1e3,"easeOutCubic")};this.deactivate=function(){tween(_this.group.position,{x:-1},800,"easeOutCubic").onComplete(function(){_this.group.visible=false;_this.stopRender(loop)})}});Class(function TeamHeroesView(_copy){Inherit(this,Element);var _this=this;var $this=this.element;var _prompts=[];var _infoViews=[];var _currentIndex=0;(function(){initViews();style();addHandlers();_this.canFocus=true}());function initViews(){for(var i=0;i<4;i++){var prompt=_this.initClass(TeamHeroPrompt,_copy,i);_prompts.push(prompt);var infoView=_this.initClass(TeamInfoBox,_copy["hero"+(i+1)+"Text"],i);_infoViews.push(infoView)}}function style(){$this.css({position:"static"})}function addHandlers(){_prompts.forEach(function(prompt){_this.events.sub(prompt,Events.CLICK,click)});_this.events.sub(Team.ACTIVATE_INFO,activateInfo);_this.events.sub(Team.DEACTIVATE_INFO,deactivateInfo)}function click(e){if(!_this.canFocus)return;_this.events.fire(Team.ACTIVATE_INFO,{index:e.index});_currentIndex=e.index;Tracking.event(Tracking.focus,e.index)}function activateInfo(e){_this.canFocus=false;_this.isInfoView=true;_infoViews[e.index].updateHeight();_infoViews[e.index].activate();_prompts.forEach(function(prompt){return prompt.deactivate()});_this.events.fire(FortniteEvents.PAUSE_SCROLL);_this.events.sub(FortniteEvents.SCROLL_INTENT,scrollIntent);_this.events.sub(Mouse.input,Interaction.CLICK,closeClick)}function deactivateInfo(){_this.delayedCall(function(){_this.canFocus=true},500);_this.isInfoView=false;_prompts.forEach(function(prompt){return prompt.activate()});_infoViews.forEach(function(info){return info.deactivate()});Tracking.event(Tracking.defocus,_currentIndex)}function scrollIntent(){_this.events.unsub(FortniteEvents.SCROLL_INTENT,scrollIntent);_this.events.unsub(Mouse.input,Interaction.CLICK,closeClick);_this.events.fire(Team.DEACTIVATE_INFO);_this.delayedCall(function(){_this.events.fire(FortniteEvents.RESUME_SCROLL)},700)}function closeClick(){_this.events.unsub(FortniteEvents.SCROLL_INTENT,scrollIntent);_this.events.unsub(Mouse.input,Interaction.CLICK,closeClick);_this.events.fire(Team.DEACTIVATE_INFO);_this.events.fire(FortniteEvents.RESUME_SCROLL)}this.scrollIn=function(){_infoViews.forEach(function(info){return info.updateHeight()})};this.scrollOut=function(){};this.activate=function(){$this.show().css({opacity:0}).tween({opacity:1},300,"easeOutSine");_prompts.forEach(function(prompt){return prompt.activate()})};this.deactivate=function(){$this.tween({opacity:0},300,"easeOutSine",function(){$this.hide()});_prompts.forEach(function(prompt){return prompt.deactivate()})}});Class(function TeamInfoBox(_text,_index){Inherit(this,Element);var _this=this;var $this=this.element;var $bg=void 0,$text=void 0;(function(){initHTML();style();_this.startRender(loop)}());function initHTML(){$bg=$this.create("Background");$text=$this.create("Text")}function style(){$this.css({left:"30%",top:"60%"});if(_index==0||_index==2){$this.css({left:"",right:"30%"})}$bg.size(330,200).css({background:"#0f0d2f",margin:-40,marginLeft:-165,opacity:isNaN(_index)?.5:.2});$bg.warp=_this.initClass(Warp,$bg);$bg.warp.render();$bg.warp.bl.yTarget=$bg.warp.bl.y;$bg.warp.br.yTarget=$bg.warp.br.y;$text.html(_text);$text.css({width:250,marginLeft:-125,height:"auto",fontFamily:"OpenSans",fontSize:14,color:"#fff",lineHeight:"1.6em"});$this.css({opacity:0})}function updateHeight(){var h=$text.div.clientHeight+80;$bg.warp.bl.y=$bg.warp.bl.yTarget=h;$bg.warp.br.y=$bg.warp.br.yTarget=h}function loop(t){if(!_this.isActive)return;var s=.1;$bg.warp.tl.x=(Math.sin(t*.01*s)-1)*5;$bg.warp.tl.y=(Math.sin(t*.007*s)+1)*5;$bg.warp.tr.x=(Math.sin(t*.0046*s)-1)*7+330;$bg.warp.tr.y=(Math.sin(t*.01*s)+1)*5;$bg.warp.bl.x=(Math.sin(t*.0085*s)-1)*7;$bg.warp.br.x=(Math.sin(t*.0055*s)-1)*6+330;$bg.warp.bl.y+=($bg.warp.bl.yTarget+(Math.sin(t*.012*s)-1)*6-$bg.warp.bl.y)*.1;$bg.warp.br.y+=($bg.warp.br.yTarget+(Math.sin(t*.003*s)-1)*5-$bg.warp.br.y)*.16;$bg.warp.render()}this.activate=function(){if(_this.isActive)return;$this.show();$this.transform({scaleX:.8,scaleY:.8}).tween({opacity:1,scaleX:1,scaleY:1},12e2,"easeOutElastic",200);$text.transform({y:10}).css({opacity:0}).tween({y:0,opacity:1},800,"easeOutCubic",800);_this.isActive=true};this.deactivate=function(){if(!_this.isActive)return;$this.tween({opacity:0,scalex:.8,scaleY:.8},300,"easeOutCubic").onComplete(function(){$this.hide()});_this.isActive=false};this.updateHeight=function(){$this.show();_this.delayedCall(function(){updateHeight();if(!_this.isActive)$this.hide()},200)}});Class(function TeamScene(_copy){Inherit(this,Object3D);var _this=this;var _enemies=void 0,_heroes=void 0;(function(){initBackground();initViews();addHandlers()}());function initBackground(){_this.initClass(TeamBackground)}function initViews(){_enemies=_this.initClass(TeamEnemiesScene);_heroes=_this.initClass(TeamHeroesScene,_copy)}function addHandlers(){_this.events.sub(Team.HEROES,toHeroes);_this.events.sub(Team.ENEMIES,toEnemies)}function toHeroes(){_heroes.activate();_enemies.deactivate()}function toEnemies(){_enemies.activate();_heroes.deactivate()}this.scrollIn=function(dir){_this.isActive=true;_this.group.position.y=-dir*2;_this.delayedCall(function(){tween(_this.group.position,{y:0},1e3,"easeOutQuint");World.SCENE.add(_this.group)},dir>0?800*.207:0)};this.scrollOut=function(dir){tween(_this.group.position,{y:dir*2},1e3,"easeOutQuint");_this.delayedCall(function(){_this.isActive=false;World.SCENE.remove(_this.group)},dir<0?800*.207:500)}});Class(function TeamView(_copy,_scene){Inherit(this,Element);var _this=this;var $this=this.element;var $toggleCont=void 0,$close=void 0;var _heroes=void 0,_enemies=void 0,_heroPrompt=void 0,_enemyPrompt=void 0;var _mouse=new THREE.Vector2;this.mode="";(function(){initToggles();initHeroes();initEnemies();initClose();style();addHandlers()}());function initToggles(){$toggleCont=$this.create("ToggleContainer");_heroPrompt=_this.initClass(UIWarpPrompt,_copy.heroes.toUpperCase(),250,70,false,[$toggleCont]);_enemyPrompt=_this.initClass(UIWarpPrompt,_copy.enemies.toUpperCase(),250,70,false,[$toggleCont])}function initHeroes(){_heroes=_this.initClass(TeamHeroesView,_copy)}function initEnemies(){_enemies=_this.initClass(TeamEnemiesView,_copy)}function style(){$this.css({position:"static"});$this.hide();$toggleCont.css({top:"15%",left:"15%"});_enemyPrompt.element.css({marginLeft:120})}function initClose(){var size=80;$close=$this.create(".close");$close.size(size,size);$close.css({right:"5%",top:"5%"});$close.inner=$close.create(".close");$close.inner.fontStyle("BurbankBigCondensed-Black",size,"#fff");$close.inner.size(size,size).center().css({opacity:0,lineHeight:size,textAlign:"center"}).transform({scale:.8});$close.inner.text("x")}function addHandlers(){_this.events.sub(_heroPrompt,Events.CLICK,heroClick);_this.events.sub(_enemyPrompt,Events.CLICK,enemyClick);_this.events.sub(Team.HEROES,toHeroes);_this.events.sub(Team.ENEMIES,toEnemies);_this.events.sub(Team.ACTIVATE_INFO,activateInfo);_this.events.sub(Team.DEACTIVATE_INFO,deactivateInfo)}function heroClick(){if(_this.mode=="heroes")return;_this.events.fire(Team.HEROES);Tracking.event(Tracking.heroes)}function enemyClick(){if(_this.mode=="enemies")return;_this.events.fire(Team.ENEMIES);Tracking.event(Tracking.enemies)}function toHeroes(){_this.mode="heroes";_heroPrompt.element.back.bg("assets/images/common/ui/pink-gradient.jpg");_heroPrompt.element.text.css({color:"#fff"});_enemyPrompt.element.back.css({background:"#fff"});_enemyPrompt.element.text.css({color:"#d166ce"});_heroPrompt.element.tween({scale:1},1e3,"easeOutElastic");_enemyPrompt.element.tween({scale:.8},1e3,"easeOutElastic");_heroPrompt.active=true;_enemyPrompt.active=false;_enemyPrompt.hoverOut();_heroes.activate();_enemies.deactivate();_heroes.activate()}function toEnemies(){_this.mode="enemies";_enemyPrompt.element.back.bg("assets/images/common/ui/pink-gradient.jpg");_enemyPrompt.element.text.css({color:"#fff"});_heroPrompt.element.back.css({background:"#fff"});_heroPrompt.element.text.css({color:"#d166ce"});_enemyPrompt.element.tween({scale:1},1e3,"easeOutElastic");_heroPrompt.element.tween({scale:.8},1e3,"easeOutElastic");_heroPrompt.active=false;_enemyPrompt.active=true;_heroPrompt.hoverOut();_enemies.activate();_heroes.deactivate()}function activateInfo(){_heroPrompt.element.tween({opacity:0},200,"easeOutSine",function(){_heroPrompt.element.hide()});_enemyPrompt.element.tween({opacity:0},200,"easeOutSine",function(){_enemyPrompt.element.hide()});$close.inner.tween({scale:1,opacity:.9},1e3,"easeOutElastic",500)}function deactivateInfo(){_heroPrompt.element.show().css({opacity:0}).tween({opacity:1},300,"easeOutSine");_enemyPrompt.element.show().css({opacity:0}).tween({opacity:1},300,"easeOutSine");$close.inner.clearTween().tween({scale:.8,opacity:0},500,"easeOutCubic",function(){})}this.scrollIn=function(dir){_this.delayedCall(function(){$this.show();$this.tween({opacity:1},500,"easeOutSine",300);_heroPrompt.animateIn();_enemyPrompt.animateIn();_heroes.scrollIn()},dir>0?800*.207:0)};this.scrollOut=function(dir){_heroPrompt.animateOut();_enemyPrompt.animateOut();$this.tween({opacity:0},dir<0?200:400,"easeOutSine").onComplete(function(){$this.hide()});_this.delayedCall(function(){_heroes.scrollOut()},dir<0?800*.207:500)}});Class(function WeaponsBackground(){Inherit(this,Object3D);var _this=this;var _grid=void 0;(function(){initBackground();initGrid()}());function initBackground(){_this.initClass(Background,{uBaseColor:"#123b85",uDiffuse:.04,uDOF:1.9500000000000002,uColor1:"#42639d",uStrength1:1,uOpacity1:.56,uFalloff1:3.3000000000000003,uPosition1_x:-.5,uPosition1_y:-.7000000000000001,uPosition1_z:-.5,uColor2:"#0d57ad",uStrength2:1,uOpacity2:1,uFalloff2:1.55,uPosition2_x:-.2,uPosition2_y:-.2,uPosition2_z:0,uColor3:"#fd9f6c",uStrength3:2.5500000000000003,uOpacity3:.09,uFalloff3:1.1,uPosition3_x:0,uPosition3_y:-1,uPosition3_z:0,uColor4:"#faac67",uStrength4:1.25,uOpacity4:0,uFalloff4:.9,uPosition4_x:1,uPosition4_y:-1,uPosition4_z:1})}function initGrid(){_grid=_this.initClass(WeaponsGrid)}});Class(function WeaponsCircle(_move){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0,_tweenStart=void 0,_tweenEnd=void 0;(function(){initGeometry();initShader();initMesh();addHandlers();_this.startRender(loop)}());function initGeometry(){_geometry=new THREE.PlaneBufferGeometry(1,1);_geometry.rotateX(-Math.PI/2)}function initShader(){_shader=_this.initClass(Shader,"WeaponCircle");_shader.uniforms={uTime:World.TIME,uStart:{value:0},uEnd:{value:0},uAlpha:{value:0},uColor:{value:new THREE.Color("#23468b")}};_shader.material.transparent=true;_shader.material.depthWrite=false;_this.start=_shader.uniforms.uStart;_this.end=_shader.uniforms.uEnd}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.scale.setScalar(7);_mesh.position.set(0,-1.7,0);_mesh.rotation.y=Math.radians(90);_mesh.renderOrder=2;_this.add(_mesh)}function loop(){if(_this.isTransition)return;_this.end.value+=(_move.progress-_this.end.value)*.1}function addHandlers(){_this.events.sub(Weapons.NEXT,next);_this.events.sub(Weapons.PREV,prev)}function next(){if(_tweenStart)_tweenStart.stop();if(_tweenEnd)_tweenEnd.stop();_this.isTransition=true;_tweenStart=tween(_this.start,{value:1},700,"easeInSine").onComplete(function(){_this.isTransition=false;_this.start.value=0;_this.end.value=0});_tweenEnd=tween(_this.end,{value:1},300,"easeOutCubic")}function prev(){if(_tweenStart)_tweenStart.stop();if(_tweenEnd)_tweenEnd.stop();_this.isTransition=true;_tweenEnd=tween(_this.end,{value:0},300,"easeInSine").onComplete(function(){_this.start.value=1;_this.end.value=1;_tweenEnd=tween(_this.end,{value:.75},700,"easeInOutCubic").onComplete(function(){_this.isTransition=false;_this.start.value=0});_tweenStart=tween(_this.start,{value:0},600,"easeInOutCubic")})}this.animateIn=function(){_shader.tween("uAlpha",1,500,"easeOutCubic",1e3)}});Class(function WeaponsGrid(){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0;(function(){initGeometry();initShader();initMesh()}());function initGeometry(){_geometry=new THREE.PlaneBufferGeometry(1,1);_geometry.rotateX(-Math.PI/2)}function initShader(){_shader=_this.initClass(Shader,"Grid");_shader.uniforms={uMap:{value:Utils3D.getRepeatTexture("assets/images/weapons/grid.png")}};_shader.material.transparent=true;_shader.material.depthWrite=false}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader.material);_mesh.scale.setScalar(50);_mesh.position.set(0,-1.7,0);_mesh.renderOrder=1;_this.add(_mesh);_this.group.scale.setScalar(1)}this.spin=function(dir){tween(_mesh.rotation,{y:_mesh.rotation.y-2*dir},12e2,"easeOutSine")}});Class(function WeaponsInteraction(){Inherit(this,Component);var _this=this;var _move={progress:.25,rotation:new THREE.Vector3};(function(){_this.move=_move;addHandlers();_this.startRender(loop)}());function loop(){if(!_this.isActive)return;if(_move.rotation.x>.26)_move.rotation.x+=(.26-_move.rotation.x)*.2}function addHandlers(){_this.events.sub(Weapons.NEXT,next);_this.events.sub(Weapons.PREV,prev);World.ELEMENT.bind("touchstart",forceNext)}function forceNext(){if(Global.PAUSED)return;if(!_this.isActive)return;change(1)}function drag(){if(Global.PAUSED)return;if(!_this.isActive)return;_move.rotation.y+=Mouse.delta.x*.006;if(_this.isTransition)return;_move.progress-=Mouse.delta.x*.006*.4;if(_move.progress>1)change(1);if(_move.progress<0)change(-1)}function end(){if(Global.PAUSED)return;if(!_this.isActive)return;if(_this.isTransition)return;if(Math.abs(Mouse.delta.x)>40){if(Mouse.delta.x<0){change(1)}else{change(-1)}}}function change(dir){if(dir>0){_this.events.fire(Weapons.NEXT,{isSwipe:true})}else{_this.events.fire(Weapons.PREV,{isSwipe:true})}}function next(){pauseInteraction();_move.progress=.25}function prev(){pauseInteraction();_move.progress=.75}function pauseInteraction(){_this.isTransition=true;_this.delayedCall(function(){_this.isTransition=false},500)}this.scrollIn=function(dir){if(!_this.isIntroPlayed){_this.isIntroPlayed=true;_this.delayedCall(_this.scrollIn,34e2);return}_this.isActive=true};this.scrollOut=function(dir){_this.isActive=false}});Class(function WeaponsModel(_params){Inherit(this,Object3D);var _this=this;var _geometry=void 0,_shader=void 0,_mesh=void 0,_shadow=void 0;var _type=_params.type;var _size=_params.size;var _rotation=_params.rotation;_this.title=_params.title;(function(){initShadow()}());function initGeometry(){_geometry=Utils3D.loadBufferGeometry("geometry/weapons/"+_type);_geometry.computeBoundingBox()}function initShader(){var MeshCustomMaterial=Shader.CustomStandardMaterial("Weapon");var envMap=Utils3D.getTexture("assets/images/common/env/11pm.jpg");envMap.mapping=THREE.EquirectangularReflectionMapping;var diffuseMap=Utils3D.getTexture("assets/images/weapons/"+_type+"/diffuse.jpg");var normalMap=Utils3D.getTexture("assets/images/weapons/"+_type+"/normal.jpg");var rmsMap=Utils3D.getTexture("assets/images/weapons/"+_type+"/rms.jpg");_shader=new MeshCustomMaterial({map:diffuseMap,normalMap:normalMap,envMap:envMap,envMapIntensity:1,lights:true,transparent:true});_shader.uniforms.rmsMap={value:rmsMap};_shader.uniforms.uTime=World.TIME;_shader.uniforms.uDotsFade={value:.9};_shader.uniforms.uDotsDir={value:1};_shader.uniforms.uSize={value:_size}}function initMesh(){_mesh=new THREE.Mesh(_geometry,_shader);_mesh.scale.setScalar(.095);_mesh.rotation.y=Math.radians(_rotation);_mesh.renderOrder=5}function initShadow(){var geometry=new THREE.PlaneBufferGeometry(1,1);geometry.rotateX(-Math.PI/2);var shader=_this.initClass(Shader,"WeaponShadow");shader.uniforms={uAlpha:{type:"f",value:0}};shader.material.transparent=true;shader.material.depthWrite=false;_shadow=new THREE.Mesh(geometry,shader.material);_shadow.scale.z=Math.mix(2,(_geometry.boundingBox.max.z-_geometry.boundingBox.min.z)*_mesh.scale.z,.75);_shadow.scale.x=Math.mix(2,(_geometry.boundingBox.max.x-_geometry.boundingBox.min.x)*_mesh.scale.x,.5);_shadow.position.y=-1.7;_shadow.rotation.y=Math.radians(_rotation);_shadow.renderOrder=4;_shadow.shader=shader}this.animateIn=function(dir){_this.add(_mesh);_this.add(_shadow);_shadow.shader.tween("uAlpha",1,1e3,"easeOutCubic",300);_this.add(_mesh);_shader.uniforms.uDotsDir.value=1;tween(_shader.uniforms.uDotsFade,{value:0},22e2,"easeOutCubic",300);_this.group.rotation.y=2*dir;tween(_this.group.rotation,{y:0},13e2,"easeOutQuart",300)};this.animateOut=function(dir){_shadow.shader.tween("uAlpha",0,500,"easeOutCubic").onComplete(function(){_this.remove(_shadow)});_shader.uniforms.uDotsDir.value=-1;tween(_shader.uniforms.uDotsFade,{value:1},1e3,"easeOutCubic").onComplete(function(){_this.remove(_mesh)});tween(_this.group.rotation,{y:-2*dir},500,"easeInCubic")}});Class(function WeaponsNav(){Inherit(this,Element);var _this=this;var $this=this.element;var _items=[];var _current=0;(function(){initItems();style();addHandlers()}());function initItems(){["breacher","bullseye","sword","crusader","spikes"].forEach(function(type,i){var item=_this.initClass(WeaponsNavItem,type,i);_items.push(item)});_items[_current].activate()}function style(){$this.css({top:60,left:"50%"})}function addHandlers(){_this.events.sub(Weapons.NEXT,next);_this.events.sub(Weapons.PREV,prev)}function next(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current+1,5);change(index)}function prev(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current-1,5);change(index)}function change(index){_items[_current].deactivate();_current=index;_items[_current].activate()}this.animateIn=function(){_items.forEach(function(item,i){item.animateIn(i*100)})};this.animateOut=function(){_items.forEach(function(item,i){item.animateOut(i*10)})}});Class(function WeaponsNavItem(_type,_index){Inherit(this,Element);var _this=this;var $this=this.element;var $circle=void 0,$image=void 0,$fill=void 0;var _tweenImage=void 0;var _size=50;(function(){initHTML();style();addHandlers()}());function initHTML(){$circle=$this.create("Circle");$fill=$this.create("fill");$image=$this.create("Image")}function style(){var step=120;$this.css({left:_index*step-4*.5*step});$this.size(_size,_size);$circle.size(_size-20,_size-20).css({top:6,left:6,border:"4px solid #fff",borderRadius:_size});$circle.css({opacity:.5}).transform({scale:.5,y:0});$fill.size(_size-10,_size-10).center().bg("#fff").css({borderRadius:_size});$fill.css({opacity:0}).transform({scale:.4,y:0});$image.size(130,70).center().bg("assets/images/weapons/icons/"+_type+".png","contain").css({backgroundRepeat:"no-repeat"});$image.css({opacity:0});$this.css({opacity:0})}function addHandlers(){$this.interact(hover,click);$this.hit.size(_size*2,_size*2).center()}function hover(e){if(_this.active&&!e.force)return;if(e.action=="over"){hoverIn()}else{hoverOut()}}function hoverIn(){if(_this.active)return;$circle.tween({opacity:1,scale:.8},500,"easeOutBack");if(_tweenImage&&_tweenImage.playing){_tweenImage.stop()}else{$image.transform({scale:.6,rotation:Math.random(-20,20,1)})}_tweenImage=$image.tween({scale:1,opacity:1,rotation:0,spring:2,damping:.6},900,"easeOutElastic")}function hoverOut(){if(_this.active)return;$circle.tween({opacity:.5,scale:.5},500,"easeOutBack");if(_tweenImage&&_tweenImage.playing)_tweenImage.stop();$image.tween({scale:.2,opacity:0,rotation:Math.random(-5,5,1)},300,Math.abs(1-$image.css("opacity"))>.1?"easeOutCubic":"easeInBack")}function click(){_this.events.fire(Weapons.CHANGE,{index:_index});Tracking.event(Tracking.weaponNav,_index)}this.activate=function(){if(_this.active)return;_this.active=true;$image.tween({scale:1,opacity:1,rotation:0,spring:2,damping:.6},700,"easeOutElastic");$fill.tween({opacity:1,scale:1},300,"easeOutBack")};this.deactivate=function(){if(!_this.active)return;_this.active=false;$circle.tween({opacity:.5,scale:.5},500,"easeOutBack");$image.tween({scale:.1,opacity:0,rotation:Math.random(-5,5,1)},300,"easeInBack");$fill.tween({opacity:0,scale:.4},500,"easeInBack")};this.animateIn=function(delay){$this.tween({opacity:1},500,"easeOutCubic",delay)};this.animateOut=function(delay){$this.tween({opacity:0},300,"easeOutCubic",delay)}});Class(function WeaponsRender(_data){Inherit(this,Object3D);var _this=this;var _shader,_shadow,_mesh;(function(){initMesh();initShadow()}());function initMesh(){_shader=WeaponsRender.getShader();_shader.set("uMap",Utils3D.getTexture("assets/images/weapons/renders/"+_data.type+".jpg"));_shader.set("uNormal",Utils3D.getTexture("assets/images/weapons/renders/"+_data.type+"-normals.jpg"));_shader.uniforms.uTime=World.TIME;_shader.uniforms.uMouse.value=new THREE.Vector2;_shader.uniforms.uDotsFade.value=.9;_shader.uniforms.uDotsDir.value=1;_shader.material.transparent=true;_this.group.visible=false;var mesh=new THREE.Mesh(World.PLANE,_shader.material);mesh.scale.set(8,4,1);mesh.renderOrder=8;_this.group.add(mesh);_mesh=mesh}function initShadow(){var geometry=new THREE.PlaneBufferGeometry(1,1);geometry.rotateX(-Math.PI/2);var shader=_this.initClass(Shader,"WeaponShadow");shader.uniforms={uAlpha:{type:"f",value:0}};shader.material.transparent=true;shader.material.depthWrite=false;_shadow=new THREE.Mesh(geometry,shader.material);_shadow.scale.z=2;_shadow.scale.x=8;_shadow.position.y=-1.7;_shadow.rotation.y=-.3;_shadow.renderOrder=4;_shadow.shader=shader;_this.add(_shadow)}function loop(){_shader.uniforms.uMouse.value.copy(Mouse.tilt)}this.animateIn=function(){_this.startRender(loop);_this.group.visible=true;_shader.uniforms.uDotsDir.value=1;tween(_shader.uniforms.uDotsFade,{value:0},22e2,"easeOutCubic",300);_shadow.shader.tween("uAlpha",1,800,"easeOutCubic",300);var s=.2;_shadow.scale.z=2*s;_shadow.scale.x=8*s;tween(_shadow.scale,{x:8,z:2},12e2,"easeOutElastic",400);_mesh.position.z=-20;_mesh.rotation.z=Math.radians(-20);tween(_mesh.rotation,{z:0},12e2,"easeOutElastic",400);tween(_mesh.position,{z:0},12e2,"easeOutCubic")};this.animateOut=function(){_shader.uniforms.uDotsDir.value=-1;tween(_shader.uniforms.uDotsFade,{value:1},1e3,"easeOutCubic").onComplete(function(){_this.group.visible=false;_this.stopRender(loop)});_shadow.shader.tween("uAlpha",0,500,"easeOutCubic")}},function(){var _shader;WeaponsRender.getShader=function(){if(!_shader){_shader=new Shader("WeaponsRender");_shader.uniforms={uTime:World.TIME,uMap:{type:"t",value:null},uNormal:{type:"t",value:null},uMouse:{type:"v2",value:null},uWipe:{type:"f",value:0},uDotsDir:{type:"f",value:0},uDotsFade:{type:"f",value:0}}}return _shader.clone()}});Class(function WeaponsScene(_move,_copy){Inherit(this,Object3D);var _this=this;var _circle=void 0,_title=void 0,_schematics=void 0,_background=void 0;var _weapons=[];var _titles=[];var _current=0;this.inner=new THREE.Group;var _mouseRotation=new THREE.Vector3;(function(){init();initSchematics();initBackground();initTitle();initWeapons();addHandlers();_this.startRender(loop)}());function init(){_this.add(_this.inner);_this.group.rotation.x=.2;_this.group.position.y=-.5;_this.delayedCall(function(){World.SCENE.add(_this.group);_this.delayedCall(function(){if(_this.isActive)return;World.SCENE.remove(_this.group)},200)},200)}function initSchematics(){_schematics=_this.initClass(WeaponsSchematics)}function initBackground(){_background=_this.initClass(WeaponsBackground);_this.group.remove(_background.group)}function initCircle(){_circle=_this.initClass(WeaponsCircle,_move)}function initTitle(){_title=_this.initClass(WeaponsTitle);_title.group.renderOrder=0}function initWeapons(){[{type:"breacher",rotation:45,size:1.7,title:_copy.weapon1Title},{type:"bullseye",rotation:-54,size:1.8,title:_copy.weapon2Title},{type:"sword",rotation:-6,size:2.3,title:_copy.weapon4Title},{type:"crusader",rotation:103,size:2,title:_copy.weapon3Title},{type:"spikes",rotation:20,size:1.1,title:_copy.weapon5Title}].forEach(function(d,i){var weapon=_this.initClass(WeaponsRender,d);weapon.group.position.z=i*.1;_this.inner.add(weapon.group);_weapons.push(weapon);_titles.push(d.title)})}function loop(){_mouseRotation.x+=(Math.map(Mouse.perc.y,0,1,-.07,.26)*.2-_mouseRotation.x)*.1;_mouseRotation.y+=(Math.map(Mouse.perc.x,0,1,.1,-.1)*.2-_mouseRotation.y)*.1;_this.group.rotation.x+=(_mouseRotation.x-_this.group.rotation.x)*.05;_this.group.rotation.y+=(_mouseRotation.y-_this.group.rotation.y)*.05;_this.inner.position.x+=(Math.map(Mouse.perc.x,0,1,.1,-.1)-_this.inner.position.x)*.05;_this.inner.position.y+=(Math.map(Mouse.perc.y,0,1,-.1,.1)*.5-_this.inner.position.y)*.05}function addHandlers(){_this.events.sub(Weapons.NEXT,next);_this.events.sub(Weapons.PREV,prev);_this.events.sub(Weapons.CHANGE,directChange)}function next(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current+1,5);change(index);if(e.isSwipe)Tracking.event(Tracking.weaponSwipe,_current)}function prev(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current-1,5);change(index);if(e.isSwipe)Tracking.event(Tracking.weaponSwipe,_current)}function change(index){var dir=Math.sign(index-_current)*(Math.abs(index-_current)>3?-1:1);_weapons[_current].animateOut(dir);_title.change(_titles[index],dir);_current=index;_weapons[_current].animateIn(dir)}function directChange(e){if(_schematics)return;var dir=Math.sign(e.index-_current)*(Math.abs(e.index-_current)>3?-1:1);if(dir>0){_this.events.fire(Weapons.NEXT,e)}else{_this.events.fire(Weapons.PREV,e)}}function intro(){_this.events.fire(FortniteEvents.PAUSE_SCROLL);_schematics.animateIn();_this.delayedCall(function(){_weapons[_current].animateIn(1)},32e2);_this.delayedCall(function(){_this.events.fire(FortniteEvents.RESUME_SCROLL);_this.group.remove(_schematics.group);_schematics=_schematics.destroy();_title.change(_titles[_current],0)},375e1)}this.scrollIn=function(dir){_this.isActive=true;if(_this.isIntroPlayed){_weapons[_current].animateIn(1);_title.change(_titles[_current],0)}_this.delayedCall(function(){World.SCENE.add(_this.group);_this.group.add(_background.group);_this.group.position.y=-3*dir;tween(_this.group.position,{y:-.5},1e3,"easeOutExpo");if(!_this.isIntroPlayed){_this.isIntroPlayed=true;intro()}},800*.207)};this.scrollOut=function(dir){_this.isActive=false;tween(_this.group.position,{y:3*dir},dir>0?500:1e3,"easeOutCubic");_title.change(" ",0);_this.delayedCall(function(){World.SCENE.remove(_this.group);_weapons[_current].animateOut(1)},800*.207)}});Class(function WeaponsSchematics(){Inherit(this,Object3D);var _this=this;var _main=void 0,_shader=void 0;var _others=[];var _params=[{file:"002",size:[316,486],a:[1,-8,-3],b:[0,8,3],r:0,delay:700,duration:12e2},{file:"003",size:[230,427],a:[-1,-5,3],b:[2,9,-3],r:0,delay:500,duration:115e1},{file:"004",size:[282,407],a:[1,-5,3],b:[-5,8,-3],r:.7,delay:900,duration:13e2},{file:"005",size:[266,453],a:[1,-7,5],b:[-1,6,2],r:.3,delay:300,duration:1e3}];(function(){initMain();initOthers()}());function initMain(){_shader=_this.initClass(Shader,"MainSchematic");_shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/weapons/schematics/001.jpg")},uMask:{type:"c",value:new THREE.Color("#204a8e")},uTime:World.TIME,uWipe:{value:0}};_shader.material.transparent=true;_main=new THREE.Mesh(World.PLANE,_shader.material);var s=.005;_main.scale.set(309*s,455*s,1);_main.renderOrder=8;_main.position.y=-6;_this.add(_main)}function initOthers(){_params.forEach(function(d){var s=.005;var shader=_this.initClass(Shader,"Schematic");shader.uniforms={uMap:{type:"t",value:Utils3D.getTexture("assets/images/weapons/schematics/"+d.file+".jpg")},uMask:{type:"c",value:new THREE.Color("#204a8e")}};shader.material.transparent=true;var mesh=new THREE.Mesh(World.PLANE,shader.material);mesh.renderOrder=8;mesh.scale.set(d.size[0]*s,d.size[1]*s,1);mesh.position.set(d.a[0],d.a[1],d.a[2]);mesh.r=d.r;_this.add(mesh);_others.push(mesh)})}function animateMain(){var time=0;var loop=function loop(t,delta){time+=delta*.002;_main.position.y+=(Math.sin(time*1.5)*.2+.5-_main.position.y)*.1;_main.rotation.y=Math.sin(t*.002)*.03;_main.rotation.z=Math.sin(t*.0013)*.04;_main.rotation.x=Math.sin(t*.0009)*.15};_this.startRender(loop);_shader.tween("uWipe",1,600,"easeInOutCubic",19e2).onComplete(function(){if(!_this||!_this.group)return;_this.group.remove(_main);_this.stopRender(loop)})}function animateOthers(){_others.forEach(function(mesh,i){var d=_params[i];tween(mesh.position,{x:d.b[0],y:d.b[1],z:d.b[2]},d.duration,"easeOutCubic",d.delay)});_this.startRender(function(t){_others.forEach(function(mesh){mesh.rotation.z=mesh.r+Math.sin(t*.005)*.2})})}this.animateIn=function(){_this.delayedCall(animateMain,12e2);animateOthers()}});Class(function WeaponsText(_copy){Inherit(this,Element);var _this=this;var $this=this.element;var $bg=void 0,$text=void 0;var _width=300;var _current=0;var _order=[1,2,4,3,5];(function(){initHTML();style();addHandlers();_this.startRender(loop)}());function initHTML(){$bg=$this.create("Background");$text=$this.create("Text")}function style(){$this.css({right:100,bottom:130});$bg.size(_width+60,200).css({right:0,bottom:0,background:"#072852",margin:-30,opacity:.3});$bg.warp=_this.initClass(Warp,$bg);$bg.warp.render();$bg.warp.tl.yTarget=$bg.warp.tl.y;$bg.warp.tr.yTarget=$bg.warp.tr.y;$text.html(_copy["weapon"+(_current+1)+"Text"]);$text.css({right:0,bottom:0,width:_width,height:"auto",fontFamily:"OpenSans",fontSize:14,lineHeight:"1.6em",color:"#fff"});$this.css({opacity:0})}function updateHeight(){var h=$text.div.clientHeight+60;$bg.warp.tl.yTarget=200-h;$bg.warp.tr.yTarget=200-h}function loop(t){if(!_this.isActive)return;var s=.1;$bg.warp.tl.x=(Math.sin(t*.01*s)-1)*5;$bg.warp.tr.x=(Math.sin(t*.0046*s)-1)*7+_width+60;$bg.warp.bl.x=(Math.sin(t*.0085*s)-1)*7;$bg.warp.br.x=(Math.sin(t*.0055*s)-1)*6+_width+60;$bg.warp.bl.y=200+(Math.sin(t*.007*s)+1)*5;$bg.warp.br.y=200+(Math.sin(t*.01*s)+1)*5;$bg.warp.tl.y+=($bg.warp.tl.yTarget+(Math.sin(t*.012*s)-1)*6-$bg.warp.tl.y)*.1;$bg.warp.tr.y+=($bg.warp.tr.yTarget+(Math.sin(t*.003*s)-1)*5-$bg.warp.tr.y)*.16;$bg.warp.render()}function addHandlers(){_this.events.sub(Weapons.NEXT,next);_this.events.sub(Weapons.PREV,prev)}function next(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current+1,5);change(index)}function prev(e){var index=typeof e.index!=="undefined"?e.index:Math.mod(_current-1,5);change(index)}function change(index){_current=index;$text.tween({opacity:0,y:-3},400,"easeOutCubic").onComplete(function(){$text.html(_copy["weapon"+_order[_current]+"Text"]).transform({y:15});_this.delayedCall(function(){updateHeight();$text.tween({opacity:.9,y:0},12e2,"easeOutCubic",200)},200)})}this.animateIn=function(){if(_this.isActive)return;$this.show();_this.delayedCall(function(){updateHeight();$this.css({opacity:0}).transform({scaleX:.8,scaleY:.8}).tween({opacity:1,scaleX:1,scaleY:1},12e2,"easeOutElastic",200)},200);_this.isActive=true};this.animateOut=function(){if(!_this.isActive)return;$this.tween({opacity:0,scaleX:.8,scaleY:.8},300,"easeInBack").onComplete(function(){$this.hide()});_this.isActive=false}});Class(function WeaponsTitle(){Inherit(this,Object3D);var _this=this;var _wrapper;var _context=void 0,_texture=void 0,_shader=void 0;var _rotateTween=void 0,_opacityTween=void 0;var _s=1;var _fontSize=300*_s;(function(){initCanvas();initMesh();addHandlers();_this.startRender(loop)}());function initCanvas(){_this.canvas=document.createElement("canvas");_this.canvas.width=2048*_s;_this.canvas.height=1024*_s;_context=_this.canvas.getContext("2d");_context.font=_fontSize+"px BurbankBigCondensed-Black";_context.textAlign="center";_context.textBaseline="middle";_texture=new THREE.Texture(_this.canvas)}function initMesh(){var geometry=World.PLANE;_shader=_this.initClass(Shader,"WeaponsTitle");_shader.uniforms={uMap:{type:"t",value:_texture},uAlpha:{type:"f",value:.05},uSwipe:{type:"f",value:1},uDir:{type:"f",value:1}};_shader.material.transparent=true;_shader.material.depthWrite=false;_wrapper=new THREE.Group;_this.add(_wrapper);var mesh=new THREE.Mesh(geometry,_shader.material);var s=1.8;mesh.scale.set(14*s,7*s,1);mesh.position.set(0,.3,-10);mesh.renderOrder=3;_wrapper.add(mesh)}function loop(){}function addHandlers(){_this.events.sub(Mouse.input,Interaction.END,end)}function drag(){if(Global.PAUSED)return;if(_opacityTween)_opacityTween.stop();_opacityTween=tween(_shader.uniforms.uAlpha,{value:1},1e3,"easeOutSine");clearTimeout(_this.timeout);_this.timeout=_this.delayedCall(function(){_opacityTween=tween(_shader.uniforms.uAlpha,{value:.15},15e2,"easeOutCubic")},400)}function end(){if(Global.PAUSED)return}this.change=function(text,dir,scale){clearTimeout(_this.timeout);_shader.set("uSwipe",-1);_context.clearRect(0,0,2048*_s,1024*_s);_context.fillStyle="#fff";var words=text.split(" ");_fontSize=Math.range(words.length,1,3,350,240);_context.font=_fontSize+"px BurbankBigCondensed-Black";var lineHeight=_fontSize*.85;words.forEach(function(t,i){var y=i*lineHeight-(words.length-1)*.5*lineHeight;_context.fillText(t.toUpperCase(),1024*_s,512*_s+y)});_texture.needsUpdate=true;_wrapper.position.z=20;tween(_wrapper.position,{z:0},1e3,"easeOutElastic");_shader.set("uDir",-1);_shader.tween("uSwipe",1,1e3,"easeOutCubic");drag()}});Class(function WeaponsView(_copy){Inherit(this,Element);var _this=this;var $this=this.element;var _rayTimeout=void 0,_nav=void 0,_text=void 0;var _changes=0;(function(){$this.css({position:"static"});style();initNav();initText();addHandlers()}());function style(){$this.hide()}function initNav(){_nav=_this.initClass(WeaponsNav)}function initText(){_text=_this.initClass(WeaponsText,_copy)}function addHandlers(){_this.events.sub(Weapons.NEXT,change);_this.events.sub(Weapons.PREV,change)}function change(){_changes++;if(_changes==3){Ray.instance().change(_copy.rey3);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey4);_this.delayedCall(Ray.instance().close,4e3)},25e2)}}this.scrollIn=function(dir){$this.show();if(!_this.isIntroPlayed){_this.isIntroPlayed=true;_this.delayedCall(_nav.animateIn,4e3);_this.delayedCall(_text.animateIn,4e3);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey1);_rayTimeout=_this.delayedCall(function(){Ray.instance().change(_copy.rey2);_rayTimeout=_this.delayedCall(Ray.instance().close,3e3)},4e3)},35e2);return}_this.delayedCall(function(){_nav.animateIn();_text.animateIn();DragPrompt.instance().start()},500)};this.scrollOut=function(dir){$this.tween({opacity:0},400,"easeOutSine").onComplete(function(){$this.clearAlpha().hide()});_nav.animateOut();_text.animateOut();if(_rayTimeout)clearTimeout(_rayTimeout);Ray.instance().animateOut()}});Service.disabled=true;Dev.checkForLeaks(false);window.require=window.requireNative;Mobile.isAllowNativeScroll=true;Class(function Main(){Inherit(this,Events);var _this=this;(function(){init()}());function init(){if(Device.mobile)Blocker.instance();if(!Device.graphics.webgl){__body.removeChild(Stage);return}Config.EPIC=function(){if(window.__fortnite_asset_path||window.__fortnite_asset_path_dev)return true;return false}();Assets.CDN=function(){if(window.__fortnite_asset_path)return window.__fortnite_asset_path;if(window.__fortnite_asset_path_dev)return window.__fortnite_asset_path_dev;if(window._CDN_&&window._CDN_!=="")return window._CDN_;return""}();if(Config.EPIC){Assets.CORS="anonymous";Assets.HEADERS={mode:"cors"}}if(Utils.query("p")||Utils.query("playground")){AssetLoader.loadAllAssets(Playground.instance);return}__body.removeChild(Stage);addHandlers();if(!Config.EPIC)mount()}function addHandlers(){Events.MOUNT="mount_activetheory";Events.UNMOUNT="unmount_activetheory";Events.SCROLL_TO_TOP="scroll_to_top_activetheory";_this.events.sub(Events.RESIZE,resize);_this.events.sub(Events.MOUNT,mount);_this.events.sub(Events.UNMOUNT,unmount);resize()}function resize(){if(Global.PAUSED)return;Stage.css({width:"auto",height:"auto",top:52,right:0,left:0,bottom:0}).setZ(1);Stage.height=Stage.div.clientHeight;Stage.width=Stage.div.clientWidth}function mount(e){if(e&&e.copy&&!Copy.isLiveData){Copy.messages=e.copy.messages;Copy.isLiveData=true}if(e&&e.components&&!Config.CLASS_NAMES.length){Config.CLASS_NAMES=e.components}if(e&&e.cta)Config.PREORDER_CTA=e.cta;if(e&&e.ctaLabel)Config.CTA_LABEL=e.ctaLabel;__body.css({overflow:"hidden"}).scrollTop=0;__body.add(Stage);Global.PAUSED=false;window.onresize();Render.resume();Container.instance();Mobile.isAllowNativeScroll=false}function unmount(){Global.UNMOUNTED=true;Global.PAUSED=true;Render.pause();__body.css({overflow:"auto"});__body.removeChild(Stage);Mobile.isAllowNativeScroll=true}});window._BUILT_=true
window._MINIFIED_ = true;
